
; /* Start:"a:4:{s:4:"full";s:98:"/bitrix/components/bitrix/socialnetwork.blog.post/templates/.default/script.min.js?155117212123727";s:6:"source";s:78:"/bitrix/components/bitrix/socialnetwork.blog.post/templates/.default/script.js";s:3:"min";s:82:"/bitrix/components/bitrix/socialnetwork.blog.post/templates/.default/script.min.js";s:3:"map";s:82:"/bitrix/components/bitrix/socialnetwork.blog.post/templates/.default/script.map.js";}"*/
function showHiddenDestination(t,e){BX.hide(e);BX("blog-destination-hidden-"+t).style.display="inline"}function showMenuLinkInput(t,e){var s="post-menu-"+t+"-link",i=BX(s+"-text"),o=BX(s+"-icon-done");if(BX.clipboard.isCopySupported()){if(i&&i.getAttribute("data-block-click")=="Y"){return}BX.clipboard.copy(e);if(i&&o){o.style.display="inline-block";BX.removeClass(BX(s+"-icon-animate"),"post-menu-link-icon-animate");BX.adjust(i,{attrs:{"data-block-click":"Y"}});setTimeout(function(){BX.addClass(BX(s+"-icon-animate"),"post-menu-link-icon-animate")},1);setTimeout(function(){BX.adjust(i,{attrs:{"data-block-click":"N"}})},500)}return}var n=BX.proxy_context,a=parseInt(!!n.getAttribute("bx-height")?n.getAttribute("bx-height"):n.offsetHeight);if(n.getAttribute("bx-status")!="shown"){n.setAttribute("bx-status","shown");if(!BX(s)&&!!BX(s+"-text")){var p=BX(s+"-text"),r=BX.pos(p),u=BX.pos(p.parentNode);pos3=BX.pos(BX.findParent(p,{className:"menu-popup-item"},true));r["height"]=u["height"]-1;BX.adjust(n,{attrs:{"bx-height":n.offsetHeight},style:{overflow:"hidden",display:"block"},children:[BX.create("BR"),BX.create("DIV",{attrs:{id:s},children:[BX.create("SPAN",{attrs:{className:"menu-popup-item-left"}}),BX.create("SPAN",{attrs:{className:"menu-popup-item-icon"}}),BX.create("SPAN",{attrs:{className:"menu-popup-item-text"},children:[BX.create("INPUT",{attrs:{id:s+"-input",type:"text",value:e},style:{height:r["height"]+"px",width:pos3["width"]-21+"px"},events:{click:function(t){this.select();BX.PreventDefault(t)}}})]})]}),BX.create("SPAN",{className:"menu-popup-item-right"})]})}new BX.fx({time:.2,step:.05,type:"linear",start:a,finish:a*2,callback:BX.delegate(function(t){this.style.height=t+"px"},n)}).start();BX.fx.show(BX(s),.2);BX(s+"-input").select()}else{n.setAttribute("bx-status","hidden");new BX.fx({time:.2,step:.05,type:"linear",start:n.offsetHeight,finish:a,callback:BX.delegate(function(t){this.style.height=t+"px"},n)}).start();BX.fx.hide(BX(s),.2)}}function deleteBlogPost(t){var e=BX("blg-post-"+t);if(BX.findChild(e,{attr:{id:"form_c_del"}},true,false)){BX.hide(BX("form_c_del"));BX(e.parentNode.parentNode).appendChild(BX("form_c_del"))}BX.ajax.get(BX.message("sonetBPDeletePath").replace("#del_post_id#",t),function(s){if(window.deletePostEr&&window.deletePostEr=="Y"){BX.findChild(e,{className:"feed-post-cont-wrap"},true,false).insertBefore(BX.create("SPAN",{html:s}),BX.findChild(e,{className:"feed-user-avatar"},true,false))}else{__logDeleteSuccess(BX("blg-post-"+t))}});return false}var waitPopupBlogImage=null;function blogShowImagePopup(t){if(!waitPopupBlogImage){waitPopupBlogImage=new BX.PopupWindow("blogwaitPopupBlogImage",window,{autoHide:true,lightShadow:false,zIndex:2,content:BX.create("IMG",{props:{src:t,id:"blgimgppp"}}),closeByEsc:true,closeIcon:true})}else{BX("blgimgppp").src="/bitrix/images/1.gif";BX("blgimgppp").src=t}waitPopupBlogImage.setOffset({offsetTop:0,offsetLeft:0});setTimeout(function(){waitPopupBlogImage.adjustPosition()},100);waitPopupBlogImage.show()}function __blogPostSetFollow(t){var e=BX("log_entry_follow_"+t).getAttribute("data-follow")=="Y"?"Y":"N",s=e=="Y"?"N":"Y",i=BX("log_entry_follow_"+t);if(i){BX.findChild(i,{tagName:"a"}).innerHTML=BX.message("sonetBPFollow"+s);i.setAttribute("data-follow",s)}var o=BX.message("sonetBPSetPath");o=BX.util.add_url_param(o,{b24statAction:s=="Y"?"setFollow":"setUnfollow"});BX.ajax({url:o,method:"POST",dataType:"json",data:{log_id:t,action:"change_follow",follow:s,sessid:BX.bitrix_sessid(),site:BX.message("sonetBPSiteId")},onsuccess:function(t){if(t["SUCCESS"]!="Y"&&i){BX.findChild(i,{tagName:"a"}).innerHTML=BX.message("sonetBPFollow"+e);i.setAttribute("data-follow",e)}},onfailure:function(t){if(i){BX.findChild(i,{tagName:"a"}).innerHTML=BX.message("sonetBPFollow"+e);i.setAttribute("data-follow",e)}}});return false}(function(){if(!!BX.SBPostMenu)return false;BX.SBPostMenu=function(t){};BX.SBPostMenu.showMenu=function(params){if(typeof params=="undefined"||typeof params.postId=="undefined"||parseInt(params.postId)<=0||typeof params.bindNode=="undefined"||!BX(params.bindNode)){return false}BX.PopupMenu.destroy("blog-post-"+params.postId);var isPublicPage=typeof params.publicPage!="undefined"&&!!params.publicPage,isTasksAvailable=typeof params.tasksAvailable!="undefined"&&!!params.tasksAvailable,pathToPost=typeof params.pathToPost!="undefined"?params.pathToPost:"",urlToEdit=typeof params.urlToEdit!="undefined"?params.urlToEdit:"",urlToHide=typeof params.urlToHide!="undefined"?params.urlToHide:"",urlToDelete=typeof params.urlToDelete!="undefined"?params.urlToDelete:"",voteId=typeof params.voteId!="undefined"?parseInt(params.voteId):false,postType=typeof params.postType!="undefined"?params.postType:false;if(BX.type.isNotEmptyString(urlToHide)){urlToHide=BX.util.remove_url_param(urlToHide,["b24statAction"]);urlToHide=BX.util.add_url_param(urlToHide,{b24statAction:"hidePost"})}if(isPublicPage){return false}var menuWaiterPopup=new BX.PopupWindow("blog-post-"+params.postId+"-waiter",params.bindNode,{offsetLeft:-14,offsetTop:4,lightShadow:false,angle:{position:"top",offset:50},content:BX.create("SPAN",{props:{className:"bx-ilike-wait"}})});setTimeout(function(){if(menuWaiterPopup){menuWaiterPopup.show()}},300);BX.ajax({url:"/bitrix/components/bitrix/socialnetwork.blog.post/ajax.php",method:"POST",dataType:"json",data:{sessid:BX.bitrix_sessid(),siteId:BX.message("SITE_ID"),action:"get_data",postId:parseInt(params.postId),public:isPublicPage?"Y":"N",mobile:"N",group_readonly:typeof params.group_readonly!="undefined"&&!!params.group_readonly?"Y":"N",pathToPost:pathToPost,voteId:voteId},onsuccess:function(postData){if(typeof postData=="undefined"||typeof postData.perms=="undefined"||postData.perms<="D"&&(typeof params.items=="undefined"||params.items.length<=0)){menuWaiterPopup.destroy();return false}var menuItems=[];if(!BX.util.in_array(postType,["DRAFT","MODERATION"])){if(postData.isGroupReadOnly!="Y"&&parseInt(BX.message("USER_ID"))>0&&parseInt(postData.logId)>0){var isFavorites=parseInt(postData.logFavoritesUserId)>0;menuItems.push({text:BX.message(isFavorites?"sonetLMenuFavoritesTitleY":"sonetLMenuFavoritesTitleN"),onclick:function(t){__logChangeFavorites(parseInt(postData.logId),"log_entry_favorites_"+parseInt(postData.logId),isFavorites?"N":"Y",true);return false}})}var serverName=params.serverName;menuItems.push({text:BX.message("BLOG_HREF"),href:postData.urlToPost,class:"feed-entry-popup-menu-link"});menuItems.push({text:'<span id="post-menu-'+postData.logId+'-link-text">'+BX.message("BLOG_LINK")+"</span>"+'<span id="post-menu-'+postData.logId+'-link-icon-animate" class="post-menu-link-icon-wrap">'+'<span class="post-menu-link-icon" id="post-menu-'+postData.logId+'-link-icon-done" style="display: none;">'+"</span>"+"</span>",onclick:function(t){showMenuLinkInput(parseInt(postData.logId),serverName+postData.urlToPost);return false},class:"feed-entry-popup-menu-link"});if(parseInt(BX.message("USER_ID"))>0&&postData.isGroupReadOnly!="Y"&&postData.isShareForbidden!="Y"){menuItems.push({text:BX.message("BLOG_SHARE"),onclick:function(){showSharing(parseInt(params.postId),parseInt(postData.authorId));this.popupWindow.close()}})}if(postData.perms>="W"||postData.perms>="P"&&postData.authorId==BX.message("USER_ID")){menuItems.push({text:BX.message("BLOG_BLOG_BLOG_EDIT"),href:urlToEdit})}if(postData.perms>="T"){menuItems.push({text:BX.message("BLOG_MES_HIDE"),onclick:function(){if(confirm(BX.message("BLOG_MES_HIDE_POST_CONFIRM"))){window.location=urlToHide;this.popupWindow.close()}}})}if(postData.perms>="W"){menuItems.push({text:BX.message("BLOG_BLOG_BLOG_DELETE"),onclick:function(){if(confirm(BX.message("BLOG_MES_DELETE_POST_CONFIRM"))){if(urlToDelete.length>0){window.location=urlToDelete.replace("#del_post_id#",parseInt(params.postId))}else{window.deleteBlogPost(parseInt(params.postId))}this.popupWindow.close()}}})}if(isTasksAvailable&&postData.perms>"D"){menuItems.push({text:BX.message("BLOG_POST_CREATE_TASK"),onclick:function(t){var e=t.target||t.srcElement;oLF.createTask({entityType:"BLOG_POST",entityId:parseInt(params.postId)});this.popupWindow.close();return t.preventDefault()}})}if(postData.urlToVoteExport.length>0){menuItems.push({text:BX.message("BLOG_POST_VOTE_EXPORT"),href:postData.urlToVoteExport})}}var onclickHandler=null,menuItem=null,item=null;if(typeof params.items!="undefined"){for(var key in params.items){if(params.items.hasOwnProperty(key)){item=params.items[key];menuItem={};if(typeof item.text_php!="undefined"){menuItem.text=item.text_php}if(typeof item.onclick!="undefined"){eval("onclickHandler = "+item.onclick);menuItem.onclick=onclickHandler}else if(typeof item.href!="undefined"){menuItem.href=item.href}menuItems.push(menuItem)}}}var popupEvents=typeof params.logId!="undefined"&&parseInt(params.logId)>0?{onPopupShow:function(t){if(BX("log_entry_favorites_"+parseInt(params.logId))){var e=BX.findChildren(t.contentContainer,{className:"menu-popup-item-text"},true);if(e!=null){for(var s=0;s<e.length;s++){if(e[s].innerHTML==BX.message("sonetLMenuFavoritesTitleY")||e[s].innerHTML==BX.message("sonetLMenuFavoritesTitleN")){var i=e[s];break}}}if(typeof i!="undefined"){BX(i).innerHTML=BX.hasClass(BX("log_entry_favorites_"+parseInt(params.logId)),"feed-post-important-switch-active")?BX.message("sonetLMenuFavoritesTitleY"):BX.message("sonetLMenuFavoritesTitleN")}}if(BX("post-menu-"+parseInt(params.logId)+"-link")){var o=BX.findChild(t.popupContainer,{className:"feed-entry-popup-menu-link"},true,false);if(o){var n=parseInt(!!o.getAttribute("bx-height")?o.getAttribute("bx-height"):0);if(n>0){BX("post-menu-"+parseInt(params.logId)+"-link").style.display="none";o.setAttribute("bx-status","hidden");o.style.height=n+"px"}}}}}:{};menuWaiterPopup.destroy();BX.PopupMenu.show("blog-post-"+params.postId,params.bindNode,menuItems,{offsetLeft:-14,offsetTop:4,lightShadow:false,angle:{position:"top",offset:50},events:popupEvents});return false},onfailure:function(t){menuWaiterPopup.destroy();return false}})}})();(function(){if(!!window.SBPImpPost)return false;window.SBPImpPost=function(t){if(t.getAttribute("sbpimppost")=="Y")return false;this.CID="sbpimppost"+(new Date).getTime();this.busy=false;this.node=t;this.btn=t.parentNode;this.block=t.parentNode.parentNode;this.postId=t.getAttribute("bx-blog-post-id");t.setAttribute("sbpimppost","Y");BX.onCustomEvent(this.node,"onInit",[this]);if(this.postId>0)this.onclick();return false};window.SBPImpPost.prototype.onclick=function(){this.sendData()};window.SBPImpPost.prototype.showClick=function(){var t=this.btn.offsetWidth,e=BX.message("BLOG_ALREADY_READ"),s=BX.create("span",{props:{className:"have-read-text-block"},html:"<i></i>"+e+'<span class="feed-imp-post-footer-comma">,</span>'});this.block.style.minWidth=this.btn.offsetWidth-27+"px";var i=new BX.easing({duration:250,start:{width:t},finish:{width:1},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:BX.delegate(function(t){this.btn.style.width=t.width+"px"},this),complete:BX.delegate(function(){this.btn.innerHTML="";this.btn.appendChild(s);var t=s.offsetWidth,e=new BX.easing({duration:300,start:{width_2:0},finish:{width_2:t},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:BX.delegate(function(t){this.btn.style.width=t.width_2+"px"},this)});e.animate()},this)});i.animate()};window.SBPImpPost.prototype.wait=function(t){t=t=="show"?"show":"hide";if(t=="show"){this.node.disabled=true;BX.addClass(this.node,"ui-btn-clock")}else{BX.removeClass(this.node,"ui-btn-clock")}};window.SBPImpPost.prototype.sendData=function(){if(this.busy)return false;this.busy=true;window["node"]=this.node;window["obj"]=this;this.wait("show");var t={options:[{post_id:this.postId,name:"BLOG_POST_IMPRTNT",value:"Y"}],sessid:BX.bitrix_sessid()},e=this.node.getAttribute("bx-url");BX.onCustomEvent(this.node,"onSend",[t]);t=BX.ajax.prepareData(t);if(t){e+=(e.indexOf("?")!==-1?"&":"?")+t;t=""}BX.ajax({method:"GET",url:e,dataType:"json",onsuccess:BX.delegate(function(t){this.busy=false;this.wait("hide");this.showClick();BX.onCustomEvent(this.node,"onUserVote",[t]);BX.onCustomEvent("onImportantPostRead",[this.postId,this.CID])},this),onfailure:BX.delegate(function(t){this.busy=false;this.wait("hide")},this)})};top.SBPImpPostCounter=function(t,e,s){this.parentNode=t;this.node=BX.findChild(t,{tagName:"A"});if(!this.node)return false;BX.addCustomEvent(this.node,"onUserVote",BX.delegate(function(t){this.change(t)},this));this.parentNode.SBPImpPostCounter=this;this.node.setAttribute("status","ready");this.node.setAttribute("inumpage",0);this.postId=e;this.popup=null;this.data=[];BX.bind(t,"click",BX.proxy(function(){this.get()},this));BX.bind(t,"mouseover",BX.proxy(function(t){this.init(t)},this));BX.bind(t,"mouseout",BX.proxy(function(t){this.init(t)},this));this.pathToUser=s["pathToUser"];this.nameTemplate=s["nameTemplate"];this.onPullEvent=BX.delegate(function(t,e){if(t=="read"&&!!e&&e["POST_ID"]==this.postId){if(!!e["data"]){this.change(e["data"]);if(this.popup!=null){this.popup.isNew=true}}}},this);BX.addCustomEvent("onPullEvent-socialnetwork",this.onPullEvent)};top.SBPImpPostCounter.prototype.click=function(t){t.uController=this;BX.addCustomEvent(t.node,"onUserVote",BX.proxy(this.change,this));BX.addCustomEvent(t.node,"onSend",BX.proxy(function(t){t["PATH_TO_USER"]=this.pathToUser;t["NAME_TEMPLATE"]=this.nameTemplate;t["iNumPage"]=0;t["ID"]=this.postId;t["post_id"]=this.postId;t["name"]="BLOG_POST_IMPRTNT";t["value"]="Y";t["return"]="users"},this));this.btnObj=t};top.SBPImpPostCounter.prototype.change=function(t){if(!!t&&!!t.items){var e=false;this.data=[];for(var s in t.items){if(t.items.hasOwnProperty(s)){this.data.push(t.items[s])}}if(t["StatusPage"]=="done"){this.node.setAttribute("inumpage","done")}else this.node.setAttribute("inumpage",1);BX.adjust(this.parentNode,{style:{display:"inline-block"}})}else{this.node.setAttribute("inumpage","done");BX.hide(this.parentNode)}this.node.firstChild.innerHTML=t["RecordCount"]};top.SBPImpPostCounter.prototype.init=function(t){if(!!this.node.timeoutOver){clearTimeout(this.node.timeoutOver);this.node.timeoutOver=false}if(t.type=="mouseover"){if(!this.node.mouseoverFunc){this.node.mouseoverFunc=BX.delegate(function(){this.get();if(this.popup){BX.bind(this.popup.popupContainer,"mouseout",BX.proxy(function(){this.popup.timeoutOut=setTimeout(BX.proxy(function(){if(!!this.popup){this.popup.close()}},this),400)},this));BX.bind(this.popup.popupContainer,"mouseover",BX.proxy(function(){if(this.popup.timeoutOut)clearTimeout(this.popup.timeoutOut)},this))}},this)}this.node.timeoutOver=setTimeout(this.node.mouseoverFunc,400)}};top.SBPImpPostCounter.prototype.get=function(){if(this.node.getAttribute("inumpage")!="done")this.node.setAttribute("inumpage",parseInt(this.node.getAttribute("inumpage"))+1);this.show();if(this.data.length>0){this.make(this.node.getAttribute("inumpage")!="done")}if(this.node.getAttribute("inumpage")!="done"){this.node.setAttribute("status","busy");BX.ajax({url:"/bitrix/components/bitrix/socialnetwork.blog.blog/users.php",method:"POST",dataType:"json",data:{ID:this.postId,post_id:this.postId,name:"BLOG_POST_IMPRTNT",value:"Y",iNumPage:this.node.getAttribute("inumpage"),PATH_TO_USER:this.pathToUser,NAME_TEMPLATE:this.nameTemplate,sessid:BX.bitrix_sessid(),lang:BX.message("LANGUAGE_ID"),site:BX.message("SITE_ID")},onsuccess:BX.proxy(function(t){if(!!t&&!!t.items){var e=false;for(var s in t.items){this.data.push(t.items[s])}if(t.StatusPage=="done"){this.node.setAttribute("inumpage","done")}this.make(this.node.getAttribute("inumpage")!="done")}else{this.node.setAttribute("inumpage","done")}this.node.firstChild.innerHTML=t["RecordCount"];this.node.setAttribute("status","ready")},this),onfailure:BX.proxy(function(t){this.node.setAttribute("status","ready")},this)})}};top.SBPImpPostCounter.prototype.show=function(){if(this.popup==null){this.popup=new BX.PopupWindow("bx-vote-popup-cont-"+this.postId,this.node,{lightShadow:true,offsetTop:-2,offsetLeft:3,autoHide:true,closeByEsc:true,bindOptions:{position:"top"},events:{onPopupClose:function(){this.destroy()},onPopupDestroy:BX.proxy(function(){this.popup=null},this)},content:BX.create("SPAN",{props:{className:"bx-ilike-wait"}})});this.popup.isNew=true;this.popup.show()}this.popup.setAngle({position:"bottom"});this.popup.bindOptions.forceBindPosition=true;this.popup.adjustPosition();this.popup.bindOptions.forceBindPosition=false};top.SBPImpPostCounter.prototype.make=function(t){if(!this.popup)return true;t=t!==false;var e=this.popup&&this.popup.contentContainer?this.popup.contentContainer:BX("popup-window-content-bx-vote-popup-cont-"+this.postId),s=false,i=false,o=this.data;if(this.popup.isNew){s=BX.create("SPAN",{props:{className:"bx-ilike-popup"},children:[BX.create("SPAN",{props:{className:"bx-ilike-bottom_scroll"}})]});i=BX.create("SPAN",{props:{className:"bx-ilike-wrap-block"},children:[s]})}else{s=BX.findChild(this.popup.contentContainer,{className:"bx-ilike-popup"},true)}if(!!s){var n=null;for(var a in o){if(o.hasOwnProperty(a)){if(!BX.findChild(s,{tag:"A",attr:{id:"u"+o[a]["ID"]}},true)){if(o[a]["PHOTO_SRC"].length>0){n=BX.create("IMG",{attrs:{src:o[a]["PHOTO_SRC"]},props:{className:"bx-ilike-popup-avatar-img"}})}else{n=BX.create("IMG",{attrs:{src:"/bitrix/images/main/blank.gif"},props:{className:"bx-ilike-popup-avatar-img bx-ilike-popup-avatar-img-default"}})}s.appendChild(BX.create("A",{attrs:{id:"u"+o[a]["ID"]},props:{href:o[a]["URL"].length>0?o[a]["URL"]:"#",target:"_blank",className:"bx-ilike-popup-img"+(!!o[a]["TYPE"]?" bx-ilike-popup-img-"+o[a]["TYPE"]:"")},text:"",children:[BX.create("SPAN",{props:{className:"bx-ilike-popup-avatar-new"},children:[n,BX.create("SPAN",{props:{className:"bx-ilike-popup-avatar-status-icon"}})]}),BX.create("SPAN",{props:{className:"bx-ilike-popup-name-new"},html:o[a]["FULL_NAME"]})],events:{click:o[a]["URL"].length>0?function(t){return true}:function(t){BX.PreventDefault(t)}}}))}}}if(t){BX.bind(s,"scroll",BX.proxy(this.popupScrollCheck,this))}}if(this.popup.isNew){this.popup.isNew=false;if(!!e){try{e.removeChild(e.firstChild)}catch(t){}e.appendChild(i)}}if(this.popup!=null){this.popup.bindOptions.forceBindPosition=true;this.popup.adjustPosition();this.popup.bindOptions.forceBindPosition=false}};top.SBPImpPostCounter.prototype.popupScrollCheck=function(){var t=BX.proxy_context;if(t.scrollTop>(t.scrollHeight-t.offsetHeight)/1.5){BX.unbind(t,"scroll",BX.proxy(this.popupScrollCheck,this));this.get()}}})(window);window.showSharing=function(t,e){BX("sharePostId").value=t;BX("shareUserId").value=e;var s=BX("blogShare").getAttribute("bx-selector-id");if(!BX.type.isNotEmptyString(s)){return}var i=BX.UI.SelectorManager.instances[s];if(!BX.type.isNotEmptyObject(i)){return}var o={},n=[],a=null;if(window["postDest"+t]){for(var p=0;p<window["postDest"+t].length;p++){a=window["postDest"+t][p];o[a.id]=a.type;n.push(a.id)}BX.onCustomEvent("BX.Main.SelectorV2:reInitDialog",[{selectorId:s,selectedItems:o,undeletableItems:n}]);var r=BX("destination-sharing");if(BX("blg-post-destcont-"+t)){BX("blg-post-destcont-"+t).appendChild(r)}r.style.height=0;r.style.opacity=0;r.style.overflow="hidden";r.style.display="inline-block";new BX.easing({duration:500,start:{opacity:0,height:0},finish:{opacity:100,height:r.scrollHeight-40},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:function(t){r.style.height=t.height+"px";r.style.opacity=t.opacity/100},complete:function(){r.style.cssText=""}}).animate()}};window.closeSharing=function(){var t=BX("destination-sharing");if(BX("sharePostSubmitButton")){BX.removeClass(BX("sharePostSubmitButton"),"ui-btn-clock")}new BX.easing({duration:500,start:{opacity:100,height:t.scrollHeight-40},finish:{opacity:0,height:0},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:function(e){t.style.height=e.height+"px";t.style.opacity=e.opacity/100},complete:function(){BX.hide(t)}}).animate()};window.sharingPost=function(){var t=BX("sharePostId").value;var e=BX("shareUserId").value;var s=BX("blogShare");var i=socBPDest.shareUrl.replace(/#post_id#/,t).replace(/#user_id#/,e);i=BX.util.remove_url_param(i,["b24statAction"]);i=BX.util.add_url_param(i,{b24statAction:"sharePost"});if(BX("sharePostSubmitButton")){BX.addClass(BX("sharePostSubmitButton"),"ui-btn-clock")}s.action=i;s.target="";var o,n="";var a=s.elements.length;var p="";for(o=0;o<a;o++){if(n!="")p="&";var r=s.elements[o];if(r.disabled)continue;switch(r.type.toLowerCase()){case"text":case"hidden":n+=p+r.name+"="+BX.util.urlencode(r.value);break;default:break}}n+="&save=Y&MODE=RECORD&AJAX_POST=Y&ENTITY_XML_ID=BLOG_"+t;var u=renderSharingPost(t);BX.ajax({method:"POST",dataType:"json",url:i,data:n,onsuccess:function(e){if(typeof e=="undefined"||typeof e.status=="undefined"||e.status!="success"){hideRenderedSharingNodes(u);if(typeof e.status!="undefined"&&e.status=="error"&&typeof e.errorMessage!="undefined"){var s=new BX.PopupWindow("error_popup",BX("blg-post-inform-"+t),{lightShadow:true,offsetTop:-10,offsetLeft:100,autoHide:true,closeByEsc:true,closeIcon:{right:"5px",top:"5px"},draggable:{restrict:true},contentColor:"white",contentNoPaddings:true,bindOptions:{position:"bottom"},content:BX.create("DIV",{props:{className:"feed-create-task-popup-content"},children:[BX.create("DIV",{props:{className:"feed-create-task-popup-description"},text:e.errorMessage})]})});s.show()}}else{var i=e;BX.onCustomEvent(window,"OnUCAfterRecordAdd",["BLOG_"+t,e,i])}},onfailure:function(t){hideRenderedSharingNodes(u)}});closeSharing()};window.renderSharingPost=function(t){var e=[];var s="";var i=BX.findChildren(BX("feed-add-post-destination-item-post"),{className:"feed-add-post-destination"},true);if(i!=null){var o=BX("blog-destination-hidden-"+t);if(!o){var n=BX.findChildren(BX("blg-post-img-"+t),{className:"feed-add-post-destination-new"},true);var a=n[n.length-1]}for(var p=0;p<i.length;p++){if(!BX.hasClass(i[p],"feed-add-post-destination-undelete")){var r=BX.findChild(i[p],{className:"feed-add-post-destination-text"},false,false).innerHTML;var u=BX.findChild(i[p],{tag:"input"},false,false);var d=u.value;var l="feed-add-post-destination-new";if(BX.hasClass(i[p],"feed-add-post-destination-email")){l+=" feed-add-post-destination-new-email"}else if(BX.hasClass(i[p],"feed-add-post-destination-extranet")){l+=" feed-add-post-destination-new-extranet"}var h;if(u.name=="SPERM[SG][]")h="sonetgroups";else if(u.name=="SPERM[DR][]")h="department";else if(u.name=="SPERM[G][]")h="groups";else if(u.name=="SPERM[U][]")h="users";else if(u.name=="SPERM[UE][]")h="users";else if(u.name=="SPERM[UA][]")h="groups";if(h.length>0){window["postDest"+t].push({id:d,name:r,type:h});s="post_"+t+"_dest_"+d;e.push(s);var f=BX.create("span",{props:{id:s},children:[BX.create("span",{html:", "}),BX.create("a",{props:{className:l},href:"",html:r})]});if(o){o.appendChild(f)}else if(a){BX(a.parentNode).insertBefore(f,a.nextSibling)}}}}}return e};window.hideRenderedSharingNodes=function(t){var e=false;for(i=0;i<t.length;i++){e=t[i];if(BX(e)){BX.cleanNode(BX(e),true)}}};(function(){if(!!BX.SBPostManager)return false;BX.SBPostManager=function(){this.inited=false;this.tagLinkPattern=""};BX.SBPostManager.prototype.init=function(t){this.tagLinkPattern=BX.type.isNotEmptyString(t.tagLinkPattern)?t.tagLinkPattern:"";this.inited=true};BX.SBPostManager.prototype.clickTag=function(t){var e=false;if(BX.type.isNotEmptyString(t)&&BX.type.isNotEmptyString(this.tagLinkPattern)){top.location.href=this.tagLinkPattern.replace("#tag#",t);e=true}return e}})();if(typeof oSBPostManager=="undefined"){oSBPostManager=new BX.SBPostManager;window.oSBPostManager=oSBPostManager}
/* End */
;
; /* Start:"a:4:{s:4:"full";s:92:"/bitrix/components/bitrix/main.user.selector/templates/.default/script.min.js?15525565735871";s:6:"source";s:73:"/bitrix/components/bitrix/main.user.selector/templates/.default/script.js";s:3:"min";s:77:"/bitrix/components/bitrix/main.user.selector/templates/.default/script.min.js";s:3:"map";s:77:"/bitrix/components/bitrix/main.user.selector/templates/.default/script.map.js";}"*/
(function(){BX.namespace("BX.Main.User");if(BX.Main.User.Selector){return}function e(e){this.caller=e.caller;this.container=BX(e.containerId);this.id=e.id;this.containerId=e.containerId;this.inputName=e.inputName;this.inputId=e.inputName;this.isInputMultiple=e.isInputMultiple;this.inputNode=this.container.querySelector('input[name="'+e.inputName+'"]');this.useSymbolicId=e.useSymbolicId;this.openDialogWhenInit=!!e.openDialogWhenInit;this.selector=BX.UI.TileSelector.getById(this.id);if(!this.selector){throw new Error("Tile selector `"+this.id+"` not found.")}this.searchInputNode=this.selector.getSearchInput();if(!this.searchInputNode.id){this.searchInputNode.id=this.inputId+"-"+this.id+"-search-input"}this.lazyload=!!e.lazyload;BX.addCustomEvent(this.selector,this.selector.events.buttonSelect,this.openDialog.bind(this));BX.addCustomEvent(this.selector,this.selector.events.tileRemove,this.removeTile.bind(this));BX.Main.User.SelectorController.init(this)}e.prototype={openDialog:function(){if(this.lazyload){BX.onCustomEvent("BX.Main.SelectorV2:initDialog",[{selectorId:this.id,openDialogWhenInit:true}])}else{BX.Main.User.SelectorController.open(this)}},removeTile:function(e){this.unsetValue(e.id)},setUsers:function(e){e=e||[];if(this.isInputMultiple){this.addInputs(e)}else{this.inputNode.value=e.join(",")}},getUsers:function(){if(!this.isInputMultiple&&!this.inputNode){return[]}var e;if(this.isInputMultiple){e=this.getInputs().map(function(e){return e.value})}else{e=this.inputNode.value.split(",")}if(!this.useSymbolicId){return e.filter(function(e){e=parseInt(e);return!!e}).map(function(e){return parseInt(e)})}else{return e.filter(function(e){return e.length>0})}},setValue:function(e){if(!this.useSymbolicId){if(/^\d+$/.test(e)!==true){return}e=parseInt(e)}if(this.selectOne){this.setUsers([e])}else{var t=this.getUsers();if(!BX.util.in_array(e,t)){t.push(e)}this.setUsers(t)}},unsetValue:function(e){if(!this.useSymbolicId){if(/^\d+$/.test(e)!==true){return}e=parseInt(e)}if(this.selectOne){this.setUsers()}else{var t=this.getUsers().filter(function(t){return t!==e});this.setUsers(t)}},addInput:function(e){var t=document.createElement("input");t.type="hidden";t.name=this.inputName;t.value=e;this.container.insertBefore(t,this.container.firstElementChild)},addInputs:function(e){this.removeInputs();e.forEach(function(e){this.addInput(e)},this)},getInputs:function(){return BX.convert.nodeListToArray(this.container.querySelectorAll('input[name="'+this.inputName+'"]'))},removeInputs:function(){this.getInputs().forEach(function(e){BX.remove(e)})}};var t={list:[],init:function(e){this.list.push(e);BX.onCustomEvent(window,"BX.Main.User.SelectorController::init",[{id:e.id,inputId:e.searchInputNode.id,containerId:e.containerId,openDialogWhenInit:e.openDialogWhenInit}])},open:function(e){if(e.isOpen){return}if(BX.UI.SelectorManager){var t=BX.UI.SelectorManager.instances[e.id];if(t){if(!e.isInputMultiple){t.itemsSelected={}}e.getUsers().forEach(function(e){var i=null;for(var n in t.entities){if(t.entities.hasOwnProperty(n)&&BX.type.isNotEmptyObject(t.entities[n].items)){if(BX.util.in_array(e,Object.keys(t.entities[n].items))){i=n}}}if(i){t.itemsSelected[e]=i.toLowerCase()}});t.nodes.input=e.selector.input;t.nodes.tag=e.selector.buttonSelect}}e.isOpen=true;BX.onCustomEvent(window,"BX.Main.User.SelectorController::open",[{id:e.id,inputId:e.searchInputNode.id,containerId:e.containerId,bindNode:e.container}])},select:function(e){var t=BX.Main.User.SelectorController;var i=t.getUserSelector(e.selectorId);if(!i||!BX.type.isNotEmptyObject(e.item)){return}var n=i.useSymbolicId?e.item.id:e.item.entityId;if(BX.type.isNotEmptyObject(e.item.params)&&BX.type.isNotEmptyString(e.item.params.email)){n="UE"+n}i.setValue(n);var r={readonly:!!e.undeletable};if(BX.type.isNotEmptyString(e.entityType)){r.entityType=e.entityType}if(BX.type.isNotEmptyString(e.item.isExtranet)&&e.item.isExtranet=="Y"){r.extranet=true}if(BX.type.isNotEmptyString(e.item.isCrmEmail)&&e.item.isCrmEmail=="Y"){r.crmEmail=true}i.selector.addTile(e.item.name,r,n);i.selector.input.value="";i.selector.input.style.display="none";i.selector.buttonSelect.style.display="";BX.onCustomEvent("BX.Main.User.SelectorController:select",[{selectorId:e.selectorId,item:e.item,contextNode:i.selector.context}])},unSelect:function(e){var t=BX.Main.User.SelectorController;var i=t.getUserSelector(e.selectorId);if(!i||!BX.type.isNotEmptyObject(e.item)){return}var n=i.useSymbolicId?e.item.id:e.item.entityId;i.unsetValue(n);var r=i.selector.getTile(n);if(r){i.selector.removeTile(r)}if(BX.UI.SelectorManager){var s=BX.UI.SelectorManager.instances[e.selectorId];if(s){if(typeof s.deleteSelectedItem=="function"){s.deleteSelectedItem({itemId:e.item.id})}else{delete s.itemsSelected[e.item.id]}}}BX.onCustomEvent("BX.Main.User.SelectorController:unSelect",[{selectorId:e.selectorId,item:e.item,contextNode:i.selector.context}])},openDialog:function(e){var t=BX.Main.User.SelectorController;var i=t.getUserSelector(e.selectorId);if(!i){return}i.isOpen=true;if(i.selector){i.selector.input.style.display="";i.selector.buttonSelect.style.display="none";i.selector.input.focus()}},closeDialog:function(e){var t=BX.Main.User.SelectorController;var i=t.getUserSelector(e.selectorId);if(!i){return}i.isOpen=false;if(i.selector){i.selector.input.style.display="none";i.selector.buttonSelect.style.display=""}},openSearch:function(e){var t=BX.Main.User.SelectorController;var i=t.getUserSelector(e.selectorId);if(!i){return}i.isOpen=false;if(i.selector){i.selector.input.style.display="";i.selector.buttonSelect.style.display="none"}},closeSearch:function(e){},getUserSelector:function(e){var t=this.list.filter(function(t){return t.id===e});return t[0]}};if(!BX.Main.User.SelectorController){BX.Main.User.SelectorController=t}BX.Main.User.Selector=e})(window);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:91:"/bitrix/components/bitrix/ui.tile.selector/templates/.default/script.min.js?154962778012760";s:6:"source";s:71:"/bitrix/components/bitrix/ui.tile.selector/templates/.default/script.js";s:3:"min";s:75:"/bitrix/components/bitrix/ui.tile.selector/templates/.default/script.min.js";s:3:"map";s:75:"/bitrix/components/bitrix/ui.tile.selector/templates/.default/script.map.js";}"*/
(function(t){BX.namespace("BX.UI");if(BX.UI.TileSelector){return}var e=[];function i(t){this.id=t.id;this.name=t.name||null;this.node=t.node;this.data=t.data;this.removeNode=null;this.nameNode=o.getNode("tile-item-name",this.node);if(!this.name){this.name=this.nameNode.textContent}}i.prototype.changeRemoving=function(t){if(!this.removeNode){return}this.removeNode.style.display=t?"":"none"};function n(t){this.init(t)}n.prototype.events={containerClick:"container-click",tileClick:"tile-click",tileRemove:"tile-remove",tileEdit:"tile-edit",tileAdd:"tile-add",buttonAdd:"add",buttonSelect:"select",buttonSelectFirst:"select-first",search:"search",input:"input",searcherCategoryClick:"popup-category-click",searcherItemClick:"popup-item-click"};n.getById=function(t){var i=e.filter(function(e){return e.id===t});return i.length>0?i[0]:null};n.getList=function(){return e};n.prototype.init=function(t){this.list=[];this.id=t.id;this.context=BX(t.containerId);this.duplicates=t.duplicates;this.multiple=t.multiple;this.readonly=t.readonly;this.manualInputEnd=t.manualInputEnd;this.caption=t.caption;this.captionMore=t.captionMore;this.attributeId="data-bx-id";this.attributeData="data-bx-data";this.tileContainer=o.getNode("tile-container",this.context);this.tileTemplate=o.getNode("tile-template",this.context);this.input=o.getNode("tile-input",this.context);this.buttonAdd=o.getNode("tile-add",this.context);this.buttonSelect=o.getNode("tile-select",this.context);if(!this.context||!this.input){return}o.getNodes("tile-item",this.context).forEach(this.initNode.bind(this));if(!this.readonly){this.initEventHandlers()}this.searcher=null;e.push(this)};n.prototype.initEventHandlers=function(){if(this.buttonAdd){BX.bind(this.buttonAdd,"click",this.onButtonAdd.bind(this))}if(this.context){BX.bind(this.context,"click",this.onContainerClick.bind(this))}if(this.buttonSelect){BX.bind(this.buttonSelect,"click",this.onButtonSelect.bind(this));BX.bind(this.tileContainer,"click",this.onButtonSelect.bind(this))}BX.bind(this.input,"input",this.onInput.bind(this));if(!this.manualInputEnd){BX.bind(this.input,"blur",this.onInputEnd.bind(this));o.handleKeyEnter(this.input,this.onInputEnd.bind(this))}};n.prototype.getSearchInput=function(){return this.input};n.prototype.isSearcherInit=function(){return!!this.searcher};n.prototype.clearSearcher=function(){this.isButtonSelectFired=false;if(this.searcher){this.searcher.hide();this.searcher=null}};n.prototype.hideSearcher=function(){this.searcher.hide()};n.prototype.showSearcher=function(t){if(!this.searcher){this.searcher=new r({id:this.id,caller:this,context:this.context,title:t||""})}this.searcher.filterByName();this.searcher.show()};n.prototype.setSearcherData=function(t){if(!this.searcher){this.showSearcher()}this.searcher.setCategories(t)};n.prototype.initNode=function(t){if(!t){return null}var e=t.getAttribute(this.attributeId);var n=t.getAttribute(this.attributeData);try{n=JSON.parse(n)}catch(t){try{n=JSON.parse(BX.util.htmlspecialcharsback(n))}catch(t){n={}}}var r=new i({id:e,node:t,data:n});if(r.id&&!this.duplicates&&this.findDuplicates(r.id)){r=null;return null}r.removeNode=o.getNode("remove",t);if(r.removeNode){BX.bind(r.removeNode,"click",this.onRemove.bind(this,r))}BX.bind(t,"click",this.onClick.bind(this,r));this.list.push(r);return r};n.prototype.onRemove=function(t,e){e.preventDefault();e.stopPropagation();this.removeTile(t);if(BX.UI.SelectorManager){var i=BX.UI.SelectorManager.instances[this.id];if(i&&i.callback.unSelect){if(BX.type.isNotEmptyObject(t.data)&&BX.type.isNotEmptyString(t.data.entityType)){i.callback.unSelect({item:i.entities[t.data.entityType].items[t.id.match(/^\d+$/)?"U"+t.id:t.id],entityType:t.data.entityType,selectorId:i.id})}}}return false};n.prototype.onClick=function(t,e){e.preventDefault();e.stopPropagation();this.fire(this.events.tileClick,[t])};n.prototype.removeTiles=function(){var t=this.list;t.forEach(this.removeTile.bind(this))};n.prototype.removeTile=function(t){this.list=BX.util.deleteFromArray(this.list,this.list.indexOf(t));BX.remove(t.node);this.fire(this.events.tileRemove,[t]);this.recalcButtonSelectText()};n.prototype.getTile=function(t){var e=this.list.filter(function(e){return e.id===t});return e.length>0?e[0]:null};n.prototype.getTilesData=function(){return this.list.map(function(t){return t.data})};n.prototype.getTilesId=function(){return this.list.map(function(t){return t.id}).filter(function(t){return!!t})};n.prototype.getTiles=function(){return this.list};n.prototype.findDuplicates=function(t){var e=this.getTile(t);if(!e){return false}this.removeTile(e)};n.prototype.addTile=function(t,e,i,n,r){if(!t||this.readonly){return null}if(!this.multiple){this.removeTiles();if(this.isSearcherInit()){this.hideSearcher()}}e=e||{};i=i||"";r=r||"";n=n||"";var s=this.tileTemplate;if(!s){return null}s=s.innerHTML;var a="";if(r){a+="color: "+BX.util.htmlspecialchars(r)+"; "}if(n){a+="background-color: "+BX.util.htmlspecialchars(n)+"; "}var l=BX.type.isNotEmptyString(e.entityType)?e.entityType.toLowerCase():"none";if(!!e.extranet){l+="-extranet"}if(!!e.crmEmail){l+="-crm"}s=o.replace(s,{id:BX.util.htmlspecialchars(i+""),name:t,data:BX.util.htmlspecialchars(JSON.stringify(e)),style:a,type:l,readonly:!!e.readonly?"yes":"no"},true);var c=document.createElement("div");c.innerHTML=s;c=c.children[0];var h=this.initNode(c);if(!h){return null}this.input.parentNode.insertBefore(c,this.input);this.fire(this.events.tileAdd,[h]);this.recalcButtonSelectText();return h};n.prototype.updateTile=function(t,e,i,n,o){if(!t||this.readonly){return null}e=e||null;i=i||null;n=n||null;o=o||null;if(e){t.nameNode.textContent=e}if(i){t.data=i}if(n||n===null){t.node.style.backgroundColor=n}if(o){t.node.style.color=o}this.fire(this.events.tileEdit,[t]);return t};n.prototype.fire=function(t,e){BX.onCustomEvent(this,t,e)};n.prototype.onInput=function(){var t=this.input.value;if(this.searcher&&t.length>0){this.searcher.filterByName(t)}this.fire(this.events.input,[this.input.value])};n.prototype.onInputEnd=function(){var t=this.input.value;this.input.value="";o.changeDisplay(this.input,false);o.changeDisplay(this.buttonSelect,true);this.recalcButtonSelectText();this.fire(this.events.search,[t])};n.prototype.onButtonAdd=function(t){t.preventDefault();t.stopPropagation();this.fire(this.events.buttonAdd,[])};n.prototype.onContainerClick=function(){this.fire(this.events.containerClick,[])};n.prototype.onButtonSelect=function(t){t.preventDefault();t.stopPropagation();o.changeDisplay(this.buttonSelect,false);o.changeDisplay(this.input,true);this.input.focus();this.fire(this.events.buttonSelect,[]);if(!this.isButtonSelectFired){this.fire(this.events.buttonSelectFirst,[]);this.isButtonSelectFired=true}};n.prototype.recalcButtonSelectText=function(){if(!this.buttonSelect){return}var t=this.getTiles();this.buttonSelect.innerHTML=t.length>0?this.captionMore:this.caption};var o={getObjectByKey:function(t,e,i){var n=t.filter(function(t){return t.hasOwnProperty(e)&&t[e]===i});return n.length>0?n[0]:null},getNode:function(t,e){var i=this.getNodes(t,e);return i.length>0?i[0]:null},getNodes:function(t,e){if(!e){return[]}return BX.convert.nodeListToArray(e.querySelectorAll('[data-role="'+t+'"]'))},changeClass:function(t,e,i){if(!t){return}if(i){BX.addClass(t,e)}else{BX.removeClass(t,e)}},changeDisplay:function(t,e){if(!t){return}t.style.display=e?"":"none"},replace:function(t,e,i){e=e||{};i=i||false;if(!t){return""}for(var n in e){if(!e.hasOwnProperty(n)){continue}var o=e[n];o=o||"";if(!i&&o){o=BX.util.htmlspecialchars(o)}t=t.replace(new RegExp("%"+n+"%","g"),o)}return t},handleKeyEnter:function(e,i){if(!i){return}var n=function(e){e=e||t.event;if(e.keyCode===10||e.keyCode===13){e.preventDefault();e.stopPropagation();i();return false}};BX.bind(e,"keyup",n)},getTemplatedNode:function(t,e,i){if(!t){return null}var n=o.replace(t.innerHTML,e,i);var r=document.createElement("div");r.innerHTML=n;return r.children[0]}};function r(t){this.init(t)}r.prototype.classNameCategoryActive="ui-tile-selector-searcher-sidebar-item-selected";r.prototype.classNameItemActive="ui-tile-selector-searcher-content-item-selected";r.prototype.init=function(t){this.id=t.id;this.context=t.context;this.caller=t.caller;this.categories=[];this.items=[];this.currentCategory=null;this.categoryTemplate=o.getNode("popup-category-template",this.context);this.itemTemplate=o.getNode("popup-item-template",this.context);this.content=o.getTemplatedNode(o.getNode("popup-template",this.context));this.loader=o.getNode("popup-loader",this.content);this.categoryContainer=o.getNode("popup-category-list",this.content);this.itemContainer=o.getNode("popup-item-list",this.content);this.itemContainer.innerHTML="";this.categoryContainer.innerHTML="";this.title=o.getNode("popup-title",this.content);if(this.title){this.title.textContent=t.title}if(t.dataList){this.setCategories(t.dataList)}BX.addCustomEvent(this.caller,this.caller.events.tileAdd,this.onTileAdd.bind(this));BX.addCustomEvent(this.caller,this.caller.events.tileRemove,this.onTileRemove.bind(this))};r.prototype.onTileAdd=function(t){var e=o.getObjectByKey(this.items,"id",t.id);if(!e){return}o.changeClass(e.node,this.classNameItemActive,true)};r.prototype.onTileRemove=function(t){var e=o.getObjectByKey(this.items,"id",t.id);if(!e){return}o.changeClass(e.node,this.classNameItemActive,false)};r.prototype.filterByName=function(t){t=t||"";if(t.length<3){o.changeDisplay(this.categoryContainer,true);this.setCurrentCategory();return}var e=new RegExp(BX.util.escapeRegExp(t),"i");this.items.forEach(function(t){o.changeDisplay(t.node,e.test(t.name))});o.changeDisplay(this.categoryContainer,false)};r.prototype.onCategoryClick=function(t){this.setCurrentCategory(t);this.caller.fire(this.caller.events.searcherCategoryClick,[t])};r.prototype.setCurrentCategory=function(t){t=t||this.categories[0];if(this.currentCategory){BX.removeClass(this.currentCategory.node,this.classNameCategoryActive)}this.currentCategory=t;if(!t){return}BX.addClass(this.currentCategory.node,this.classNameCategoryActive);this.items.forEach(function(e){o.changeDisplay(e.node,e.category===t)})};r.prototype.onItemClick=function(t){this.caller.addTile(t.name,t.data,t.id,t.bgcolor,t.color);this.caller.fire(this.caller.events.searcherItemClick,[t])};r.prototype.getCategory=function(t){return o.getObjectByKey(this.categories,"id",t)};r.prototype.getItem=function(t){return o.getObjectByKey(this.items,"id",t)};r.prototype.updateItem=function(t,e,i){if(e){t.node.textContent=e;t.node.title=e}if(i){t.data=i}};r.prototype.addItem=function(t,e,i,n){var r=o.getTemplatedNode(this.itemTemplate,{name:i});var s={category:t,node:r,id:e,name:i,data:n||{}};this.items.push(s);this.itemContainer.appendChild(r);BX.bind(r,"click",this.onItemClick.bind(this,s));return s};r.prototype.setItems=function(t,e){this.items=[];e.forEach(function(e){this.addItem(t,e.id,e.name,e.data)},this)};r.prototype.addItems=function(t,e){e.forEach(function(e){this.addItem(t,e.id,e.name,e.data)},this)};r.prototype.addCategory=function(t,e,i,n){var r=o.getTemplatedNode(this.categoryTemplate,{name:e});var s={node:r,id:t,name:e,data:i||{}};this.categories.push(s);this.categoryContainer.appendChild(r);BX.bind(r,"click",this.onCategoryClick.bind(this,s));this.addItems(s,n);return s};r.prototype.setCategories=function(t){this.items=[];this.categories=[];this.itemContainer.innerHTML="";this.categoryContainer.innerHTML="";t.forEach(function(t){this.addCategory(t.id,t.name,t.data,t.items)},this);if(this.categories.length>0){this.setCurrentCategory(this.categories[0])}var e=this.caller.getTilesId();this.items.filter(function(t){var i=t.id&&BX.util.in_array(t.id,e);o.changeClass(t.node,this.classNameItemActive,i)},this);o.changeDisplay(this.loader,false);o.changeDisplay(this.itemContainer,true);o.changeDisplay(this.categoryContainer,true)};r.prototype.showLoader=function(){o.changeDisplay(this.loader,true)};r.prototype.hide=function(){if(!this.popup){return}this.popup.close()};r.prototype.show=function(){if(this.popup){this.popup.show();return}this.popup=BX.PopupWindowManager.create(this.id,this.context,{width:620,height:225,autoHide:true,lightShadow:true,closeByEsc:true,closeIcon:true,offsetLeft:40,angle:true});this.popup.setContent(this.content);o.changeDisplay(this.content,true);this.popup.show()};BX.UI.TileSelector=n;BX.addCustomEvent("BX.Main.SelectorV2:onGetDataStart",function(t){var e=BX("ui-tile-selector-"+t+"-mask");if(!e){return}e.classList.add("ui-tile-selector-selector-mask-active")});BX.addCustomEvent("BX.Main.SelectorV2:onGetDataFinish",function(t){var e=BX("ui-tile-selector-"+t+"-mask");if(!e){return}e.classList.remove("ui-tile-selector-selector-mask-active")})})(window);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:105:"/bitrix/components/bitrix/socialnetwork.blog.post.comment/templates/.default/script.min.js?15265632624339";s:6:"source";s:86:"/bitrix/components/bitrix/socialnetwork.blog.post.comment/templates/.default/script.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(){if(!!window.__blogEditComment)return;window.checkForQuote=function(e,i,o,t){if(window.mplCheckForQuote)mplCheckForQuote(e,i,o,t)};window.__blogLinkEntity=function(e,i){if(!!window["UC"]&&!!window["UC"]["f"+i]){window["UC"]["f"+i].linkEntity(e);for(var o in e){if(e.hasOwnProperty(o)){BX.bind(BX("blog-post-addc-add-"+e[o][1]),"click",BX.proxy(window["UC"][o].reply,window["UC"][o]));BX.bind(BX("blg-post-"+e[o][1]),"dragenter",BX.proxy(window["UC"][o].reply,window["UC"][o]));BX.addCustomEvent(window["UC"]["f"+i].eventNode,"OnUCFormBeforeShow",function(i){if(!!i&&!!i.id&&i.id[0]==o){BX.show(BX("blg-comment-"+e[o][1]))}})}}}};window.__blogEditComment=function(e,i){var o={messageBBCode:top["text"+e],messageFields:{arImages:top["arComFiles"+e],arDocs:top["arComDocs"+e],arFiles:top["arComFilesUf"+e],arDFiles:top["arComDFiles"+e],UrlPreview:top["UrlPreview"+e]}};BX.onCustomEvent(window,"OnUCAfterRecordEdit",["BLOG_"+i,e,o,"EDIT"])};window.__blogOnUCFormClear=function(e){LHEPostForm.reinitDataBefore(e.editorId)};window.__blogOnUCFormAfterShow=function(e,i,o){o=!!o?o:{};BX.onCustomEvent(window,"OnBeforeSocialnetworkCommentShowedUp",["socialnetwork_blog"]);var t={ENTITY_XML_ID:e.id[0],ENTITY_TYPE:e.entitiesId[e.id[0]][0],ENTITY_ID:e.entitiesId[e.id[0]][1],parentId:e.id[1],comment_post_id:e.entitiesId[e.id[0]][1],edit_id:e.id[1],act:e.id[1]>0?"edit":"add",logId:e.entitiesId[e.id[0]][2]};for(var n in t){if(!e.form[n])e.form.appendChild(BX.create("INPUT",{attrs:{name:n,type:"hidden"}}));e.form[n].value=t[n]}e.form.action=SBPC.actionUrl.replace(/#source_post_id#/,t["comment_post_id"]);var a=BX("captcha");if(!!a){BX.ajax.getCaptcha(function(e){BX("captcha_word").value="";BX("captcha_code").value=e["captcha_sid"];BX("captcha").src="/bitrix/tools/captcha.php?captcha_code="+e["captcha_sid"];BX("captcha").style.display=""})}onLightEditorShow(i,o)};window.__blogOnUCFormSubmit=function(e,i){i["decode"]="Y"};window.__blogOnUCAfterRecordAdd=function(e,i){if(i.errorMessage.length>0)return;if(BX("blg-post-inform-"+e.substr(5))){var o=BX.findChild(BX("blg-post-inform-"+e.substr(5)),{tag:"span",className:"feed-inform-follow"},true);if(o){var t=o.getAttribute("data-follow")=="Y"?"Y":"N";if(t=="N"){BX.findChild(o,{tagName:"a"}).innerHTML=BX.message("sonetBPFollowY");o.setAttribute("data-follow","Y")}}}};window.onLightEditorShow=function(e,i){var o={};if(i["arFiles"]){var t={},n,a;for(var r=0;r<i["arFiles"].length;r++){n=BX.findChild(BX("wdif-doc-"+i["arFiles"][r]),{className:"feed-com-file-name"},true);a=BX.findChild(BX("wdif-doc-"+i["arFiles"][r]),{className:"feed-con-file-size"},true);t["F"+r]={FILE_ID:i["arFiles"][r],FILE_NAME:n?n.innerHTML:"noname",FILE_SIZE:a?a.innerHTML:"unknown",CONTENT_TYPE:"notimage/xyz"}}o["UF_BLOG_COMMENT_DOC"]={USER_TYPE_ID:"file",FIELD_NAME:"UF_BLOG_COMMENT_DOC[]",VALUE:t}}if(i["arDocs"])o["UF_BLOG_COMMENT_FILE"]={USER_TYPE_ID:"webdav_element",FIELD_NAME:"UF_BLOG_COMMENT_FILE[]",VALUE:BX.clone(i["arDocs"])};if(i["arDFiles"])o["UF_BLOG_COMMENT_FILE"]={USER_TYPE_ID:"disk_file",FIELD_NAME:"UF_BLOG_COMMENT_FILE[]",VALUE:BX.clone(i["arDFiles"])};if(i["UrlPreview"])o["UF_BLOG_COMMENT_URL_PRV"]={USER_TYPE_ID:"url_preview",FIELD_NAME:"UF_BLOG_COMMENT_URL_PRV",VALUE:BX.clone(i["UrlPreview"])};LHEPostForm.reinitData(SBPC.editorId,e,o);if(i["arImages"]){var d,l=LHEPostForm.getHandler(SBPC.editorId),s="";for(var m in i["arImages"]){if(i["arImages"].hasOwnProperty(m)){d={id:i["arImages"][m]["id"],element_id:i["arImages"][m]["id"],element_name:i["arImages"][m]["name"],element_size:0,element_content_type:i["arImages"][m]["type"],element_url:i["arImages"][m]["src"],element_thumbnail:i["arImages"][m]["thumbnail"],element_image:i["arImages"][m]["src"],parser:"postimage",storage:"bfile"};var _=l.checkFile(d.id,"common",d,true)}}}};BX.SocialnetworkBlogPostComment={};BX.SocialnetworkBlogPostComment.registerViewAreaList=function(e){if(typeof e=="undefined"||typeof e.containerId=="undefined"||typeof e.className=="undefined"){return}if(BX(e.containerId)){var i=BX.findChildren(BX(e.containerId),{tag:"div",className:e.className},true),o=null;for(var t=0,n=i.length;t<n;t++){if(i[t].id.length>0){o=null;if(BX.type.isNotEmptyString(e.fullContentClassName)){o=BX.findChild(i[t],{className:e.fullContentClassName})}BX.UserContentView.registerViewArea(i[t].id,o?o:null)}}}}})(window);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:89:"/bitrix/components/bitrix/main.post.list/templates/.default/script.min.js?154900826738795";s:6:"source";s:69:"/bitrix/components/bitrix/main.post.list/templates/.default/script.js";s:3:"min";s:73:"/bitrix/components/bitrix/main.post.list/templates/.default/script.min.js";s:3:"map";s:73:"/bitrix/components/bitrix/main.post.list/templates/.default/script.map.js";}"*/
(function(){window["UC"]=window["UC"]||{};if(window["FCList"])return;var safeEditing=true,safeEditingCurrentObj=null,quoteData=null,repo={commentExemplarId:{}};window.FCList=function(e,t){this.CID=e["CID"];this.ENTITY_XML_ID=e["ENTITY_XML_ID"];this.container=e["container"];this.nav=e["nav"];this.mid=e["mid"];this.order=e["order"];this.status="ready";this.msg=!!this.nav?this.nav.innerHTML:"";this.params=t||{};this.pullNewRecords={};this.rights=e["rights"];this.DATE_TIME_FORMAT=this.params["DATE_TIME_FORMAT"]||null;this.comments={};this.bindEvents=[[this.nav,"click",BX.proxy(function(e){BX.eventCancelBubble(e);e.preventDefault();this.get();return false},this)]];this.exemplarId=BX.util.getRandomString(20);this.windowEvents={OnUCUserIsWriting:BX.delegate(function(t,i,s){if(this.ENTITY_XML_ID==t){BX.ajax({url:this.url.activity,method:"POST",data:{AJAX_POST:"Y",ENTITY_XML_ID:this.ENTITY_XML_ID,COMMENT_EXEMPLAR_ID:s,MODE:"PUSH&PULL",sessid:BX.bitrix_sessid(),sign:e["sign"],PATH_TO_USER:this.params["PATH_TO_USER"],AVATAR_SIZE:this.params["AVATAR_SIZE"],NAME_TEMPLATE:this.params["NAME_TEMPLATE"],SHOW_LOGIN:this.params["SHOW_LOGIN"]}})}},this),OnUCAfterRecordAdd:BX.delegate(function(e,t){if(this.ENTITY_XML_ID==e){this.add(t["messageId"],t,true,"simple")}},this),OnUCFormSubmit:BX.delegate(function(e,t,i,s){if(this.ENTITY_XML_ID==e){s["EXEMPLAR_ID"]=this.exemplarId;this.pullNewRecords[e+"-0"]="busy"}},this),OnUCFormResponse:BX.delegate(function(e,t){if(this.ENTITY_XML_ID==e){this.pullNewRecords[e+"-0"]="ready";this.pullNewRecords[e+"-"+t]="done"}},this),OnUCFormAfterShow:BX.delegate(function(e){if(typeof e.id!="undefined"&&this.ENTITY_XML_ID==e.id[0]){if(BX("record-"+this.ENTITY_XML_ID+"-new")){var t=BX.findParent(BX("record-"+this.ENTITY_XML_ID+"-new"),{className:"feed-comments-block"});if(t){BX.addClass(t,"feed-comments-block-editor-shown");var i=BX.findChild(t,{className:"feed-com-add-box-outer"},true);if(i){i.style.display=e.id[1]==0?"block":"none"}}}}},this),OnUCFormAfterHide:BX.delegate(function(e){if(this.ENTITY_XML_ID==e.id[0]){if(BX("record-"+this.ENTITY_XML_ID+"-new")){var t=BX.findParent(BX("record-"+this.ENTITY_XML_ID+"-new"),{className:"feed-comments-block"});if(t){BX.removeClass(t,"feed-comments-block-editor-shown");var i=BX.findChild(t,{className:"feed-com-add-box-outer"},true);if(i){i.style.display="block"}}}}},this),OnUCUserQuote:BX.delegate(function(e){if(this.ENTITY_XML_ID==e&&this.quote&&this.quote.popup){this.quote.popup.hide()}},this),"onPullEvent-unicomments":BX.delegate(function(e,t){if(this.ENTITY_XML_ID==t["ENTITY_XML_ID"]&&(t["USER_ID"]+""!=BX.message("USER_ID")+""||t["EXEMPLAR_ID"]&&t["EXEMPLAR_ID"]!=this.exemplarId||typeof t["AUX"]!="undefined"&&BX.util.in_array(t["AUX"],["createtask","fileversion"]))){if(e==="comment"&&t["ID"]){if(t["COMMENT_EXEMPLAR_ID"])repo.commentExemplarId[t["ENTITY_XML_ID"]+"_"+t["COMMENT_EXEMPLAR_ID"]]=true;this.pullNewRecord(t)}else if(e==="answer"&&t["USER_ID"]+""!==BX.message("USER_ID")+""&&(!t["COMMENT_EXEMPLAR_ID"]||repo.commentExemplarId[t["ENTITY_XML_ID"]+"_"+t["COMMENT_EXEMPLAR_ID"]]!==true)){this.pullNewAuthor(t["USER_ID"],t["NAME"],t["AVATAR"])}}},this)};if(this.params&&this.params["NOTIFY_TAG"]&&!!this.params["NOTIFY_TEXT"]&&!!window["UC"]["Informer"]){this.windowEvents["OnUCCommentWasPulled"]=BX.delegate(function(e,t){if(this.ENTITY_XML_ID==e[0]){window["UC"]["Informer"].check(e,t,this.params["NOTIFY_TAG"],this.params["NOTIFY_TEXT"])}},this);window["UC"]["InformerTags"][this.params["NOTIFY_TAG"]]=window["UC"]["InformerTags"][this.params["NOTIFY_TAG"]]||[]}var i;for(i=0;i<this.bindEvents.length;i++){BX.bind(this.bindEvents[i][0],this.bindEvents[i][1],this.bindEvents[i][2])}for(i in this.windowEvents){if(this.windowEvents.hasOwnProperty(i)){BX.addCustomEvent(window,i,this.windowEvents[i])}}var s=/%23com(\d+)/gi.exec(location.href),n=parseInt(location.hash&&location.hash.indexOf("#com")>=0?location.hash.replace("#com",""):s?s[1]:0);if(n>0)this.checkHash(n);if(this.params["BIND_VIEWER"]=="Y"&&BX["viewElementBind"]&&BX("record-"+this.ENTITY_XML_ID+"-new")){BX.viewElementBind(BX("record-"+this.ENTITY_XML_ID+"-new").parentNode,{},function(e){return BX.type.isElementNode(e)&&(e.getAttribute("data-bx-viewer")||e.getAttribute("data-bx-image"))})}this.init(e);if(this.mid>0&&BX("record-"+[this.ENTITY_XML_ID,this.mid].join("-")+"-cover")){var o=BX("record-"+[this.ENTITY_XML_ID,this.mid].join("-")+"-cover").parentNode.firstChild,a=new RegExp("record-("+this.ENTITY_XML_ID+")-([0-9]+)-cover","gi");while(BX(o)){if(o["hasAttribute"]&&o.hasAttribute("id")&&a.test(o.getAttribute("id"))){(o.getAttribute("id")+"").replace(a,function(e,t,i){traceForReading([t,i])})}o=o.nextSibling}}if(repo[this.ENTITY_XML_ID])repo[this.ENTITY_XML_ID].destroy();repo[this.ENTITY_XML_ID]=this;BX.ready(function(){setTimeout(BX.delegate(function(){BX.onCustomEvent(window,"OnUCHasBeenInitialized",[this.ENTITY_XML_ID,this])},this),100)});return this};window.FCList.prototype={url:{activity:"/bitrix/components/bitrix/main.post.list/activity.php"},destroy:function(){var e,t;while((t=this.bindEvents.pop())&&t){BX.unbindAll(t[0]);t[0]=null;t[2]=null}for(e in this.windowEvents){if(this.windowEvents.hasOwnProperty(e)){BX.removeCustomEvent(window,e,this.windowEvents[e]);this.windowEvents[e]=null}}this.windowEvents=null;delete repo[this.ENTITY_XML_ID];BX.onCustomEvent(window,"OnUCHasBeenDestroyed",[this.ENTITY_XML_ID,this])},init:function(){if(this.params["SHOW_POST_FORM"]=="Y"){this.quote.show=BX.delegate(function(e,t){setTimeout(BX.delegate(function(){this.quoteShow(e,t)},this),50)},this);var e=BX("record-"+this.ENTITY_XML_ID+"-new"),t=BX.findChildren(e.parentNode,{tagName:"DIV",className:"feed-com-block-cover"},false);t=!!t?t:[];t.push(e);if(!!this.container)t.push(this.container);for(var i=0;i<t.length;i++){BX.bind(t[i],"mouseup",this.quote.show)}var s=BX("record-"+this.ENTITY_XML_ID+"-switcher");if(s&&!s.bxDndIsBound){s.bxDndIsBound="Y";BX.bind(s,"dragenter",BX.delegate(this.reply,this))}BX.addCustomEvent(window,"onQuote"+this.ENTITY_XML_ID,this.quote.show)}},quote:{show:BX.DoNothing(),popup:null},quoteCheck:function(){var e="",t,i=null;if(window.getSelection){t=window.getSelection();e=t.toString()}else if(document.selection){t=document.selection;e=t.createRange().text}if(e!=""){var s=BX("record-"+this.ENTITY_XML_ID+"-new"),n=BX.findParent(t.focusNode,{tagName:"DIV",className:"feed-com-block-cover"},s.parentNode),o=BX.findParent(t.anchorNode,{tagName:"DIV",className:"feed-com-block-cover"},s.parentNode);if(n!=o||BX(n)&&!n.hasAttribute("id")){e=""}else if(BX(n)){var a=BX(n.getAttribute("id").replace(/\-cover$/,"-actions-reply"));if(a){i={id:parseInt(a.getAttribute("bx-mpl-author-id")),name:a.getAttribute("bx-mpl-author-name"),gender:a.getAttribute("bx-mpl-author-gender")}}}}if(e==""){if(!!this.quote.popup)this.quote.popup.hide();return false}return{text:e,author:i}},quoteShow:function(e,t){t=t||this.quoteCheck();if(!t||!t["text"]){quoteData=null;return}quoteData=t;if(this.quote.popup==null){this.quote.popup=new MPLQuote({id:this.ENTITY_XML_ID,closeByEsc:true,autoHide:true,autoHideTimeout:2500,events:{click:BX.delegate(function(e){e.preventDefault();BX.eventCancelBubble(e);safeEditingCurrentObj=safeEditing;BX.onCustomEvent(window,"OnUCUserQuote",[this.ENTITY_XML_ID,t["author"],t["text"],safeEditingCurrentObj]);this.quote.popup.hide();return false},this)},classEvents:{onQuoteHide:BX.proxy(function(){quoteData=null;this.quote.popup=null},this)}})}this.quote.popup.show(e)},display:function(e,t){var i=0,s=0,n=0,o=this.container;e=e=="hide"?"hide":"show";if(e=="hide"){i=parseInt(this.container.offsetHeight);n=i/2e3;n=n<.3?.3:n>.5?.5:n;o.style.overflow="hidden";new BX["easing"]({duration:n*1e3,start:{height:i,opacity:100},finish:{height:s,opacity:0},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(e){o.style.maxHeight=e.height+"px";o.style.opacity=e.opacity/100},complete:BX.proxy(function(){o.style.cssText="";o.style.display="none";BX.onCustomEvent(this,"OnUCListWasHidden",[this,[],o])},this)}).animate()}else{i=parseInt(t||20);o.style.display="block";o.style.overflow="hidden";o.style.maxHeight=i;s=parseInt(this.container.offsetHeight);n=(s-i)/(2e3-i);n=n<.3?.3:n>.8?.8:n;new BX["easing"]({duration:n*1e3,start:{height:i,opacity:i>0?100:0},finish:{height:s,opacity:100},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(e){o.style.maxHeight=e.height+"px";o.style.opacity=e.opacity/100},complete:BX.proxy(function(){o.style.cssText="";o.style.maxHeight="none";BX.onCustomEvent(this,"OnUCListWasShown",[this,[],o])},this)}).animate()}},get:function(){if(this.status=="done"){if(this.nav.getAttribute("bx-visibility-status")=="visible"){this.display("hide");BX.adjust(this.nav,{attrs:{"bx-visibility-status":"none"},html:this.msg})}else{this.display("show");BX.adjust(this.nav,{attrs:{"bx-visibility-status":"visible"},html:BX.message("BLOG_C_HIDE")})}}else if(this.status=="ready"){this.send()}return false},send:function(){this.status="busy";BX.addClass(this.nav,"feed-com-all-hover");var e=BX.ajax.prepareData({AJAX_POST:"Y",ENTITY_XML_ID:this.ENTITY_XML_ID,MODE:"LIST",FILTER:this.order=="ASC"?{">ID":this.mid}:{"<ID":this.mid},sessid:BX.bitrix_sessid()}),t=BX.util.htmlspecialcharsback(this.nav.getAttribute("href"));t=t.indexOf("#")!==-1?t.substr(0,t.indexOf("#")):t;var i={url:t,data:e};BX.onCustomEvent(this,"OnUCListHasToBeEnlarged",[this,i]);t=i.url;e=i.data;BX.ajax({url:t+(t.indexOf("?")!==-1?"&":"?")+e,method:"GET",dataType:"json",data:"",onsuccess:BX.proxy(this.build,this),onfailure:BX.proxy(this.complete,this)})},build:function(e){this.status="ready";this.wait("hide");BX.removeClass(this.nav,"feed-com-all-hover");if(!!e&&e["status"]=="success"){var t=!!e["navigation"]?BX.create("DIV",{html:e["navigation"]}):null,i=BX.processHTML(e["messageList"],false);var s=this.container.offsetHeight,n=BX.create("DIV",{html:i.HTML});if(this.order=="ASC"||!this.container.firstChild){this.container.appendChild(n)}else{this.container.insertBefore(n,this.container.firstChild)}BX.onCustomEvent(window,"OnUCFeedChanged",[[this.ENTITY_XML_ID,this.mid]]);this.display("show",s);if(!!t)t=t.firstChild;if(!!t)BX.adjust(this.nav,{attrs:{href:t.getAttribute("href")},html:t.innerHTML});else{BX.adjust(this.nav,{attrs:{href:"#","bx-visibility-status":"visible"},html:BX.message("BLOG_C_HIDE"),events:{click:function(e){BX.eventCancelBubble(e);e.preventDefault();return false}}});this.status="done"}var o=0,a=BX.delegate(function(){o++;if(o<100){if(this.container.childNodes.length>0){BX.ajax.processScripts(i.SCRIPT);var t=n.firstChild,s=n.lastChild,r=0,d=0;if(t&&t.hasAttribute("id")){r=parseInt(t.getAttribute("id").replace("record-"+this.ENTITY_XML_ID+"-","").replace("-cover",""));r=r>0?r:0}if(s&&s.hasAttribute("id")){d=parseInt(s.getAttribute("id").replace("record-"+this.ENTITY_XML_ID+"-","").replace("-cover",""));d=d>0?d:0}if(r>d){d=d+r;r=d-r;d=d-r}n.setAttribute("bx-mpl-min",r+"");n.setAttribute("bx-mpl-max",d+"");n.setAttribute("bx-mpl-loaded","Y");this.recalcMoreButtonsList(n);BX.onCustomEvent(this,"OnUCListWasBuilt",[this,e,n])}else BX.defer(a)()}},this);BX.defer(a)()}},complete:function(){this.status="done";BX.removeClass(this.nav,"feed-com-all-hover");this.wait("hide")},wait:function(e){e=e=="show"?"show":"hide";return e},reply:function(e){safeEditingCurrentObj=safeEditing;if(BX.type.isElementNode(e))BX.onCustomEvent(window,"OnUCUserReply",[this.ENTITY_XML_ID,e.getAttribute("bx-mpl-author-id"),e.getAttribute("bx-mpl-author-name"),safeEditingCurrentObj]);else BX.onCustomEvent(window,"OnUCUserReply",[this.ENTITY_XML_ID,undefined,undefined,safeEditingCurrentObj])},add:function(e,t,i,s){if(!(!!t&&!!e&&parseInt(e[1])>0))return false;var n=BX("record-"+e.join("-")+"-cover"),o=!!t["message"]?t["message"]:window.fcParseTemplate({messageFields:t["messageFields"]},{RIGHTS:this.rights,DATE_TIME_FORMAT:this.DATE_TIME_FORMAT,VIEW_URL:this.params.VIEW_URL,EDIT_URL:this.params.EDIT_URL,MODERATE_URL:this.params.MODERATE_URL,DELETE_URL:this.params.DELETE_URL,AUTHOR_URL:this.params.AUTHOR_URL,AUTHOR_URL_PARAMS:this.params.AUTHOR_URL_PARAMS,NAME_TEMPLATE:this.params.NAME_TEMPLATE,SHOW_LOGIN:this.params.SHOW_LOGIN},this.getTemplate()),a=BX.processHTML(o,false),r,d=BX("record-"+e[0]+"-new"),l=["MODERATE","EDIT","DELETE"],c=false,h=0;for(var u in l){if(l.hasOwnProperty(u)){if(this.rights[l[u]]=="OWNLAST"){c=true;break}}}if(c){r=!!d.lastChild&&d.lastChild.className=="feed-com-block-cover"?[d.lastChild]:[];var T,E;if(this.addCheckPreviousNodes!==true){r=BX.findChildren(d.parentNode,{tagName:"DIV",className:"feed-com-block-cover"},false);var m=BX.findChildren(d,{tagName:"DIV",className:"feed-com-block-cover"},false);r=!!r?r:[];m=!!m?m:[];while(m.length>0&&(T=m.pop())&&!!T)r.push(T);this.addCheckPreviousNodes=true}while((T=r.pop())&&T){E=BX(T.id.replace("-cover","-actions"));if(!!E){if(this.rights["EDIT"]=="OWNLAST")E.setAttribute("bx-mpl-edit-show","N");if(this.rights["MODERATE"]=="OWNLAST")E.setAttribute("bx-mpl-moderate-show","N");if(this.rights["DELETE"]=="OWNLAST")E.setAttribute("bx-mpl-delete-show","N")}}}var p=false;if(!n){n=BX.create("DIV",{attrs:{id:"record-"+e.join("-")+"-cover",className:"feed-com-block-cover"},style:{opacity:0,height:0,overflow:"hidden"},html:a.HTML});d.appendChild(n);p=true}else{var f=BX.create("DIV",{attrs:{id:"record-"+e.join("-")+"-cover",className:"feed-com-block-cover"},style:{display:"none"},html:a.HTML}),_=n,X=BX.findChild(_,{tag:"div",className:"feed-com-text-inner"},true),I=X&&X.classList.contains("feed-com-text-inner-expanded");if(I){X=BX.findChild(f,{tag:"div",className:"feed-com-text-inner"},true);if(X){X.classList.add("feed-com-text-inner-expanded")}}n.parentNode.insertBefore(f,n);n.removeAttribute("id");h=n.scrollHeight;BX.hide(n);BX.show(f);n=f;setTimeout(function(){BX.remove(_)},1e3)}if(s!=="simple"&&typeof BXMobileApp=="undefined"){var B=BX.pos(n),A=BX.GetWindowScrollPos(),R=BX.GetWindowInnerSize();new BX["easing"]({duration:1e3,start:{opacity:p?0:100,height:h},finish:{opacity:100,height:n.scrollHeight},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(e){n.style.height=e.height+"px";n.style.opacity=e.opacity/100;if(A.scrollTop>0&&B.top<A.scrollTop+R.innerHeight){window.scrollTo(0,A.scrollTop+e.height)}},complete:function(){n.style.cssText=""}}).animate()}else{new BX["easing"]({duration:500,start:{opacity:p?0:100,height:h},finish:{opacity:100,height:n.scrollHeight},transition:BX.easing.makeEaseOut(BX.easing.transitions.cubic),step:function(e){n.style.height=e.height+"px";n.style.opacity=e.opacity/100},complete:BX.proxy(function(){n.style.cssText="";BX.onCustomEvent(this,"OnUCRecordWasShown",[this.ENTITY_XML_ID,e,n])},this)}).animate()}var w=0,g=function(){w++;if(w<100){var i=BX("record-"+e.join("-")+"-cover");if(i&&i.childNodes.length>0){BX.ajax.processScripts(a.SCRIPT);if(this.params["BIND_VIEWER"]=="Y"&&BX["viewElementBind"]){BX.viewElementBind(i,{},function(e){return BX.type.isElementNode(e)&&(e.getAttribute("data-bx-viewer")||e.getAttribute("data-bx-image"))})}this.recalcMoreButton(this.findMoreButton(i))}else{BX.defer(g,this)()}}BX.onCustomEvent(window,"OnUCRecordHasDrawn",[this.ENTITY_XML_ID,e,t["messageFields"]]);BX.onCustomEvent(window,"OnUCFeedChanged",[e])};BX.defer(g,this)();return true},findMoreButton:function(e){return false},recalcMoreButton:function(e){return false},recalcMoreButtonsList:function(e){return false},pullNewAuthor:function(e,t,i){BX.onCustomEvent(window,"OnUCUsersAreWriting",[this.ENTITY_XML_ID,e,t,i])},pullNewRecord:function(e){var t=[this.ENTITY_XML_ID,parseInt(e["ID"])];if(!!this.pullNewRecords[t.join("-")]&&this.pullNewRecords[t.join("-")]=="busy")return true;else if(!!this.pullNewRecords[t[0]+"-0"]&&this.pullNewRecords[t[0]+"-0"]=="busy")return setTimeout(BX.proxy(function(){this.pullNewRecord(e)},this),100);BX.onCustomEvent(window,"OnUCBeforeCommentWillBePulled",[t,e]);if(e["NEED_REQUEST"]=="Y"){if(e["URL"]["LINK"].indexOf("#GROUPS_PATH#")>=0&&!!BX.message("MPL_WORKGROUPS_PATH"))e["URL"]["LINK"]=e["URL"]["LINK"].replace("#GROUPS_PATH#",BX.message("MPL_WORKGROUPS_PATH"));this.pullNewRecords[t.join("-")]="busy";var i=BX.ajax.prepareData({AJAX_POST:"Y",ENTITY_XML_ID:this.ENTITY_XML_ID,MODE:"RECORD",FILTER:{ID:e["ID"]},sessid:BX.bitrix_sessid()}),s=e["URL"]["LINK"];s=s.indexOf("#")!==-1?s.substr(0,s.indexOf("#")):s;BX.ajax({url:s+(s.indexOf("?")!==-1?"&":"?")+i,method:"GET",dataType:"json",data:"",onsuccess:BX.delegate(function(i){if(!!BX("record-"+t.join("-")+"-cover"))return;this.add([this.ENTITY_XML_ID,parseInt(e["ID"])],i);var s=BX("record-"+t.join("-")+"-cover"),n=BX.findChild(s,{className:"feed-com-main-content"},true,false);BX.addClass(s,"comment-new-answer");BX.addClass(n,"feed-com-block-pointer-to-new feed-com-block-new");this.pullNewRecords[t.join("-")]="done";if(BX("record-"+t[0]+"-corner")){BX.addClass(BX("record-"+t[0]+"-corner"),BX.hasClass(n,"feed-com-block-new")?"feed-post-block-yellow-corner":"");BX("record-"+t[0]+"-corner").removeAttribute("id")}BX.onCustomEvent(window,"OnUCCommentWasPulled",[t,i])},this)})}else if(e["ACTION"]=="DELETE"){if(BX("record-"+this.ENTITY_XML_ID+"-"+e["ID"]))BX.fx.hide(BX("record-"+this.ENTITY_XML_ID+"-"+e["ID"]),"scroll",{time:.2});BX.onCustomEvent(window,"OnUCommentWasDeleted",[this.ENTITY_XML_ID,[this.ENTITY_XML_ID,e["ID"]],e]);BX.onCustomEvent(window,"OnUCFeedChanged",[e["ID"]])}else if(e["ACTION"]=="HIDE"){var n=BX("record-"+this.ENTITY_XML_ID+"-"+e["ID"]),o=n?BX.findChild(n,{tagName:"DIV",className:"feed-com-block"},true):null;if(BX(o)){if(BX.hasClass(o,"blog-comment-user-"+BX.message("USER_ID"))){BX.removeClass(o,"feed-com-block-approved");BX.addClass(o,"feed-com-block-hidden")}else{BX.fx.hide(n,"scroll",{time:.2});BX.onCustomEvent(window,"OnUCommentWasHidden",[this.ENTITY_XML_ID,[this.ENTITY_XML_ID,e["ID"]],e]);BX.onCustomEvent(window,"OnUCFeedChanged",[e["ID"]])}}}else if(e["ACTION"]=="EDIT"&&!BX("record-"+this.ENTITY_XML_ID+"-"+e["ID"])){BX.DoNothing()}else{if(e&&!(e["AUTHOR"]&&e["AUTHOR"]["ID"]+""==BX.message("USER_ID")+""))e["NEW"]="Y";this.add(t,{messageFields:e});var a=BX("record-"+t.join("-")+"-cover"),r=BX.findChild(a,{className:"feed-com-main-content"},true,false);if(BX("record-"+t[0]+"-corner")){BX.addClass(BX("record-"+t[0]+"-corner"),e["NEW"]=="Y"?"feed-post-block-yellow-corner":"");BX("record-"+t[0]+"-corner").removeAttribute("id")}BX.addClass(a,"comment-new-answer");if(e["NEW"]=="Y"){BX.addClass(r,"feed-com-block-pointer-to-new feed-com-block-new")}this.pullNewRecords[t.join("-")]="done";BX.onCustomEvent(window,"OnUCCommentWasPulled",[t,{messageFields:e}])}return true},act:function(url,id,act){if(url.substr(0,1)!="/"){try{eval(url);return false}catch(e){}if(BX.type.isFunction(url)){url(this,id,act);return false}}this.showWait(id);act=act==="EDIT"?"EDIT":act==="DELETE"?"DELETE":"MODERATE";id=parseInt(id);var data=BX.ajax.prepareData({sessid:BX.bitrix_sessid(),MODE:"RECORD",NOREDIRECT:"Y",AJAX_POST:"Y",FILTER:{ID:id},ENTITY_XML_ID:this.ENTITY_XML_ID});url=url.indexOf("#")!==-1?url.substr(0,url.indexOf("#")):url;BX.ajax({method:"GET",url:url+(url.indexOf("?")!==-1?"&":"?")+data,data:"",dataType:"json",onsuccess:BX.proxy(function(e){this.closeWait(id);if(e["status"]=="error"){this.showError(id,e["message"]||"Unknown error.")}else{if(act!=="EDIT"){var t=BX("record-"+this.ENTITY_XML_ID+"-"+id+"-cover");if(!!e["message"]&&!!t){var i=BX.processHTML(e["message"],false);t.innerHTML=i.HTML;var s=0,n=function(){s++;if(s<100){if(t.childNodes.length>0)BX.ajax.processScripts(i.SCRIPT);else BX.defer(n)()}};BX.defer(n)();e["okMessage"]=""}else if(act=="DELETE"&&!!e["okMessage"]){BX.hide(BX("record-"+this.ENTITY_XML_ID+"-"+id));BX.onCustomEvent(window,"OnUCommentWasDeleted",[this.ENTITY_XML_ID,[this.ENTITY_XML_ID,id]])}}BX.onCustomEvent(window,"OnUCAfterRecordEdit",[this.ENTITY_XML_ID,id,e,act]);BX.onCustomEvent(window,"OnUCFeedChanged",[id])}this.busy=false},this),onfailure:BX.delegate(function(e){this.closeWait(id);this.showError(id,e)},this)});return false},showError:function(e,t){if(this.errorWindow)this.errorWindow.close();this.errorWindow=new BX.PopupWindow("bx-comments-error",null,{autoHide:false,zIndex:200,overlay:{opacity:50,backgroundColor:"#000000"},buttons:[new BX.PopupWindowButton({text:BX.message("MPL_CLOSE"),events:{click:BX.delegate(function(){if(this.errorWindow)this.errorWindow.close()},this)}})],closeByEsc:true,titleBar:{content:BX.create("span",{props:{className:"popup-window-titlebar-text feed-error-title"},html:'<div class="feed-error-icon"></div>'+BX.message("MPL_ERROR_OCCURRED")})},closeIcon:true,contentColor:"white",content:'<div class="feed-error-block">'+t+"</div>"});this.errorWindow.show()},checkHash:function(e){var t=[this.ENTITY_XML_ID,e],i=BX("record-"+t.join("-")+"-cover");if(!!i){var s=BX.pos(i);window.scrollTo(0,s["top"]);i=BX.findChild(i,{className:"feed-com-main-content"},true,false);BX.removeClass(i,"feed-com-block-pointer-to-new feed-com-block-new");BX.addClass(i,"feed-com-block-pointer")}},getTemplate:function(){return BX.message("MPL_RECORD_TEMPLATE")},showWait:function(e){window.fcShowWait(BX("record-"+this.ENTITY_XML_ID+"-"+e+"-actions"))},closeWait:function(e){window.fcCloseWait(BX("record-"+this.ENTITY_XML_ID+"-"+e+"-actions")||null)}};window.FCList.getQuoteData=function(){return quoteData};window.FCList.getInstance=function(e,t){if(!repo[e["ENTITY_XML_ID"]])new window.FCList(e,t);return repo[e["ENTITY_XML_ID"]]};var lastWaitElement=null;window["fcShowWait"]=function(e){if(e&&!BX.type.isElementNode(e))e=null;e=e||this;if(BX.type.isElementNode(e)){BX.defer(function(){e.disabled=true})();var t=BX.findParent(e,BX.is_relative);e.bxwaiter=(t||document.body).appendChild(BX.create("DIV",{props:{className:"feed-com-loader"},style:{position:"absolute"}}));lastWaitElement=e;return e.bxwaiter}return true};window["fcCloseWait"]=function(e){if(e&&!BX.type.isElementNode(e))e=null;e=e||lastWaitElement||this;if(BX.type.isElementNode(e)){if(e.bxwaiter&&e.bxwaiter.parentNode){e.bxwaiter.parentNode.removeChild(e.bxwaiter);e.bxwaiter=null}e.disabled=false;if(lastWaitElement==e)lastWaitElement=null}};window["fcShowActions"]=function(e,t,i){var s=[];if(i.getAttribute("bx-mpl-view-show")=="Y"){s.push({text:BX.message("MPL_MES_HREF"),href:i.getAttribute("bx-mpl-view-url").replace(/\\#(.+)$/gi,"")+"#com"+t});s.push({text:'<span id="record-popup-'+e+"-"+t+'-link-text">'+BX.message("B_B_MS_LINK")+"</span>"+'<span id="record-popup-'+e+"-"+t+'-link-icon-animate" class="comment-menu-link-icon-wrap">'+'<span class="comment-menu-link-icon" id="record-popup-'+e+"-"+t+'-link-icon-done" style="display: none;">'+"</span>"+"</span>",onclick:function(){var s="record-popup-"+e+"-"+t+"-link",n=i.getAttribute("bx-mpl-view-url").replace(/#(.+)$/gi,"")+"#com"+t,o=BX(s+"-text"),a=BX(s+"-icon-done");n=(n.indexOf("http")<0?location.protocol+"//"+location.host:"")+n;if(BX.clipboard.isCopySupported()){if(o&&o.getAttribute("data-block-click")=="Y"){return}BX.clipboard.copy(n);if(o&&a){a.style.display="inline-block";BX.removeClass(BX(s+"-icon-animate"),"comment-menu-link-icon-animate");BX.adjust(BX(s+"-text"),{attrs:{"data-block-click":"Y"}});setTimeout(function(){BX.addClass(BX(s+"-icon-animate"),"comment-menu-link-icon-animate")},1);setTimeout(function(){BX.adjust(BX(s+"-text"),{attrs:{"data-block-click":"N"}})},500)}return}var r=BX.proxy_context,d=parseInt(!!r.getAttribute("bx-height")?r.getAttribute("bx-height"):r.offsetHeight);if(r.getAttribute("bx-status")!="shown"){r.setAttribute("bx-status","shown");if(!BX(s)&&!!BX(s+"-text")){var l=BX(s+"-text"),c=BX.pos(l),h=BX.pos(l.parentNode),u=BX.findChildren(l.parentNode.parentNode.parentNode,{className:"menu-popup-item-text"},true);c["height"]=h["height"]-1;if(u){var T=0,E;for(var m=0;m<u.length;m++){E=BX.pos(u[m]);T=Math.max(T,E["width"])}h["width"]=T}BX.adjust(r,{attrs:{"bx-height":r.offsetHeight},style:{overflow:"hidden",display:"block"},children:[BX.create("BR"),BX.create("DIV",{attrs:{id:s},children:[BX.create("SPAN",{attrs:{className:"menu-popup-item-left"}}),BX.create("SPAN",{attrs:{className:"menu-popup-item-icon"}}),BX.create("SPAN",{attrs:{className:"menu-popup-item-text"},children:[BX.create("INPUT",{attrs:{id:s+"-input",type:"text",value:n},style:{height:h["height"]+"px",width:h["width"]+"px"},events:{click:function(e){this.select();e.preventDefault()}}})]})]}),BX.create("SPAN",{className:"menu-popup-item-right"})]})}new BX["fx"]({time:.2,step:.05,type:"linear",start:d,finish:d*2,callback:BX.delegate(function(e){this.style.height=e+"px"},r)}).start();BX.fx.show(BX(s),.2);BX(s+"-input").select()}else{r.setAttribute("bx-status","hidden");new BX["fx"]({time:.2,step:.05,type:"linear",start:r.offsetHeight,finish:d,callback:BX.delegate(function(e){this.style.height=e+"px"},r)}).start();BX.fx.hide(BX(s),.2)}}})}if(i.getAttribute("bx-mpl-edit-show")=="Y")s.push({text:BX.message("BPC_MES_EDIT"),onclick:function(){window["UC"][e].act(i.getAttribute("bx-mpl-edit-url"),t,"EDIT");this.popupWindow.close();return false}});if(i.getAttribute("bx-mpl-moderate-show")=="Y"){var n=i.getAttribute("bx-mpl-moderate-approved")=="hidden";s.push({text:n?BX.message("BPC_MES_SHOW"):BX.message("BPC_MES_HIDE"),onclick:function(){var s=i.getAttribute("bx-mpl-moderate-url").replace("#action#",n?"show":"hide").replace("#ACTION#",n?"SHOW":"HIDE");if(BX.type.isNotEmptyString(s)){s=BX.util.add_url_param(s,{b24statAction:n?"showComment":"hideComment"})}window["UC"][e].act(s,t,"MODERATE");this.popupWindow.close()}})}if(i.getAttribute("bx-mpl-delete-show")=="Y"){s.push({text:BX.message("BPC_MES_DELETE"),onclick:function(){if(window.confirm(BX.message("BPC_MES_DELETE_POST_CONFIRM")))window["UC"][e].act(i.getAttribute("bx-mpl-delete-url"),t,"DELETE");this.popupWindow.close();return false}})}if(i.getAttribute("bx-mpl-createtask-show")=="Y"&&typeof oLF!="undefined"){var o=i.getAttribute("bx-mpl-comment-entity-type"),a=i.getAttribute("bx-mpl-post-entity-type");s.push({text:BX.message("BPC_MES_CREATE_TASK"),onclick:function(){oLF.createTask({postEntityType:BX.type.isNotEmptyString(a)?a:"BLOG_POST",entityType:BX.type.isNotEmptyString(o)?o:"BLOG_COMMENT",entityId:t});this.popupWindow.close();return false}})}if(s.length>0){for(var r in s){if(s.hasOwnProperty(r)){s[r]["className"]="blog-comment-popup-menu"}}BX.PopupMenu.show("action-"+e+"-"+t,i,s,{offsetLeft:-18,offsetTop:2,lightShadow:false,angle:{position:"top",offset:50},events:{onPopupClose:function(){this.destroy();BX.PopupMenu.Data["action-"+e+"-"+t]=null}}})}};window["fcCommentExpand"]=function(e){BX.UI.Animations.expand({moreButtonNode:e,type:"comment",classBlock:"feed-com-block",classOuter:"feed-com-text-inner",classInner:"feed-com-text-inner-inner",heightLimit:200,callback:function(e){BX.onCustomEvent(window,"OnUCRecordWasExpanded",[e]);e.classList.add("feed-com-text-inner-expanded");var t=e.getAttribute("bx-content-view-xml-id");if(BX.type.isNotEmptyString(t)){BX.onCustomEvent(window,"OnUCFeedChanged",[t.split("-")])}}})};window["fcParseTemplate"]=function(e,t,i){t=t||{};t["RIGHTS"]=t["RIGHTS"]||{};for(var s=0,n=["MODERATE","EDIT","DELETE"];s<n.length;s++){t["RIGHTS"][n[s]]=BX.util.in_array(t["RIGHTS"][n[s]],["Y","ALL","OWN","OWNLAST"])?t["RIGHTS"][n[s]]:"N"}t["DATE_TIME_FORMAT"]=!!t["DATE_TIME_FORMAT"]?t["DATE_TIME_FORMAT"]:"d F Y G:i";t["TIME_FORMAT"]=!!t["DATE_TIME_FORMAT"]&&t["DATE_TIME_FORMAT"].indexOf("a")>=0?"g:i a":"G:i";t["VIEW_URL"]=t["VIEW_URL"]||"";t["EDIT_URL"]=t["EDIT_URL"]||"";t["MODERATE_URL"]=t["MODERATE_URL"]||"";t["DELETE_URL"]=t["DELETE_URL"]||"";t["AUTHOR_URL"]=t["AUTHOR_URL"]||"";t["NAME_TEMPLATE"]=t["NAME_TEMPLATE"]||"";t["SHOW_LOGIN"]=t["SHOW_LOGIN"]||"";var o=e&&e["messageFields"]?e["messageFields"]:e,a={ID:"",FULL_ID:"",CONTENT_ID:"",ENTITY_XML_ID:"",NEW:"old",APPROVED:"Y",DATE:"",TEXT:"",CLASSNAME:"",VIEW_URL:"",VIEW_SHOW:"N",EDIT_URL:"",EDIT_SHOW:"N",MODERATE_URL:"",MODERATE_SHOW:"N",DELETE_URL:"",DELETE_SHOW:"N",CREATETASK_SHOW:"N",BEFORE_HEADER:"",BEFORE_ACTIONS:"",AFTER_ACTIONS:"",AFTER_HEADER:"",BEFORE:"",AFTER:"",BEFORE_RECORD:"",AFTER_RECORD:"",AUTHOR_ID:0,AUTHOR_AVATAR_IS:"N",AUTHOR_AVATAR:"",AUTHOR_URL:"",AUTHOR_NAME:"",AUTHOR_EXTRANET_STYLE:"",SHOW_POST_FORM:"Y",VOTE_ID:"",AUTHOR_TOOLTIP_PARAMS:"","background:url('') no-repeat center;":"",LIKE_REACT:"",RATING_NONEMPTY_CLASS:""};if(!!o&&!!e["messageFields"]){o["AUTHOR"]=!!o["AUTHOR"]?o["AUTHOR"]:{};var r=parseInt(o["POST_TIMESTAMP"])+parseInt(BX.message("USER_TZ_OFFSET"))+parseInt(BX.message("SERVER_TZ_OFFSET"));var d=[["today",t["TIME_FORMAT"]],["yesterday",t["TIME_FORMAT"].indexOf("yesterday")<0?"yesterday, "+t["TIME_FORMAT"]:t["TIME_FORMAT"]],["",t["DATE_TIME_FORMAT"]]];var l="";if(typeof o["AUTHOR"]["TYPE"]!="undefined"){if(o["AUTHOR"]["TYPE"]=="EMAIL"){l=" feed-com-name-email"}else if(o["AUTHOR"]["TYPE"]=="EXTRANET"){l=" feed-com-name-extranet"}}else if(o["AUTHOR"]["IS_EXTRANET"]=="Y"){l=" feed-com-name-extranet"}var c=!!o.AUX&&o.AUX.length>0?BX.CommentAux.getLiveText(o.AUX,!!o.AUX_LIVE_PARAMS?o.AUX_LIVE_PARAMS:{}):o["POST_MESSAGE_TEXT"].replace(/\001/gi,"").replace(/#/gi,"");a={ID:o["ID"],FULL_ID:o["FULL_ID"].join("-"),CONTENT_ID:o["RATING"]&&o["RATING"]["ENTITY_TYPE_ID"]&&o["RATING"]["ENTITY_ID"]?o["RATING"]["ENTITY_TYPE_ID"]+"-"+o["RATING"]["ENTITY_ID"]:"",ENTITY_XML_ID:o["ENTITY_XML_ID"],NEW:o["NEW"]=="Y"?"new":"old",APPROVED:o["APPROVED"]!="Y"?"hidden":"approved",DATE:BX.date.format(d,r,parseInt(Date.now()/1e3)+parseInt(BX.message("USER_TZ_OFFSET"))+parseInt(BX.message("SERVER_TZ_OFFSET")),true),TEXT:c,CLASSNAME:o["CLASSNAME"]?" "+o["CLASSNAME"]:"",VIEW_URL:t["VIEW_URL"].replace("#ID#",o["ID"]).replace("#id#",o["ID"]),VIEW_SHOW:t["VIEW_URL"]!==""?"Y":"N",EDIT_URL:t["EDIT_URL"].replace("#ID#",o["ID"]).replace("#id#",o["ID"]),EDIT_SHOW:(!o.AUX||o.AUX.length<=0)&&(t["RIGHTS"]["EDIT"]=="Y"||t["RIGHTS"]["EDIT"]=="ALL"||t["RIGHTS"]["EDIT"]=="OWN"&&BX.message("USER_ID")==o["AUTHOR"]["ID"])?"Y":"N",MODERATE_URL:t["MODERATE_URL"].replace("#ID#",o["ID"]).replace("#id#",o["ID"]),MODERATE_SHOW:t["RIGHTS"]["MODERATE"]=="Y"||t["RIGHTS"]["MODERATE"]=="ALL"||t["RIGHTS"]["MODERATE"]=="OWN"&&BX.message("USER_ID")==o["AUTHOR"]["ID"]?"Y":"N",DELETE_URL:t["DELETE_URL"].replace("#ID#",o["ID"]).replace("#id#",o["ID"]),DELETE_SHOW:t["RIGHTS"]["DELETE"]=="Y"||t["RIGHTS"]["DELETE"]=="ALL"||t["RIGHTS"]["DELETE"]=="OWN"&&BX.message("USER_ID")==o["AUTHOR"]["ID"]?"Y":"N",CREATETASK_SHOW:(!o.AUX||o.AUX.length<=0)&&t["RIGHTS"]["CREATETASK"]=="Y"?"Y":"N",BEFORE_HEADER:o["BEFORE_HEADER"],BEFORE_ACTIONS:o["BEFORE_ACTIONS"],AFTER_ACTIONS:o["AFTER_ACTIONS"],AFTER_HEADER:o["AFTER_HEADER"],BEFORE:o["BEFORE"],AFTER:o["AFTER"],BEFORE_RECORD:o["BEFORE_RECORD"],AFTER_RECORD:o["AFTER_RECORD"],AUTHOR_ID:o["AUTHOR"]["ID"],AUTHOR_AVATAR_IS:!!o["AUTHOR"]["AVATAR"]?"Y":"N",AUTHOR_AVATAR:!!o["AUTHOR"]["AVATAR"]?o["AUTHOR"]["AVATAR"]:"/bitrix/images/1.gif",AUTHOR_AVATAR_BG:!!o["AUTHOR"]["AVATAR"]?"background-image:url('"+o["AUTHOR"]["AVATAR"]+"')":"",AUTHOR_URL:t["AUTHOR_URL"].replace("#ID#",o["ID"]).replace("#id#",o["ID"]).replace("#USER_ID#",o["AUTHOR"]["ID"]).replace("#user_id#",o["AUTHOR"]["ID"])+(typeof o["AUTHOR"]["EXTERNAL_AUTH_ID"]!="undefined"&&o["AUTHOR"]["EXTERNAL_AUTH_ID"]=="email"&&typeof t["AUTHOR_URL_PARAMS"]!="undefined"?(t["AUTHOR_URL"].indexOf("?")>=0?"&":"?")+"entityType="+t["AUTHOR_URL_PARAMS"]["entityType"]+"&entityId="+t["AUTHOR_URL_PARAMS"]["entityId"]:""),AUTHOR_NAME:BX.formatName(o["AUTHOR"],t["NAME_TEMPLATE"],t["SHOW_LOGIN"]),AUTHOR_EXTRANET_STYLE:l,VOTE_ID:o["RATING"]&&o["RATING"]["VOTE_ID"]?o["RATING"]["VOTE_ID"]:"",AUTHOR_PERSONAL_GENDER:BX.type.isNotEmptyString(o["AUTHOR"]["PERSONAL_GENDER"])?o["AUTHOR"]["PERSONAL_GENDER"]:"",AUTHOR_TOOLTIP_PARAMS:typeof o["AUTHOR_TOOLTIP_PARAMS"]!="undefined"?o["AUTHOR_TOOLTIP_PARAMS"]:"{}","background:url('') no-repeat center;":"",LIKE_REACT:!!o["LIKE_REACT"]?o["LIKE_REACT"]:"",RATING_NONEMPTY_CLASS:o["RATING"]&&o["RATING"]["TOTAL_VOTES"]?"comment-block-rating-nonempty":"",POST_ENTITY_TYPE:!!o["POST_CONTENT_TYPE_ID"]?o["POST_CONTENT_TYPE_ID"]:"",COMMENT_ENTITY_TYPE:!!o["COMMENT_CONTENT_TYPE_ID"]?o["COMMENT_CONTENT_TYPE_ID"]:""}}else{for(s in a){if(a.hasOwnProperty(s)){a[s]=!!e[s]?e[s]:a[s]}}}for(s in a){if(a.hasOwnProperty(s)){a[s]=!!a[s]?a[s]:""}}a["SHOW_POST_FORM"]=BX("record-"+a["ENTITY_XML_ID"]+"-0-placeholder")?"Y":"N";for(var h in a){if(a.hasOwnProperty(h)){i=i.replace(new RegExp("#"+h+"#","g"),function(){return a[this]}.bind(h))}}return i.replace("background:url('') no-repeat center;","").replace(/\001/gi,"#")};window["fcPull"]=function(e,t){BX.ajax({url:"/bitrix/components/bitrix/main.post.list/templates/.default/component_epilog.php",method:"POST",data:{AJAX_POST:"Y",ENTITY_XML_ID:e,MODE:"PUSH&PULL",sessid:BX.bitrix_sessid(),DATA:t}})};var newCommentsToCheckForReading={data:[],screen:{},timeout:0},traceForReading=function(e){newCommentsToCheckForReading.data.push(e);newCommentsToCheckForReading.screen=newCommentsToCheckForReading.screen||{scrollTop:BX.GetWindowScrollPos().scrollTop,time:(new Date).getTime()};newCommentsToCheckForReading.screen["checked"]=false;newCommentsToCheckForReading.timeout=newCommentsToCheckForReading.timeout||setTimeout(markReadComments,1e3)};BX.addCustomEvent(window,"OnUCRecordHasDrawn",function(e,t){traceForReading(t)});var markReadComments=function(){var e=BX.GetWindowScrollPos();if(e.scrollTop!=newCommentsToCheckForReading.screen["scrollTop"]){newCommentsToCheckForReading.screen["time"]=(new Date).getTime();newCommentsToCheckForReading.screen["scrollTop"]=e.scrollTop;newCommentsToCheckForReading.screen["checked"]=false}else if(!newCommentsToCheckForReading.screen["checked"]&&(new Date).getTime()-newCommentsToCheckForReading.screen["time"]>3e3){newCommentsToCheckForReading.screen["time"]=(new Date).getTime();newCommentsToCheckForReading.screen["checked"]=true;var t=0,i=BX.GetWindowInnerSize(),s=[],n,o,a,r,d,l;for(r=0;r<newCommentsToCheckForReading.data.length;r++){n=BX("record-"+newCommentsToCheckForReading.data[r].join("-")+"-cover");if(n){o=BX.pos(n);if(o.top>=e.scrollTop&&o.top<=e.scrollTop+i.innerHeight-20){BX.onCustomEvent(window,"OnUCCommentWasRead",[newCommentsToCheckForReading.data[r],n]);BX.removeClass(n,"comment-new-answer");d=BX.findParent(n,{className:"feed-comments-block"});if(d){l=BX.findChild(d,{className:"feed-com-corner"});if(l){BX.addClass(l,"feed-post-block-corner-fade")}}a=BX.findChild(n,{className:"feed-com-main-content"},true,false);BX.removeClass(a,"feed-com-block-pointer-to-new feed-com-block-new");BX.addClass(a,"feed-com-block-read");t++}else{s.push(newCommentsToCheckForReading.data[r])}}}newCommentsToCheckForReading.data=s;if(t>0)BX.onCustomEvent(window,"onCounterDecrement",[t])}if(newCommentsToCheckForReading.data.length>0)newCommentsToCheckForReading.timeout=setTimeout(markReadComments,1e3);else{newCommentsToCheckForReading.timeout=0}};var MPLQuote=function(e){this.params=e;this.id=e["id"];this.closeByEsc=!!e["closeByEsc"];this.autoHide=!!e["autoHide"];this.autoHideTimeout=!!e["autoHideTimeout"]?parseInt(e["autoHideTimeout"]):0;if(this.params.classEvents){for(var t in this.params.classEvents)if(this.params.classEvents.hasOwnProperty(t))BX.addCustomEvent(this,t,this.params.classEvents[t])}this.node=document.createElement("A");BX.adjust(this.node,{props:{id:this.id},style:{zIndex:BX.PopupWindow.getOption("popupZindex")+this.params.zIndex,position:"absolute",display:"none",top:"0px",left:"0px"},attrs:{className:"mpl-quote-block",href:"#"},events:this.params.events});document.body.appendChild(this.node)};MPLQuote.prototype={show:function(e){var t=this.getPosition(this.node,e);BX.adjust(this.node,{style:{top:t.y+"px",left:t.x+"px",display:"block"}});BX.addClass(this.node,"mpl-quote-block-show");if(this.closeByEsc&&!this.isCloseByEscBinded){this.isCloseByEscBinded=BX.delegate(this._onKeyUp,this);BX.bind(document,"keyup",this.isCloseByEscBinded)}if(this.params.autoHide&&!this.isAutoHideBinded){setTimeout(BX.proxy(function(){BX.bind(this.node,"click",this.cancelBubble);this.isAutoHideBinded=BX.delegate(this.hide,this);BX.bind(document,"click",this.isAutoHideBinded)},this),0)}if(this.autoHideTimeout>0&&this.autoHideTimeoutInt<=0){if(!this.autoHideTimeoutBinded)this.autoHideTimeoutBinded=BX.delegate(this.hide,this);this.autoHideTimeoutInt=setTimeout(this.autoHideTimeoutBinded,this.autoHideTimeout)}},hide:function(e){if(!this.isShown())return;if(e&&!(BX.getEventButton(e)&BX.MSLEFT))return;this.node.style.display="none";if(this.isCloseByEscBinded){BX.unbind(document,"keyup",this.isCloseByEscBinded);this.isCloseByEscBinded=false}if(this.autoHideTimeout>0){clearTimeout(this.autoHideTimeoutInt);this.autoHideTimeoutInt=0}setTimeout(BX.proxy(this._hide,this),0)},_hide:function(){BX.onCustomEvent(this,"onQuoteHide",[this]);if(this.params.autoHide&&this.isAutoHideBinded){BX.unbind(this.node,"click",this.cancelBubble);BX.unbind(document,"click",this.isAutoHideBinded);this.isAutoHideBinded=false}BX.remove(this.node)},getPosition:function(e,t){var i;if(t.pageX==null){var s=document.documentElement,n=document.body;var o=t.clientX+(s&&s.scrollLeft||n&&n.scrollLeft||0)-(s.clientLeft||0);var a=t.clientY+(s&&s.scrollTop||n&&n.scrollTop||0)-(s.clientTop||0);i={x:o,y:a}}else{i={x:t.pageX,y:t.pageY}}return{x:i.x+5,y:i.y-16}},isShown:function(){return this.node.style.display=="block"},cancelBubble:function(e){if(!e)e=window.event;if(e.stopPropagation)e.stopPropagation();else e.cancelBubble=true},_onKeyUp:function(e){e=e||window.event;if(e.keyCode==27)this.hide(e)}};window.mplCheckForQuote=function(e,t,i,s){e=document.all?window.event:e;var n="",o,a=null;if(window.getSelection){o=window.getSelection();n=o.toString()}else if(document.selection){o=document.selection;n=o.createRange().text}if(n!=""){var r=BX.findParent(o.focusNode,{tagName:t.tagName,className:t.className},t),d=BX.findParent(o.anchorNode,{tagName:t.tagName,className:t.className},t);if(r!=d||r!=t){n=""}else{if(!!s&&BX(s,true)){var l=BX(s,true);if(!!l&&l.hasAttribute("bx-post-author-id")){a={id:parseInt(l.getAttribute("bx-post-author-id")),gender:l.getAttribute("bx-post-author-gender"),name:l.innerHTML}}}}}if(n!=""){BX.onCustomEvent(window,"onQuote"+i,[e,{text:n,author:a}]);return true}return false};window.mplReplaceUserPath=function(e){if(typeof e!="string"||e.length<=0){return""}if(BX("MPL_IS_EXTRANET_SITE")=="Y"){e=e.replace("/company/personal/user/","/extranet/contacts/personal/user/")}else{e=e.replace("/extranet/contacts/personal/user/","/company/personal/user/")}e=e.replace(new RegExp("[\\w/]*/mobile/users/\\?user_id=(\\d+)","igm"),BX("MPL_IS_EXTRANET_SITE")=="Y"?"/extranet/contacts/personal/user/$1/":"/company/personal/user/$1/");return e};BX.onCustomEvent("main.post.list/default",["script.js"])})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:99:"/bitrix/components/bitrix/main.post.list/templates/.default/scripts_for_form.min.js?155255657315739";s:6:"source";s:79:"/bitrix/components/bitrix/main.post.list/templates/.default/scripts_for_form.js";s:3:"min";s:83:"/bitrix/components/bitrix/main.post.list/templates/.default/scripts_for_form.min.js";s:3:"map";s:83:"/bitrix/components/bitrix/main.post.list/templates/.default/scripts_for_form.map.js";}"*/
(function(){window["UC"]=window["UC"]||{};if(!!window["FCForm"])return;window.FCForm=function(e){this.url="";this.lhe="";this.entitiesId={};this.form=BX(e["formId"]);this.handler=window.LHEPostForm.getHandler(e["editorId"]);this.editorName=e["editorName"];this.editorId=e["editorId"];this.windowEvents={OnUCUnlinkForm:BX.delegate(function(e){if(!!e&&!!this.entitiesId[e]){var t={},i=true;for(var s in this.entitiesId){if(this.entitiesId.hasOwnProperty(s)&&s!=e){i=false;t[s]=this.entitiesId[s]}}this.entitiesId=t;if(i&&!!this.windowEvents){for(s in this.windowEvents){if(this.windowEvents.hasOwnProperty(s)&&s)BX.removeCustomEvent(window,s,this.windowEvents[s])}this.windowEventsSet=false}}},this),OnUCUserQuote:BX.delegate(function(e,t,i,s,n){var o=BX.util.htmlspecialchars(i);if(this.entitiesId[e]){if(!this._checkTextSafety([e,0],s))return;this.show([e,0]);if(n!==true){this.handler.exec(this.windowEvents.OnUCUserQuote,[e,t,i,s,true])}else if(!this.handler.oEditor.toolbar.controls.Quote){BX.DoNothing()}else if(!t&&!i){this.handler.oEditor.action.Exec("quote")}else{i=o;var r=t.gender?BX.message("MPL_HAVE_WRITTEN_"+t.gender):BX.message("MPL_HAVE_WRITTEN");if(this.handler.oEditor.GetViewMode()=="wysiwyg"){i=i.replace(/\n/g,"<br/>");if(t){if(t.id>0){t='<span id="'+this.handler.oEditor.SetBxTag(false,{tag:"postuser",params:{value:t.id}})+'" class="bxhtmled-metion">'+t.name.replace(/</gi,"&lt;").replace(/>/gi,"&gt;")+"</span>"}else{t="<span>"+t.name.replace(/</gi,"&lt;").replace(/>/gi,"&gt;")+"</span>"}t=t!==""?t+r+"<br/>":"";i=t+i}}else if(this.handler.oEditor.bbCode){if(t){if(t.id>0){t="[USER="+t.id+"]"+t.name+"[/USER]"}else{t=t.name}t=t!==""?t+r+"\n":"";i=t+i}}if(this.handler.oEditor.action.actions.quote.setExternalSelectionFromRange){this.handler.oEditor.action.actions.quote.setExternalSelectionFromRange();var a=this.handler.oEditor.action.actions.quote.getExternalSelection();if(a===""&&o!==""){a=o}a=(BX.type.isNotEmptyString(t)?t:"")+a;if(BX.type.isNotEmptyString(a))this.handler.oEditor.action.actions.quote.setExternalSelection(a)}else{this.handler.oEditor.action.actions.quote.setExternalSelection(i)}this.handler.oEditor.action.Exec("quote")}}},this),OnUCUserReply:BX.delegate(function(e,t,i,s){if(!this._checkTextSafety([e,0],s))return;if(this.entitiesId[e]){this.show([e,0]);if(t>0){this.handler.exec(window.BxInsertMention,[{item:{entityId:t,name:i},type:"users",formID:this.form.id,editorId:this.editorId,bNeedComa:true,insertHtml:true}])}}},this),OnUCAfterRecordEdit:BX.delegate(function(e,t,i,s){if(!!this.entitiesId[e]){if(s==="EDIT"){this.show([e,t],i["messageBBCode"],i["messageFields"]);this.editing=true}else{this.hide(true);if(!!i["errorMessage"]){this.id=[e,t];this.showError(i["errorMessage"])}else if(!!i["okMessage"]){this.id=[e,t];this.showNote(i["okMessage"]);this.id=null}}}},this),OnUCUsersAreWriting:BX.delegate(function(e,t,i,s,n){if(!!this.entitiesId[e]){this.showAnswering([e,0],t,i,s,n)}},this),OnUCRecordHasDrawn:BX.delegate(function(e,t,i){if(!!this.entitiesId[e]){var s=parseInt(i&&i["AUTHOR"]?i["AUTHOR"]["ID"]:0);if(s>0)this.hideAnswering([e,0],s)}},this)};this.linkEntity(e["entitiesId"]);BX.remove(BX("micro"+e["editorName"]));BX.remove(BX("micro"+e["editorId"]));this.eventNode=this.handler.eventNode;if(this.eventNode){BX.addCustomEvent(this.eventNode,"OnBeforeHideLHE",BX.delegate(function(){BX.removeClass(document.documentElement,"bx-ios-fix-frame-focus");if(top&&top["document"])BX.removeClass(top["document"]["documentElement"],"bx-ios-fix-frame-focus");if(!!this.id&&!!BX("uc-writing-"+this.form.id+"-"+this.id[0]+"-area")){BX.hide(BX("uc-writing-"+this.form.id+"-"+this.id[0]+"-area"))}},this));BX.addCustomEvent(this.eventNode,"OnAfterHideLHE",BX.delegate(function(){var e=this._getPlacehoder();if(e){BX.hide(e)}e=this._getSwitcher();if(e){BX.show(e);BX.focus(e.firstChild)}this.__content_length=0;if(!!this.id){BX.onCustomEvent(this.eventNode,"OnUCFormAfterHide",[this]);this.showAnswering(this.id)}clearTimeout(this._checkWriteTimeout);this._checkWriteTimeout=0;this.clear();BX.onCustomEvent(window,"OnUCFeedChanged",[this.id])},this));BX.addCustomEvent(this.eventNode,"OnBeforeShowLHE",BX.delegate(function(){if(BX.browser.IsIOS()&&BX.browser.IsMobile()){BX.addClass(window["document"]["documentElement"],"bx-ios-fix-frame-focus");if(top&&top["document"])BX.addClass(top["document"]["documentElement"],"bx-ios-fix-frame-focus")}var e=this._getPlacehoder();if(e){BX.removeClass(e,"feed-com-add-box-no-form");BX.removeClass(e,"feed-com-add-box-header");BX.show(e)}e=this._getSwitcher();if(e){BX.hide(e)}if(!!this.id&&!!BX("uc-writing-"+this.form.id+"-"+this.id[0]+"-area")){BX.hide(BX("uc-writing-"+this.form.id+"-"+this.id[0]+"-area"))}},this));BX.addCustomEvent(this.eventNode,"OnAfterShowLHE",BX.delegate(function(e,t){this._checkWrite(e,t);if(!!this.id)this.showAnswering(this.id);BX.onCustomEvent(window,"OnUCFeedChanged",[this.id])},this));BX.addCustomEvent(this.eventNode,"OnClickSubmit",BX.delegate(this.submit,this));BX.addCustomEvent(this.eventNode,"OnClickCancel",BX.delegate(this.cancel,this));BX.onCustomEvent(this.eventNode,"OnUCFormInit",[this])}this.id=null;this.jsCommentId=null;BX.addCustomEvent(window,"OnImageDataUriHandle",BX.delegate(this.showWait,this));BX.addCustomEvent(window,"OnImageDataUriCaughtUploaded",BX.delegate(this.closeWait,this));BX.addCustomEvent(window,"OnImageDataUriCaughtFailed",BX.delegate(this.closeWait,this))};window.FCForm.prototype={linkEntity:function(e){if(!!e){for(var t in e){if(e.hasOwnProperty(t)){BX.onCustomEvent(window,"OnUCUnlinkForm",[t]);this.entitiesId[t]=e[t]}}}if(!this.windowEventsSet&&!!this.entitiesId){BX.addCustomEvent(window,"OnUCUnlinkForm",this.windowEvents.OnUCUnlinkForm);BX.addCustomEvent(window,"OnUCUserReply",this.windowEvents.OnUCUserReply);BX.addCustomEvent(window,"OnUCUserQuote",this.windowEvents.OnUCUserQuote);BX.addCustomEvent(window,"OnUCAfterRecordEdit",this.windowEvents.OnUCAfterRecordEdit);BX.addCustomEvent(window,"OnUCUsersAreWriting",this.windowEvents.OnUCUsersAreWriting);BX.addCustomEvent(window,"OnUCRecordHasDrawn",this.windowEvents.OnUCRecordHasDrawn);this.windowEventsSet=true}},_checkTextSafety:function(e,t){if(t===true){t=e;if(this.id&&this.id.join("-")!=e.join("-")&&this.handler.editorIsLoaded&&this.handler.oEditor.IsContentChanged())return window.confirm(BX.message("MPL_SAFE_EDIT"));return true}return t===false},_checkWrite:function(e,t){if(this.handler.editorIsLoaded&&this._checkWriteTimeout!==false){this.__content_length=this.__content_length>0?this.__content_length:0;var i=this.handler.oEditor.GetContent(),s=BX.delegate(function(){this._checkWrite(e,t)},this),n=2e3;if(i.length>=4&&this.__content_length!=i.length&&!!this.id){BX.onCustomEvent(window,"OnUCUserIsWriting",[this.id[0],this.id[1],this.jsCommentId]);n=3e4}this._checkWriteTimeout=setTimeout(s,n);this.__content_length=i.length}},_getPlacehoder:function(e){e=!!e?e:this.id;return!!e?BX("record-"+e.join("-")+"-placeholder"):null},_getSwitcher:function(e){e=!!e?e:this.id;return!!e?BX("record-"+e[0]+"-switcher"):null},hide:function(e){if(this.eventNode.style.display!="none"){BX.onCustomEvent(this.eventNode,"OnShowLHE",[e===true?false:"hide"])}if(e){document.body.appendChild(this.form)}},clear:function(){this.editing=false;var e=this._getPlacehoder();if(!!e)BX.hide(e);var t=BX.findChildren(e,{tagName:"DIV",className:"feed-add-error"},true);if(!!t){e=t.pop();do{BX.remove(e)}while((e=t.pop())&&e)}BX.onCustomEvent(this.eventNode,"OnUCFormClear",[this]);var i=BX.findChild(this.form,{className:"wduf-placeholder-tbody"},true,false);if(i!==null&&typeof i!="undefined")BX.cleanNode(i,false);i=BX.findChild(this.form,{className:"wduf-selectdialog"},true,false);if(i!==null&&typeof i!="undefined")BX.hide(i);i=BX.findChild(this.form,{className:"file-placeholder-tbody"},true,false);if(i!==null&&typeof i!="undefined")BX.cleanNode(i,false);this.id=null;this.jsCommentId=null},show:function(e,t,i){if(this.id&&!!e&&this.id.join("-")==e.join("-")){var s=this._getPlacehoder(e);this.handler.oEditor.Focus();setTimeout(function(){s.scrollIntoView(false)},100);return true}else{this.hide(true)}this.id=e;this.jsCommentId=BX.util.getRandomString(20);var n=this._getPlacehoder();BX.removeClass(n,"feed-com-add-box-no-form");BX.removeClass(n,"feed-com-add-box-header");n.appendChild(this.form);BX.onCustomEvent(this.eventNode,"OnUCFormBeforeShow",[this,t,i]);BX.onCustomEvent(this.eventNode,"OnShowLHE",["show"]);BX.onCustomEvent(this.eventNode,"OnUCFormAfterShow",[this,t,i]);return true},submit:function(){if(this.busy===true)return"busy";var e=this.handler.editorIsLoaded?this.handler.oEditor.GetContent():"";if(!e){this.showError(BX.message("JERROR_NO_MESSAGE"));return false}this.showWait();this.busy=true;var t={};window.convertFormToArray(this.form,t);t["REVIEW_TEXT"]=e;t["NOREDIRECT"]="Y";t["MODE"]="RECORD";t["AJAX_POST"]="Y";t["id"]=this.id;if(this.jsCommentId!==null)t["COMMENT_EXEMPLAR_ID"]=this.jsCommentId;t["SITE_ID"]=BX.message("SITE_ID");t["LANGUAGE_ID"]=BX.message("LANGUAGE_ID");if(this.editing===true){t["REVIEW_ACTION"]="EDIT";t["FILTER"]={ID:this.id[1]}}BX.onCustomEvent(this.eventNode,"OnUCFormSubmit",[this,t]);BX.onCustomEvent(window,"OnUCFormSubmit",[this.id[0],this.id[1],this,t]);var i=this.form.action;i=BX.util.remove_url_param(i,["b24statAction"]);i=BX.util.add_url_param(i,{b24statAction:this.id[1]>0?"editComment":"addComment"});this.form.action=i;BX.ajax({method:"POST",url:this.form.action,data:t,dataType:"json",onsuccess:BX.proxy(function(e){this.closeWait();var t=e,i=this.id[0];BX.onCustomEvent(this.eventNode,"OnUCFormResponse",[this,e]);if(!!this.OnUCFormResponseData)e=this.OnUCFormResponseData;if(!!e){if(e["errorMessage"]){this.showError(e["errorMessage"])}else if(e["status"]=="error"){this.showError(BX.type.isNotEmptyString(e["message"])?e["message"]:"")}else{BX.onCustomEvent(window,"OnUCAfterRecordAdd",[this.id[0],e,t]);this.hide(true)}}this.busy=false;BX.onCustomEvent(window,"OnUCFormResponse",[i,e["messageId"],this,e])},this),onfailure:BX.delegate(function(){this.closeWait();this.busy=false;BX.onCustomEvent(window,"OnUCFormResponse",[this.id[0],this.id[1],this,[]])},this)})},cancel:function(){},showError:function(e){if(!e)return;var t=this._getPlacehoder(),i=BX.findChildren(t,{tagName:"DIV",className:"feed-add-error"},true);if(!!i){var s=i.pop();do{BX.remove(s);BX.remove(s)}while((s=i.pop())&&!!s)}BX.addClass(t,!t.firstChild?"feed-com-add-box-no-form":"feed-com-add-box-header");t.insertBefore(BX.create("div",{attrs:{class:"feed-add-error"},html:'<span class="feed-add-info-text"><span class="feed-add-info-icon"></span>'+"<b>"+BX.message("FC_ERROR")+"</b><br />"+e+"</span>"}),t.firstChild);BX.show(t)},showNote:function(e){if(!e)return;var t=this._getPlacehoder(),i=BX.findChildren(t,{tagName:"DIV",className:"feed-add-successfully"},true),s=null;if(!!i){while((s=i.pop())&&!!s){BX.remove(s)}}BX.addClass(t,!t.firstChild?"feed-com-add-box-no-form":"feed-com-add-box-header");t.insertBefore(BX.create("div",{attrs:{class:"feed-add-successfully"},html:'<span class="feed-add-info-text"><span class="feed-add-info-icon"></span>'+e+"</span>"}),t.firstChild);BX.addClass(t,"comment-deleted");BX.show(t)},showWait:function(){var e=BX("lhe_button_submit_"+this.form.id);this.busy=true;if(!!e){BX.addClass(e,"ui-btn-clock");BX.defer(function(){e.disabled=true})()}},closeWait:function(){var e=BX("lhe_button_submit_"+this.form.id);this.busy=false;if(!!e){e.disabled=false;BX.removeClass(e,"ui-btn-clock")}},objAnswering:null,showAnswering:function(e,t,i,s,n){t=t>0?t:0;if(t<=0)return;var o="uc-writing-"+this.form.id+"-"+e[0],r=BX(o+"-area"),a=this._getSwitcher(e),d=BX.localStorage.get("ucAnsweringStorage");d=!!d?d:{};if(!r&&a){r=BX.create("DIV",{attrs:{id:o+"-area",className:"feed-com-writers"},html:'<div id="'+o+'-users" class="feed-com-writers-wrap"></div><div class="feed-com-writers-pen"></div>'});a.appendChild(r)}if(!!r){if(t>0){if(!n){d["userId"+t]={id:e[0],userId:t,name:i,avatar:s,time:new Date};BX.localStorage.set("ucAnsweringStorage",d,3e3)}if(!BX(o+"-user-"+t)){BX.adjust(BX(o+"-users"),{children:[BX.create("DIV",{attrs:{className:"feed-com-avatar",id:o+"-user-"+t,title:i},children:s&&s.length>0?[BX.create("IMG",{attrs:{src:s&&s.length>0?s:"/bitrix/images/1.gif"}})]:[]})]})}}if(BX(o+"-users").childNodes.length>0){if(BX(r.parentNode).style.display=="none"){var h=BX("lhe_buttons_"+this.form.id);if(!h||h.style.display=="none")h=this.form;h.appendChild(r)}else if(r.parentNode!=a){a.appendChild(r)}BX.show(r);if(this.objAnswering&&this.objAnswering.name!="show")this.objAnswering.stop();if(!this.objAnswering||this.objAnswering.name!="show"){r.style.display="inline-block";this.objAnswering=new BX["easing"]({duration:500,start:{opacity:0},finish:{opacity:100},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(e){r.style.opacity=e.opacity/100}});this.objAnswering.name="show";this.objAnswering.animate()}var l=setTimeout(BX.delegate(function(){this.hideAnswering(e,t)},this),!!n?n:40500);if(BX(o+"-user-"+t)){clearTimeout(BX(o+"-user-"+t).getAttribute("bx-check-timeout"));BX(o+"-user-"+t).setAttribute("bx-check-timeout",l+"")}}}},hideAnswering:function(e,t){var i="uc-writing-"+this.form.id+"-"+e[0],s=BX(i+"-area"),n=BX(i+"-user-"+t,false);if(n&&s){if(BX(i+"-users").childNodes.length>1){new BX["easing"]({duration:500,start:{opacity:100},finish:{opacity:0},transition:BX["easing"].makeEaseOut(BX["easing"].transitions.quart),step:function(e){n.style.opacity=e.opacity/100},complete:function(){if(!!n&&!!n.parentNode)n.parentNode.removeChild(n)}}).animate()}else{if(this.objAnswering&&this.objAnswering.name!="hide")this.objAnswering.stop();if(!this.objAnswering||this.objAnswering.name!="hide"){this.objAnswering=new BX["easing"]({duration:500,start:{opacity:100},finish:{opacity:0},transition:BX["easing"].makeEaseOut(BX.easing.transitions.quart),step:function(e){s.style.opacity=e.opacity/100},complete:function(){s.style.display="none";if(!!n&&!!n.parentNode)n.parentNode.removeChild(n)}});this.objAnswering.name="hide";this.objAnswering.animate()}}}}};window.convertFormToArray=function(e,t){t=!!t?t:[];if(!!e){var i,s=[],n=e.elements.length;for(i=0;i<n;i++){var o=e.elements[i];if(o.disabled)continue;switch(o.type.toLowerCase()){case"text":case"textarea":case"password":case"hidden":case"select-one":s.push({name:o.name,value:o.value});break;case"radio":case"checkbox":if(o.checked)s.push({name:o.name,value:o.value});break;case"select-multiple":for(var r=0;r<o.options.length;r++){if(o.options[r].selected)s.push({name:o.name,value:o.options[r].value})}break;default:break}}var a=t;i=0;while(i<s.length){var d=s[i].name.indexOf("[");if(d==-1){a[s[i].name]=s[i].value;a=t;i++}else{var h=s[i].name.substring(0,d);var l=s[i].name.substring(d+1);if(!a[h])a[h]=[];var c=l.indexOf("]");if(c==-1){a=t;i++}else if(c===0){a=a[h];s[i].name=""+a.length}else{a=a[h];s[i].name=l.substring(0,c)+l.substring(c+1)}}}}return t};window.FCForm.onUCUsersAreWriting=function(){BX.ready(function(){var e=null,t=null,i=BX.localStorage.get("ucAnsweringStorage");if(!!i){for(var s in i){if(i.hasOwnProperty(s)){e=i[s];if(!!e&&e.userId>0){t=new Date-e.time;if(t<3e4){BX.onCustomEvent(window,"OnUCUsersAreWriting",[e.id,e.userId,e.name,e.avatar,t])}}}}}})};window["fRefreshCaptcha"]=function(e){var t=null,i=BX.findChild(e,{attr:{name:"captcha_code"}},true),s=BX.findChild(e,{attr:{name:"captcha_word"}},true),n=BX.findChild(e,{className:"comments-reply-field-captcha-image"},true);if(n)t=BX.findChild(n,{tag:"img"});if(i&&s&&t){s.value="";BX.ajax.getCaptcha(function(e){i.value=e["captcha_sid"];t.src="/bitrix/tools/captcha.php?captcha_code="+e["captcha_sid"]})}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:96:"/bitrix/components/bitrix/main.post.list/templates/.default/scripts_for_im.min.js?15078149408146";s:6:"source";s:77:"/bitrix/components/bitrix/main.post.list/templates/.default/scripts_for_im.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(){window["UC"]=!!window["UC"]?window["UC"]:{};if(!!window["UC"]["Informer"])return;window.SPC=function(){this.stack=[];this.stackTimeout=null;this.stackPopup={};this.stackPopupTimeout={};this.stackPopupTimeout2={};this.stackPopupId=0;this.stackOverflow=false;this.notifyShow=0;this.notifyHideTime=5e3;this.notifyHeightCurrent=10;this.notifyHeightMax=0;this.notifyGarbageTimeout=null;this.notifyAutoHide=true;this.notifyAutoHideTimeout=null};var t=window.SPC;t.prototype.add=function(t){if(typeof t!="object"||!t.html)return false;if(BX.type.isDomNode(t.html))t.html=t.html.outerHTML;this.stack.push(t);if(!this.stackOverflow)this.setShowTimer(300);return true};t.prototype.remove=function(t){delete this.stack[t]};t.prototype.show=function(){this.notifyHeightMax=document.body.offsetHeight;var t=BX.GetWindowInnerSize();for(var e=0;e<this.stack.length;e++){if(typeof this.stack[e]=="undefined")continue;var i=new BX.PopupWindow("bx-sbpc-notify-flash-"+this.stackPopupId,{top:0,left:0},{lightShadow:true,zIndex:200,events:{onPopupClose:BX.delegate(function(){BX.proxy_context.popupContainer.style.opacity=0;this.notifyShow--;this.notifyHeightCurrent-=BX.proxy_context.popupContainer.offsetHeight+10;this.stackOverflow=false;setTimeout(BX.delegate(function(){this.destroy()},BX.proxy_context),1500)},this),onPopupDestroy:BX.delegate(function(){BX.unbindAll(BX.findChild(BX.proxy_context.popupContainer,{className:"bx-spbc-notifier-item-delete"},true));BX.unbindAll(BX.proxy_context.popupContainer);delete this.stackPopup[BX.proxy_context.uniquePopupId];delete this.stackPopupTimeout[BX.proxy_context.uniquePopupId];delete this.stackPopupTimeout2[BX.proxy_context.uniquePopupId]},this)},bindOnResize:false,content:BX.create("div",{props:{className:"bx-notifyManager-item-sbpc"},html:this.stack[e].html})});i.notifyParams=this.stack[e];i.notifyParams.id=e;i.show();BX.removeClass(i.popupContainer.firstChild,"popup-window");i.popupContainer.style.left=10+"px";i.popupContainer.style.opacity=0;if(this.notifyHeightMax<this.notifyHeightCurrent+i.popupContainer.offsetHeight+10){if(this.notifyShow>0){i.destroy();this.stackOverflow=true;break}}BX.addClass(i.popupContainer,"bx-notifyManager-animation-spbc");new BX.easing({duration:500,start:{opacity:0},finish:{opacity:100},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(t){i.popupContainer.style.opacity=t.opacity/100}}).animate();i.popupContainer.style.top=t.innerHeight-this.notifyHeightCurrent-i.popupContainer.offsetHeight-10+"px";this.notifyHeightCurrent=this.notifyHeightCurrent+i.popupContainer.offsetHeight+10;this.stackPopupId++;this.notifyShow++;this.remove(e);this.stackPopupTimeout[i.uniquePopupId]=null;BX.bind(i.popupContainer,"mouseover",BX.delegate(function(){this.clearAutoHide()},this));BX.bind(i.popupContainer,"mouseout",BX.delegate(function(){this.setAutoHide(this.notifyHideTime/2)},this));BX.bind(i.popupContainer,"contextmenu",BX.delegate(function(t){if(this.stackPopup[BX.proxy_context.id].notifyParams.tag)this.closeByTag(this.stackPopup[BX.proxy_context.id].notifyParams.tag);else this.stackPopup[BX.proxy_context.id].close();return BX.PreventDefault(t)},this));var o=BX.findChildren(i.popupContainer,{tagName:"a"},true);for(var s=0;s<o.length;s++){if(o[s].href!="#")o[s].target="_blank"}BX.bind(BX.findChild(i.popupContainer,{className:"bx-spbc-notifier-item-delete"},true),"click",BX.delegate(function(t){var e=BX.proxy_context.parentNode.parentNode.parentNode.parentNode.id.replace("popup-window-content-","");if(this.stackPopup[e].notifyParams.close)this.stackPopup[e].notifyParams.close(this.stackPopup[e]);this.stackPopup[e].close();if(this.notifyAutoHide===false){this.clearAutoHide();this.setAutoHide(this.notifyHideTime/2)}return BX.PreventDefault(t)},this));if(i.notifyParams.click){i.popupContainer.style.cursor="pointer";BX.bind(i.popupContainer,"click",BX.delegate(function(t){this.notifyParams.click(this);return BX.PreventDefault(t)},i))}this.stackPopup[i.uniquePopupId]=i}if(this.stack.length>0){this.clearAutoHide(true);this.setAutoHide(this.notifyHideTime)}this.garbage()};t.prototype.closeByTag=function(t){for(var e=0;e<this.stack.length;e++){if(typeof this.stack[e]!="undefined"&&this.stack[e].tag==t){delete this.stack[e]}}for(e in this.stackPopup){if(this.stackPopup.hasOwnProperty(e))if(this.stackPopup[e].notifyParams.tag==t)this.stackPopup[e].close()}};t.prototype.setShowTimer=function(t){clearTimeout(this.stackTimeout);this.stackTimeout=setTimeout(BX.delegate(this.show,this),t)};t.prototype.setAutoHide=function(t){this.notifyAutoHide=true;clearTimeout(this.notifyAutoHideTimeout);this.notifyAutoHideTimeout=setTimeout(BX.delegate(function(){for(var e in this.stackPopupTimeout){if(this.stackPopupTimeout.hasOwnProperty(e)){this.stackPopupTimeout[e]=setTimeout(BX.delegate(function(){this.close()},this.stackPopup[e]),t-1e3);this.stackPopupTimeout2[e]=setTimeout(BX.delegate(function(){this.setShowTimer(300)},this),t-700)}}},this),1e3)};t.prototype.clearAutoHide=function(t){clearTimeout(this.notifyGarbageTimeout);this.notifyAutoHide=false;t=t===true;var e;if(t){clearTimeout(this.stackTimeout);for(e in this.stackPopupTimeout){if(this.stackPopupTimeout.hasOwnProperty(e)){clearTimeout(this.stackPopupTimeout[e]);clearTimeout(this.stackPopupTimeout2[e])}}}else{clearTimeout(this.notifyAutoHideTimeout);this.notifyAutoHideTimeout=setTimeout(BX.delegate(function(){clearTimeout(this.stackTimeout);for(var t in this.stackPopupTimeout){if(this.stackPopupTimeout.hasOwnProperty(t)){clearTimeout(this.stackPopupTimeout[t]);clearTimeout(this.stackPopupTimeout2[t])}}},this),300)}};t.prototype.garbage=function(){clearTimeout(this.notifyGarbageTimeout);this.notifyGarbageTimeout=setTimeout(BX.delegate(function(){var t=[];for(var e=0;e<this.stack.length;e++){if(typeof this.stack[e]!="undefined")t.push(this.stack[e])}this.stack=t},this),1e4)};t.prototype.check=function(t,e,i,o){if(t[1]<=0||!window["UC"]["Informer"]||!BX.type.isNotEmptyString(o))return;var s=/(\d+)/g.exec(t[0]),n=BX("record-"+t.join("-")+"-cover");s=!!s?parseInt(s):0;if(s<=0||!n)return false;else if(BX.util.in_array(s,window["UC"]["InformerTags"][i]))return true;window["UC"]["InformerTags"][i].push(s);var a=!!e&&!!e["messageFields"]?e["messageFields"]:false;if(!a)return;var r=BX.pos(n),p=BX.GetWindowScrollPos(),u=BX.GetWindowInnerSize();if(r.top<p.scrollTop||r.top>p.scrollTop+u.innerHeight-20){setTimeout(function(){if(parseInt(a["AUTHOR"]["ID"])!=parseInt(BX.message("USER_ID"))){var e=BX.create("div",{props:{className:"bx-spbc-notifier-item"},children:[BX.create("span",{props:{className:"bx-spbc-notifier-item-content"},children:[BX.create("span",{props:{className:"bx-spbc-notifier-item-avatar"},children:[!!a["AUTHOR"]["AVATAR"]?BX.create("img",{props:{className:"bx-spbc-notifier-item-avatar-img"},attrs:{src:a["AUTHOR"]["AVATAR"]}}):""]}),BX.create("a",{attrs:{href:"#"},props:{className:"bx-spbc-notifier-item-delete"}}),BX.create("span",{props:{className:"bx-spbc-notifier-item-name"},html:a["AUTHOR"]["NAME"]}),BX.create("span",{props:{className:"bx-spbc-notifier-item-time"},html:a["POST_TIME"]}),BX.create("span",{props:{className:"bx-spbc-notifier-item-text"}}),BX.create("span",{props:{className:"bx-spbc-notifier-item-text2"},html:'"'+o+'"'})]})]}),i=BX.GetWindowScrollPos();window["UC"]["Informer"].add({html:e,tag:"im-record-"+t.join("-"),click:BX.delegate(function(){var e=BX.pos(BX("record-"+t.join("-")));new BX.easing({duration:500,start:{scroll:i.scrollTop},finish:{scroll:e.top-100},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(t){window.scrollTo(0,t.scroll)}}).animate()},this)})}},50)}};t.NativeNotify=function(){return window.webkitNotifications&&window.webkitNotifications.checkPermission()==0};window["UC"]["Informer"]=new t;window["UC"]["InformerTags"]={};t.notifyManagerShow=function(){BX.ready(function(){BX.addCustomEvent("onNotifyManagerShow",function(t){if(t.originalTag){var e=t.originalTag.lastIndexOf("|"),i=t.originalTag.substr(0,e);if(!!window["UC"]["InformerTags"][i]){var o=parseInt(t.originalTag.substr(e+1));window["UC"]["InformerTags"][i].push(o)}}})})}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:89:"/bitrix/components/bitrix/main.post.form/templates/.default/script.min.js?155255657359492";s:6:"source";s:69:"/bitrix/components/bitrix/main.post.form/templates/.default/script.js";s:3:"min";s:73:"/bitrix/components/bitrix/main.post.form/templates/.default/script.min.js";s:3:"map";s:73:"/bitrix/components/bitrix/main.post.form/templates/.default/script.map.js";}"*/
(function(){if(window["LHEPostForm"])return;var e={controller:{},handler:{}};BX.addCustomEvent(window,"BFileDLoadFormControllerWasBound",function(t){e.controller[t.id]=true});BX.addCustomEvent(window,"WDLoadFormControllerInit",function(t){e.controller[t.CID]=t});BX.addCustomEvent(window,"WDLoadFormControllerWasBound",function(t){e.controller[t.CID]=true});BX.addCustomEvent(window,"DiskDLoadFormControllerInit",function(t){e.controller[t.CID]=t});BX.addCustomEvent(window,"DiskLoadFormControllerWasBound",function(t){e.controller[t.CID]=true});BX.addCustomEvent(window,"OnEditorInitedBefore",function(t){if(e.handler[t.id]){t.__lhe_flags=["OnEditorInitedBefore"];if(e.handler[t.id]["params"]&&e.handler[t.id]["params"]["LHEJsObjName"])window[e.handler[t.id].params["LHEJsObjName"]]=t;e.handler[t.id].OnEditorInitedBefore(t)}});var t=function(t){if(e.handler[t.id]&&e.handler[t.id].editorIsLoaded!==true){e.handler[t.id].editorIsLoaded=true;e.handler[t.id].exec();BX.onCustomEvent(e.handler[t.id],"OnEditorIsLoaded",[e.handler[t.id],t])}};BX.addCustomEvent(window,"OnCreateIframeAfter",t);BX.addCustomEvent(window,"OnEditorInitedAfter",function(i,n){if(e.handler[i.id]){i.__lhe_flags.push("OnEditorInitedAfter");e.handler[i.id].OnEditorInitedAfter(i);if(e.handler[i.id].editorIsLoaded!==true&&n&&i.sandbox&&i.sandbox.inited)t.apply(i,[i])}});BX.util.object_search=function(e,t){for(var i in t){if(t.hasOwnProperty(i)){if(t[i]==e)return true;else if(typeof t[i]=="object"&&t[i]!==null){var n=BX.util.object_search_key(e,t[i]);if(n!==false)return n}}}return false};var i=function(e,t,i){i=i&&i.length>0?i:[];if(typeof t=="object"&&t.length>0){var n;while((n=t.pop())&&n&&t.length>0){i.push(n)}t=n}i.push(t);this.exist=true;this.bxTag=e;this.tag=t;this.tags=i;this.regexp=new RegExp("\\[("+i.join("|")+")=((?:\\s|\\S)*?)(?:\\s*?WIDTH=(\\d+)\\s*?HEIGHT=(\\d+))?\\]","ig");this.code="["+t+"=#ID##ADDITIONAL#]";this.wysiwyg='<span style="color: #2067B0; border-bottom: 1px dashed #2067B0; margin:0 2px;" id="#ID#"#ADDITIONAL#>#NAME#</span>'},n=function(t,i,n){this.CID=this.id=i;this.parser=t.parser["disk_file"]||null;this.params=n;this.node=BX("diskuf-selectdialog-"+i);this.handler=e.controller[i];this.manager=t;this.eventNode=this.manager.eventNode;this.parserName="disk_file";this.prefixNode="disk-edit-attach";this.prefixHTMLNode="disk-attach-";this.props={valueEditClassName:"wd-inline-file",securityCID:"disk-upload-cid"};this.storage="disk";this.fileToAttach={};this.xmlToAttach={};this.events={onInit:"DiskDLoadFormControllerInit",onShow:"DiskLoadFormController",onBound:"DiskLoadFormControllerWasBound"}};n.prototype={parser:false,eventNode:null,values:{},initialized:false,functionsToExec:[],exec:function(e,t){if(typeof e=="function")this.functionsToExec.push([e,t]);if(this.handler&&this.handler!==true){var i;while((i=this.functionsToExec.shift())&&i)i[0].apply(this,i[1])}},init:function(){if(this.initialized!==true){this.values={};this.functionsToExec=[];this.initialized=true;this.bindMainEvents(this.manager);if(this.parser!==null){this.bindEvents(this.manager);return this.initValues()}}return false},initValues:function(){var e=BX.findChildren(this.node,{className:this.props.valueEditClassName},true);if(e&&e.length>0){this.exec(this.runCheckText);return true}return false},bindMainEvents:function(t){var i=null;BX.addCustomEvent(t.eventNode,"onReinitializeBefore",BX.proxy(this.clean,this));BX.addCustomEvent(t.eventNode,"onShowControllers",BX.proxy(function(e){i=e;BX.onCustomEvent(t.eventNode,this.events.onShow,[e])},this));if(!e.controller[this.id]){var o=BX.delegate(function(e){if(e["UID"]==this.id||e["id"]==this.id){if(i==="show"||i==="hide"){BX.onCustomEvent(t.eventNode,this.events.onShow,[i]);i=null}BX.removeCustomEvent(window,this.events.onBound,o)}},this);BX.addCustomEvent(window,this.events.onBound,o)}if(BX["DD"]&&this.storage=="disk"){var r=BX.delegate(function(e){if((e["UID"]==this.id||e["id"]==this.id)&&this.manager["dropZoneExists"]!==true){BX.removeCustomEvent(window,this.events.onBound,r);this.manager["dropZoneExists"]=true;var i=this.eventNode,o=this.id;n.dndCatcher=n.dndCatcher||{};n.dndCatcher[o]={catch:true,files:[],dropZone:null,dropZoneMicro:null,initdrag:BX.delegate(function(){n.dndCatcher[o].dropZone=new BX.DD.dropFiles(t.eventNode);BX.addCustomEvent(t.eventNode,"OnImageDataUriHandle",BX.delegate(function(e,t){if(BX["UploaderUtils"]){var i=BX.UploaderUtils.dataURLToBlob(t.src);if(i&&i.size>0&&i.type.indexOf("image/")==0){i.name=i.name||t.title||"image."+i.type.substr(6);i.referrerToEditor=t;if(n.dndCatcher[o]["catch"]===true)n.dndCatcher[o]["drop"]([i]);else if(this.handler&&this.handler["addFile"])this.handler.addFile(i);BX.onCustomEvent(e,"OnImageDataUriCaught",[t])}}},this));BX.addCustomEvent(n.dndCatcher[o].dropZone,"dropFiles",n.dndCatcher[o]["drop"]);BX.addCustomEvent(n.dndCatcher[o].dropZone,"dragEnter",n.dndCatcher[o]["dragover"]);BX.addCustomEvent(n.dndCatcher[o].dropZone,"dragLeave",n.dndCatcher[o]["dragleave"]);if(BX("micro"+t.__divId)){n.dndCatcher[o].dropZoneMicro=new BX.DD.dropFiles(BX("micro"+t.__divId));BX.addCustomEvent(n.dndCatcher[o].dropZoneMicro,"dragEnter",function(){BX.onCustomEvent(t.eventNode,"OnShowLHE",["justShow"])})}BX.unbind(document,"dragover",n.dndCatcher[o]["initdrag"]);BX.onCustomEvent(t.eventNode,"onDropZoneExists",[])},this),dragover:BX.delegate(function(){BX.addClass(t.eventNode,"feed-add-post-dnd-over");BX.onCustomEvent(t.eventNode,"dragover",[])},this),dragleave:BX.delegate(function(){BX.removeClass(t.eventNode,"feed-add-post-dnd-over");BX.onCustomEvent(t.eventNode,"dragleave",[])},this),dragenterwindow:BX.delegate(function(){BX.addClass(t.eventNode,"feed-add-post-dnd-ready");if(BX("micro"+t.__divId)){BX.addClass(BX("micro"+t.__divId),"feed-add-post-micro-dnd-ready")}BX.onCustomEvent(t.eventNode,"dragenterwindow",[])},this),dragleavewindow:BX.delegate(function(e){BX.removeClass(t.eventNode,"feed-add-post-dnd-ready");if(BX("micro"+t.__divId)){BX.removeClass(BX("micro"+t.__divId),"feed-add-post-micro-dnd-ready")}BX.onCustomEvent(t.eventNode,"dragleavewindow",[])},this),drop:BX.delegate(function(e){BX.onCustomEvent(t.eventNode,"drop",[]);BX.onCustomEvent(window,"dragWindowLeave");BX.onCustomEvent(window,"__dragWindowLeave");var i=0;if(e&&e.length>0){if(n.dndCatcher[o]["catch"]===true){n.dndCatcher[o].files=e;i=1}else{i=2}BX.onCustomEvent(t.eventNode,this.events.onShow,["show"]);BX.removeClass(t.eventNode,"feed-add-post-dnd-ready feed-add-post-dnd-over")}return i},this)};BX.ready(function(){n.dndCatcher[o]["initdrag"]()});BX.addCustomEvent(i,"OnIframeDrop",BX.delegate(function(e){BX.PreventDefault(e);if(e["dataTransfer"]&&e["dataTransfer"]["files"]){if(n.dndCatcher[o].drop(e["dataTransfer"]["files"])===2){this.handler.agent.onChange(e["dataTransfer"]["files"])}}},this));BX.addCustomEvent(i,"OnIframeDragOver",n.dndCatcher[o].dragover);BX.addCustomEvent(i,"OnIframeDragLeave",n.dndCatcher[o].dragleave);if(!window["bxMpfDndCatcher"]){window["bxMpfDndCatcher"]=true;var s=false,a=function(){if(s===false){s=true;BX.bind(document,"dragleave",l);BX.bind(document,"dragover",l);BX.bind(document,"mouseout",d);BX.onCustomEvent(window,"dragWindowEnter")}},d=function(e){BX.unbind(document,"dragleave",l);BX.unbind(document,"dragover",l);BX.unbind(document,"mouseout",d);s=false;BX.onCustomEvent(window,"dragWindowLeave")},l=function(e){if(h>0){clearTimeout(h);h=0}BX.fixEventPageXY(e);var t=true;if(e.pageX>0&&e.pageY>0){var i=BX.GetWindowSize();if(e.pageY<i.scrollHeight&&e.pageX<i.scrollWidth){var n=e.pageY-i.scrollTop,o=e.pageX-i.scrollLeft;if(0<n&&n<i.innerHeight-20&&0<o&&o<i.innerWidth-20){t=false}}}if(t){d(e)}else{h=setTimeout(function(){l({type:"intervalLimit"})},100)}},h=0;BX.bind(document,"dragenter",function(e){if(window["bxMpfDndCatcher"]>0){clearTimeout(window["bxMpfDndCatcher"])}var t=true;if(e&&e["dataTransfer"]&&e["dataTransfer"]["types"]){for(var i=0;i<e["dataTransfer"]["types"].length;i++){if(e["dataTransfer"]["types"][i]=="Files"){t=true;break}}}if(t){a()}});BX.addCustomEvent(window,"__dragWindowLeave",d);BX.bind(document,"dragover",function(e){return BX.PreventDefault(e)});BX.bind(document,"drop",function(e){d(e);return BX.PreventDefault(e)})}BX.addCustomEvent(window,"dragWindowEnter",n.dndCatcher[o].dragenterwindow);BX.addCustomEvent(window,"dragWindowLeave",n.dndCatcher[o].dragleavewindow);this.__initCatcher=BX.delegate(function(e,i){if(e==this.id){BX.removeCustomEvent(t.eventNode,"onControllerInitialized",this.__initCatcher);i.agent.initDropZone(t.eventNode);if(n.dndCatcher[e].files.length>0){i.agent.onChange(n.dndCatcher[e].files);n.dndCatcher[e].files=[]}n.dndCatcher[e]["catch"]=false;this.__initCatcher=null}},this);BX.addCustomEvent(t.eventNode,"onControllerInitialized",this.__initCatcher)}},this);BX.addCustomEvent(window,this.events.onBound,r);if(e.controller[this.id])r(e.controller[this.id])}},bindEvents:function(e){this._catchHandler=BX.delegate(function(t){BX.removeCustomEvent(this.eventNode,this.events.onInit,this._catchHandler);this.handler=t;var i=BX.findChild(BX(e.formID),{attr:{id:this.props.securityCID}},true,false);if(i)i.value=this.handler.CID;this.exec();var n=BX.delegate(function(){BX.onCustomEvent(e.eventNode,"onUploadsHasBeenChanged",arguments)},this);BX.addCustomEvent(this.handler.agent,"onFileIsInited",n);BX.addCustomEvent(this.handler.agent,"ChangeFileInput",n);BX.onCustomEvent(e.eventNode,"onControllerInitialized",[this.id,t])},this);if(typeof this.handler!="object"||!this.handler)BX.addCustomEvent(e.eventNode,this.events.onInit,this._catchHandler);else this._catchHandler(this.handler);BX.addCustomEvent(e.eventNode,"OnFileUploadSuccess",BX.delegate(function(e,t,i){if(this.id==t.CID||this.id==t.id){i=i||{};i.usePostfix=true;this.addFile(e,i,t)}},this));BX.addCustomEvent(e.eventNode,"OnFileUploadFailed",BX.delegate(function(e,t,i){if(this.id==t.CID||this.id==t.id){this.failFile(e,i,t)}},this));BX.addCustomEvent(e.eventNode,"OnFileUploadRemove",BX.delegate(function(e,t){if(this.id==t.CID||this.id==t.id){this.deleteFile(e,{usePostfix:true},t)}},this));BX.addCustomEvent(this,"onFileIsInText",BX.proxy(function(e,t){this.adjustFile(this.checkFile(e),t)},this))},addFile:function(e,t,i){var n=this.checkFile(e.element_id,e,t);if(n){setTimeout(BX.proxy(function(){this.bindFile(n);this.adjustFile(n,false)},this),100);BX.onCustomEvent(this.eventNode,"onFileIsAdded",[n,this,i,t])}else{this.failFile(this,t,i)}return true},failFile:function(e,t,i){BX.onCustomEvent(this.eventNode,"onFileIsFailed",[this,i,t])},checkFile:function(e,t){e=""+(typeof e=="object"?e.id:e);if(typeof t=="object"&&t!==null&&e&&t.element_name&&BX(t.place)){var i={id:e,name:t.element_name,url:t.element_url,type:"isnotimage/xyz",isImage:false,place:BX(t.place,true),xmlID:BX(t.place,true).getAttribute("bx-attach-xml-id"),fileID:BX(t.place,true).getAttribute("bx-attach-file-id"),fileType:BX(t.place,true).getAttribute("bx-attach-file-type")},n;if(/(\.png|\.jpg|\.jpeg|\.gif|\.bmp)$/i.test(t.element_name)&&(n=BX.findChild(i.place,{className:"files-preview",tagName:"IMG"},true,false))&&n){i.type="image/xyz";i.lowsrc=n.src;i.element_url=i.src=n.src.replace(/\Wwidth=(\d+)/,"").replace(/\Wheight=(\d+)/,"");i.isImage=true;i.width=parseInt(n.getAttribute("data-bx-full-width")||n.getAttribute("data-bx-width"));i.height=parseInt(n.getAttribute("data-bx-full-height")||n.getAttribute("data-bx-height"))}if(i.xmlID)this.xmlToAttach[i.xmlID+""]=e;if(i.fileID)this.fileToAttach[i.fileID+""]=e;this.values[e]=i}return this.values[e]||false},bindFile:function(e){var t=e.place;if(typeof e=="object"&&t&&!t.hasAttribute("bx-file-is-bound")){var i=BX.findChild(t,{className:"f-wrap"},true,false),n=BX.findChild(t,{className:"files-preview"},true,false);if(i){BX.bind(i,"click",BX.delegate(function(){this.insertFile(e.id)},this));i.style.cursor="pointer";i.title=BX.message("MPF_FILE")}if(n){BX.bind(n,"click",BX.delegate(function(){this.insertFile(e.id)},this))}}},adjustFile:function(e,t){var i=e.place;if(t===true||t===false){if(!e.info)e.info=BX.findChild(e.place,{className:"files-info"},true,false);i=e.info;if(BX.type.isDomNode(i)){var n="check-in-text-"+e.id,o=BX(n),r=t===false?{attrs:{"bx-file-is-in-text":"N"},props:{className:"insert-btn"},html:'<span class="insert-btn-text">'+BX.message("MPF_FILE_INSERT_IN_TEXT")+"</span>"}:{attrs:{"bx-file-is-in-text":"Y"},props:{className:"insert-text"},html:'<span class="insert-btn-text">'+BX.message("MPF_FILE_IN_TEXT")+"</span>"};if(!o){r.attrs.id=n;r.events={click:BX.proxy(function(){this.insertFile(e.id)},this)};i.appendChild(BX.create("SPAN",r))}else{BX.adjust(o,r)}}}},insertFile:function(e){BX.onCustomEvent(this.eventNode,"onFileIsInserted",[this.checkFile(e),this])},deleteFile:function(e,t){e=this.checkFile(e,t);if(e){BX.onCustomEvent(this.eventNode,"onFileIsDeleted",[e,this]);this.values[e.id].place=null;delete this.values[e.id].place;this.values[e.id]=null;delete this.values[e.id];e=null;return true}return false},reinitValues:function(e,t){var i,n,o={};while((i=t.pop())&&i){n=BX(this.prefixHTMLNode+i);n=n?n.tagName=="A"?n:BX.findChild(n,{tagName:"IMG"},true):null;if(n){o["E"+i]={type:"file",id:i,name:n.getAttribute("data-bx-title")||n.getAttribute("data-title"),size:n.getAttribute("data-bx-size")||"",sizeInt:n.getAttribute("data-bx-size")||"",width:n.getAttribute("data-bx-width"),height:n.getAttribute("data-bx-height"),storage:"disk",previewUrl:n.tagName=="A"?"":n.getAttribute("data-bx-src")||n.getAttribute("data-src"),fileId:n.getAttribute("bx-attach-file-id")};if(n.hasAttribute("bx-attach-xml-id"))o["E"+i]["xmlId"]=n.getAttribute("bx-attach-xml-id");if(n.hasAttribute("bx-attach-file-type"))o["E"+i]["fileType"]=n.getAttribute("bx-attach-file-type")}}this.handler.selectFile({},{},o);this.runCheckText()},runCheckText:function(){if(!this._checkText)this._checkText=BX.delegate(this.checkText,this);this.manager.exec(this._checkText)},checkText:function(){var e,t=this.manager.getContent(),i=[],n,o;if(t!=""){e=t;for(o in this.xmlToAttach){if(this.xmlToAttach.hasOwnProperty(o)){t=t.replace(new RegExp("\\&\\#91\\;DOCUMENT ID=("+o+")([WIDTHHEIGHT=0-9 ]*)\\&\\#93\\;","gim"),"["+this.parser["tag"]+"="+this.xmlToAttach[o]+"$2]").replace(new RegExp("\\[DOCUMENT ID=("+o+")([WIDTHHEIGHT=0-9 ]*)\\]","gim"),"["+this.parser["tag"]+"="+this.xmlToAttach[o]+"$2]")}}for(o in this.fileToAttach){if(this.fileToAttach.hasOwnProperty(o)){t=t.replace(new RegExp("\\&\\#91\\;"+this.parser["tag"]+"=("+o+")([WIDTHHEIGHT=0-9 ]*)\\&\\#93\\;","gim"),"["+this.parser["tag"]+"="+this.fileToAttach[o]+"$2]").replace(new RegExp("\\["+this.parser["tag"]+"=("+o+")([WIDTHHEIGHT=0-9 ]*)\\]","gim"),"["+this.parser["tag"]+"="+this.fileToAttach[o]+"$2]")}}n=new RegExp("(?:\\&\\#91\\;)("+this.parser["tags"].join("|")+")=([a-z=0-9 ]+)(?:\\&\\#93\\;)","gim");if(n.test(t)){for(o in this.values){if(this.values.hasOwnProperty(o)){i.push(o)}}if(i.length>0){n=new RegExp("(?:\\&\\#91\\;|\\[)("+this.parser["tags"].join("|")+")=("+i.join("|")+")([WIDTHHEIGHT=0-9 ]*)(?:\\&\\#93\\;|\\])","gim");if(n.test(t))t=t.replace(n,BX.delegate(function(e,t,i,n){return"["+t+"="+i+n+"]"},this))}}if(e!=t)BX.onCustomEvent(this.eventNode,"onFileIsDetected",[t,this])}return t},clean:function(){if(this.handler&&this.handler.values){var e,t,i,n=BX(this.manager.formID);while((e=this.handler.values.pop())&&e){BX.remove(e)}if(this.handler.params&&this.handler.params.controlName){t=BX.findChildren(n,{tagName:"INPUT",attribute:{name:this.handler.params.controlName}},true)}if(t){for(i=0;i<t.length;i++){BX.remove(t[i])}}}},reinit:function(e,t){var i=[],n,o;for(n in t){if(t.hasOwnProperty(n)){if(t[n]["USER_TYPE_ID"]==this.parserName&&t[n]["VALUE"]){for(o in t[n]["VALUE"]){if(t[n]["VALUE"].hasOwnProperty(o)){i.push(t[n]["VALUE"][o])}}}}}if(i.length>0){this.exec(this.reinitValues,[e,i]);return true}return false}};var o=function(e,t,i){o.superclass.constructor.apply(this,arguments);this.parser=e.parser["webdav_element"]||null;this.node=BX("wduf-selectdialog-"+t);this.manager=e;this.parserName="webdav_element";this.prefixNode="wd-doc";this.prefixHTMLNode="wdif-doc-";this.storage="webdav";this.events={onInit:"WDLoadFormControllerInit",onShow:"WDLoadFormController",onBound:"WDLoadFormControllerWasBound"}};BX.extend(o,n);o.prototype.reinitValues=function(e,t){var i,n,o={};this.waitAnswerFromServer=[];while((i=t.pop())&&i){n=BX(this.prefixHTMLNode+i);n=n?n.tagName=="A"?n:BX.findChild(n,{tagName:"IMG"},true):null;if(n){o["E"+i]={type:"file",id:i,name:n.getAttribute("alt"),storage:"webdav",size:n.getAttribute("data-bx-size"),sizeInt:1,ext:"",link:n.getAttribute("data-bx-document")};if(n.hasAttribute("bx-attach-xml-id"))o["E"+i]["xmlId"]=n.getAttribute("bx-attach-xml-id");this.waitAnswerFromServer.push(i)}}if(this.waitAnswerFromServer.length>0){if(!this._defferCheckText)this._defferCheckText=BX.delegate(this.defferCheckText,this);BX.addCustomEvent(this.eventNode,"OnFileUploadSuccess",this._defferCheckText);this.handler.WDFD_SelectFile({},{},o)}};o.prototype.defferCheckText=function(e){var t=BX.util.array_search(e.element_id,this.waitAnswerFromServer);if(t>=0){this.runCheckText();this.waitAnswerFromServer=BX.util.deleteFromArray(this.waitAnswerFromServer,t)}if(this.waitAnswerFromServer.length<=0)BX.removeCustomEvent(this.eventNode,"OnFileUploadSuccess",this._defferCheckText)};var r=function(e,t,i){r.superclass.constructor.apply(this,arguments);this.parser=e.parser["file"]?e.parser["file"]:e.parser["postimage"]["exist"]?e.parser["postimage"]:null;this.postfix=i["postfix"]||"";this.node=BX("file-selectdialog-"+t);this.parserName="file";this.prefixNode="wd-doc";this.prefixHTMLNode="file-doc-";this.props={valueEditClassName:"file-inline-file",securityCID:"upload-cid"};this.storage="bfile";this.events={onInit:"BFileDLoadFormControllerInit",onShow:"BFileDLoadFormController",onBound:"BFileDLoadFormControllerWasBound"}};BX.extend(r,n);r.prototype.initValues=function(e){var t;if(e!==true){t=BX.findChildren(this.node,{className:this.props.valueEditClassName},true);if(t&&t.length>1){this.exec(this.initValues,[true]);return true}return false}t=this.handler.agent.values||[];var i,n,o,r,s={},a="/bitrix/components/bitrix/main.file.input/file.php?mfi_mode=down&cid="+this.handler.CID+"&sessid="+BX.bitrix_sessid();for(var d=0;d<t.length;d++){r=parseInt(t[d].getAttribute("id").replace(this.prefixNode,""));if(s["id"+r])continue;s["id"+r]="Y";if(r>0){n=BX.findChild(t[d],{className:"f-wrap"},true,false);if(!n)continue;o={element_id:r,element_name:n.innerHTML,parser:this.parser.bxTag,storage:"bfile",element_url:a+"&fileID="+r};i=this.addFile(o,{usePostfix:true,hasPreview:false})}}this.runCheckText();return true};r.prototype.checkFile=function(e,t,i){e=""+(typeof e=="object"?e.id:e);e=e+(i&&i["usePostfix"]===true?this.postfix:"");if(typeof t=="object"&&t!==null&&e&&t.element_name&&BX(this.prefixNode+t.element_id,true)){var n={id:e,name:t.element_name,url:t.element_url,type:"isnotimage/xyz",isImage:false,place:BX(this.prefixNode+t.element_id,true)},o;if((t["element_type"]&&t["element_type"].indexOf("image/")===0||/(\.png|\.jpg|\.jpeg|\.gif|\.bmp)$/i.test(t.element_name))&&((o=BX.findChild(n.place,{tagName:"IMG"},true,false))&&o||i&&i["hasPreview"]===false)){n.type="image/xyz";n.src=t["element_thumbnail"]||t["element_url"];n.isImage=true;n.hasPreview=false;n.lowsrc="";n.width="";n.height="";if(BX(o)){n.hasPreview=true;n.lowsrc=t["element_thumbnail"]||o["src"];n.width=parseInt(o.getAttribute("data-bx-full-width"));n.height=parseInt(o.getAttribute("data-bx-full-height"))}}else if(this.parser.bxTag=="postimage"){return false}if(BX(n.place,true).getAttribute("bx-attach-file-type")){n.fileType=BX(n.place,true).getAttribute("bx-attach-file-type")}this.values[e]=n}return this.values[e]||false};r.prototype.bindFile=function(e){var t=e&&e["place"]?e["place"]:null;if(typeof e=="object"&&t&&!t.hasAttribute("bx-file-is-bound")){if(e.isImage&&e.hasPreview){var i=BX.findChild(t,{className:"feed-add-img-title"},true,false),n=BX.findChild(t,{className:"feed-add-img-wrap"},true,false);if(n){BX.bind(n,"click",BX.proxy(function(){this.insertFile(e)},this));n.style.cursor="pointer";n.title=BX.message("MPF_IMAGE")}if(i){BX.bind(i,"click",BX.delegate(function(){this.insertFile(e)},this));i.style.cursor="pointer";i.title=BX.message("MPF_IMAGE")}}else r.superclass.bindFile.apply(this,arguments)}};r.prototype.clean=function(){r.superclass.clean.apply(this,arguments);if(this["handler"]&&this.handler["agent"]&&this.handler.agent["inputName"]){var e,t,i=BX(this.manager.formID);e=BX.findChildren(i,{tagName:"INPUT",attribute:{name:this.handler.agent.inputName+"[]"}},true);if(e){for(t=0;t<e.length;t++){BX.remove(e[t])}}}};var s=function(t,i){this.params=i;this.formID=t;this.showPinButton=!!BX("lhe_button_editor_"+this.formID);if(this.showPinButton){this.params.showPanelEditor=!!this.params.pinEditorPanel}this.oEditorId=i["LHEJsObjId"];this.__divId=i["LHEJsObjName"]||i["LHEJsObjId"];e.handler[this.oEditorId]=this;this.oEditor=s.getEditor(this.oEditorId);this.urlPreview=this.initUrlPreview(i);this.eventNode=BX("div"+this.__divId);BX.addCustomEvent(this.eventNode,"OnShowLHE",BX.delegate(this.OnShowLHE,this));BX.addCustomEvent(this.eventNode,"OnButtonClick",BX.delegate(this.OnButtonClick,this));BX.addCustomEvent(this.eventNode,"OnAfterShowLHE",function(e,t){if(t.oEditor&&t.oEditor["AllowBeforeUnloadHandler"])t.oEditor.AllowBeforeUnloadHandler();if(t.monitoringWakeUp===true)t.monitoringStart()});BX.addCustomEvent(this.eventNode,"OnAfterHideLHE",function(e,t){t.monitoringWakeUp=t.monitoringStop();if(t.oEditor&&t.oEditor["DenyBeforeUnloadHandler"])t.oEditor.DenyBeforeUnloadHandler()});this.initParsers(i);this.initFiles(t,i);BX.ready(BX.delegate(function(){if(BX("lhe_button_submit_"+t,true)){BX.bind(BX("lhe_button_submit_"+t,true),"click",BX.proxy(function(e){BX.onCustomEvent(this.eventNode,"OnButtonClick",["submit"]);return BX.PreventDefault(e)},this))}if(BX("lhe_button_cancel_"+t,true)){BX.bind(BX("lhe_button_cancel_"+t,true),"click",BX.proxy(function(e){BX.onCustomEvent(this.eventNode,"OnButtonClick",["cancel"]);return BX.PreventDefault(e)},this))}},this));this.inited=true;BX.addCustomEvent(BX(this.formID),"onAutoSavePrepare",function(e){e.FORM.setAttribute("bx-lhe-autosave-prepared","Y")});BX.onCustomEvent(this,"onInitialized",[this,t,i,this.parsers]);BX.onCustomEvent(this.eventNode,"onInitialized",[this,t,i,this.parsers]);if(this.oEditor&&this.oEditor.inited&&!this.oEditor["__lhe_flags"]){BX.onCustomEvent(this.oEditor,"OnEditorInitedBefore",[this.oEditor]);BX.onCustomEvent(this.oEditor,"OnEditorInitedAfter",[this.oEditor,true])}};s.prototype={editorIsLoaded:false,arFiles:{},parser:{},controllers:{},exec:function(e,t){this.functionsToExec=this.functionsToExec||[];if(typeof e=="function")this.functionsToExec.push([e,t]);if(this.editorIsLoaded===true){var i;while((i=this.functionsToExec.shift())&&i)i[0].apply(this,i[1])}},initParsers:function(e){this.parser={postimage:{exist:false,bxTag:"postimage",tag:"IMG ID",tags:["IMG ID"],regexp:/\[(IMG ID)=((?:\s|\S)*?)(?:\s*?WIDTH=(\d+)\s*?HEIGHT=(\d+))?\]/gi,code:"[IMG ID=#ID##ADDITIONAL#]",wysiwyg:'<img id="#ID#" src="'+'#SRC#" lowsrc="'+'#LOWSRC#" title=""#ADDITIONAL# />'},player:{exist:false,bxTag:"player",tag:"FILE ID",tags:["FILE ID"],regexp:/\[(FILE ID)=((?:\s|\S)*?)?\]/gi,code:"[FILE ID=#ID##ADDITIONAL#]",wysiwyg:'<img class="bxhtmled-player-surrogate" id="#ID#" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" contenteditable="false" title=""#ADDITIONAL# />'}};var t=e["parsers"]?e["parsers"]:{};for(var n in t){if(t.hasOwnProperty(n)&&/[a-z]/gi.test(n+"")){this.parser[n]=new i(n,t[n])}}if(BX.util.object_search("UploadImage",t)){this.parser["postimage"]["exist"]=true}if(typeof e["arSize"]=="object"){var o="";if(e["arSize"]["width"])o+="max-width:"+e["arSize"]["width"]+"px;";if(e["arSize"]["height"])o+="max-height:"+e["arSize"]["height"]+"px;";if(o!=="")this.parser["postimage"]["wysiwyg"]=this.parser["postimage"]["wysiwyg"].replace("#ADDITIONAL#",' style="'+o+'" #ADDITIONAL#')}},initFiles:function(e,t){this.arFiles={};this.controllers={common:{postfix:"",storage:"bfile",parser:"postimage",node:window,obj:null,init:false}};this.monitoring={interval:null,text:"",savedText:"",files:[],savedFiles:[]};if(!t["CID"]||typeof t["CID"]!=="object")return;BX.addCustomEvent(this.eventNode,"onFileIsAdded",BX.delegate(this.OnFileUploadSuccess,this));BX.addCustomEvent(this.eventNode,"onFileIsFailed",BX.delegate(this.OnFileUploadFailed,this));BX.addCustomEvent(this.eventNode,"onFileIsDeleted",BX.delegate(this.OnFileUploadRemove,this));BX.addCustomEvent(this.eventNode,"onFileIsDetected",BX.delegate(this.setContent,this));BX.addCustomEvent(this.eventNode,"onFileIsInserted",BX.delegate(this.insertFile,this));var i,s,a;for(s in t["CID"]){if(t["CID"].hasOwnProperty(s)){i=t["CID"][s]["parser"];if(i=="disk_file")this.controllers[s]=new n(this,s,t["CID"][s]);else if(i=="webdav_element")this.controllers[s]=new o(this,s,t["CID"][s]);else if(i=="file")this.controllers[s]=new r(this,s,t["CID"][s]);if(this.controllers[s]&&this.controllers[s].init()&&!a)a=true}}BX.ready(BX.delegate(function(){BX.bind(BX("bx-b-uploadfile-"+e),"click",BX.proxy(this.controllerInit,this));if(a)this.controllerInit("show")},this))},controllerInit:function(e){this.controllerInitStatus=e=="show"||e=="hide"?e:this.controllerInitStatus=="show"?"hide":"show";BX.onCustomEvent(this.eventNode,"onShowControllers",[this.controllerInitStatus])},initUrlPreview:function(){if(this.params["urlPreviewId"]&&window["BXUrlPreview"]&&BX(this.params["urlPreviewId"])){return new BXUrlPreview(BX(this.params["urlPreviewId"]))}return null},getContent:function(){return this.oEditor?this.oEditor.GetContent():""},setContent:function(e){if(this.oEditor)this.oEditor.SetContent(e)},OnFileUploadSuccess:function(e,t,i,n){if(this.controllers[t.id]){var o=t.parser.bxTag+e.id;this.arFiles[o]=this.arFiles[o]||[];this.arFiles[o].push(t.id);if(n&&n["referrerToEditor"]){var r=this.getFileToInsert(e,t);BX.onCustomEvent(n["referrerToEditor"],"OnImageDataUriCaughtUploaded",[r]);BX.onCustomEvent(this.oEditor,"OnImageDataUriCaughtUploaded",[n["referrerToEditor"],e,r])}else if(i===true&&e.isImage&&this.insertImageAfterUpload){if(!this._insertFile)this._insertFile=BX.delegate(this.insertFile,this);this.exec(this._insertFile,arguments)}}},OnFileUploadFailed:function(e,t,i){if(i&&i["referrerToEditor"]){BX.onCustomEvent(i["referrerToEditor"],"OnImageDataUriCaughtFailed",[]);BX.onCustomEvent(this.editor,"OnImageDataUriCaughtFailed",[i["referrerToEditor"]])}},OnFileUploadRemove:function(e,t){if(this.controllers[t.id]){var i=t.parser.bxTag+e.id;if(this.arFiles[i]){var n=BX.util.array_search(t.id,this.arFiles[i]);this.arFiles[i]=BX.util.deleteFromArray(this.arFiles[i],n);if(!this.arFiles[i]||this.arFiles[i].length<=0){this.arFiles[i]=null;delete this.arFiles[i];if(!this._deleteFile)this._deleteFile=BX.delegate(this.deleteFile,this);this.exec(this._deleteFile,arguments)}}}},showPanelEditor:function(e,t){if(e==undefined)e=!this.oEditor.toolbar.IsShown();this.params.showPanelEditor=e;var i=BX("lhe_button_editor_"+this.formID),n=BX("panel-close"+this.__divId);if(n){this.oEditor.dom.cont.appendChild(n)}if(e){this.oEditor.dom.toolbarCont.style.opacity="inherit";this.oEditor.toolbar.Show();if(i)BX.addClass(i,"feed-add-post-form-btn-active");if(n)n.style.display=""}else{this.oEditor.toolbar.Hide();if(i)BX.removeClass(i,"feed-add-post-form-btn-active");if(n)n.style.display="none"}if(t!==false)BX.userOptions.save("main.post.form","postEdit","showBBCode",e?"Y":"N")},monitoring:{},monitoringStart:function(){if(this.monitoring.interval===null){if(!this._monitoringStart){this._monitoringStart=BX.delegate(this.checkFilesInText,this);BX.addCustomEvent(this.oEditor,"OnContentChanged",BX.proxy(function(e){this.monitoring.text=e},this))}this.monitoring.interval=setInterval(this._monitoringStart,1e3)}},monitoringStop:function(){var e=this.monitoring.interval!==null;if(this.monitoring.interval!==null)clearInterval(this.monitoring.interval);this.monitoring.interval=null;return e},monitoringSetStatus:function(e,t,i){if(this.arFiles[e+t]){var n;for(var o=0;o<this.arFiles[e+t].length;o++){n=this.arFiles[e+t][o];BX.onCustomEvent(this.controllers[n],"onFileIsInText",[t,i])}}},checkFilesInText:function(){if(this.monitoring.text!==this.monitoring.savedText){this.monitoring.savedText=this.monitoring.text;this.monitoring.files=[];var e=this.monitoring.savedText,t,i=function(e,t){return function(i,n,o){e.monitoring.files.push([t,o].join("/"))}};for(t in this.parser){if(this.parser.hasOwnProperty(t)){if(!this.parser[t]["checkFilesInText"]){this.parser[t]["checkFilesInText"]=i(this,t)}e.replace(this.parser[t]["regexp"],this.parser[t]["checkFilesInText"])}}if(this.monitoring.savedFiles.join(",")!==this.monitoring.files.join(",")){var n={},o;while(o=this.monitoring.savedFiles.pop()){n[o]=null}for(t=0;t<this.monitoring.files.length;t++){o=this.monitoring.files[t];n[o]=n[o]>=0?n[o]+1:1}for(t in n){if(n.hasOwnProperty(t)){o=t.split("/");this.monitoringSetStatus(o[0],o[1],n[t]>0)}}}this.monitoring.savedFiles=this.monitoring.files;if(this.monitoring.savedFiles.length<=0)this.monitoringStop()}},checkFile:function(e,t){var i=false;if(typeof e=="string"){var n=typeof t=="string"?t:t.parser;if(!!this.arFiles[n+e]){var o=this.arFiles[n+e][0];t=this.controllers[o];i={file:t.values[e],controller:t}}}else if(this.controllers[t.id]){i={file:e,controller:t}}return i},insertFile:function(e,t){var i=this.oEditor;if(i&&e){var n=i.GetViewMode(),o=this.getFileToInsert(e,t);if(n=="wysiwyg"){i.InsertHtml(o.replacement);setTimeout(BX.delegate(i.AutoResizeSceleton,i),500);setTimeout(BX.delegate(i.AutoResizeSceleton,i),1e3)}else if(n=="code"){i.textareaView.Focus();if(!i.bbCode){var r=i.GetIframeDoc();var s=r.createElement("DIV");s.style.display="none";s.innerHTML=o.replacement;r.body.appendChild(s);o.replacement=i.Parse(o.replacement,true,false);s.parentNode.removeChild(s)}i.textareaView.WrapWith("","",o.replacement)}else{return}o["callback"]()}},getFileToInsert:function(e,t){var i=this.oEditor;if(i&&e){var n=e["id"],o="",r=t.parser,s=i.bbCode?i.GetViewMode():"wysiwyg",a=this.parser[r.bxTag][s];if(e["fileType"]&&this.parser[e["fileType"]]&&s=="wysiwyg"){a=this.parser[e["fileType"]][s]}if(e["isImage"]){a=s=="wysiwyg"?this.parser["postimage"][s]:a;if(e.width>0&&e.height>0&&i.sEditorMode=="html"){o=' style="width:'+e.width+"px;height:"+e.height+"px;\" onload=\"this.style.width='auto';this.style.height='auto';\""}}if(s=="wysiwyg"){a=a.replace("#ID#",i.SetBxTag(false,{tag:r.bxTag,params:{value:n}})).replace("#SRC#",e.src).replace("#URL#",e.url).replace("#LOWSRC#",e.lowsrc||"").replace("#NAME#",e.name).replace("#ADDITIONAL#",o)+"<span>&nbsp;</span>"}else if(s=="code"&&i.bbCode){a=a.replace("#ID#",n).replace("#ADDITIONAL#","")}return{replacement:a,callback:BX.proxy(function(){this.monitoringSetStatus(t.parser.bxTag,e.id,true);this.monitoringStart()},this)}}return{replacement:"",callback:BX.DoNothing}},deleteFile:function(e,t){var i=this.oEditor,n=t.parser,o=e.id,r=i.GetContent();if(n&&r.indexOf("="+o)>=0){if(i.GetViewMode()=="wysiwyg"){var s=i.GetIframeDoc(),a,d;for(a in i["bxTags"]){if(i["bxTags"].hasOwnProperty(a)){if(typeof i.bxTags[a]=="object"&&i.bxTags[a]["params"]&&i.bxTags[a]["params"]["value"]==e.id){d=s.getElementById(a);if(d)d.parentNode.removeChild(d)}}}i.SaveContent()}else{r=r.replace(n.regexp,function(t,i,n){return n==e.id?"":t});i.SetContent(r);i.Focus()}this.monitoringSetStatus(n.bxTag,e.id,false)}},reinit:function(e,t){BX.onCustomEvent(this.eventNode,"onReinitializeBefore",[this,e,t]);this.arFiles={};delete this.monitoringWakeUp;this.monitoringStop();this.oEditor.CheckAndReInit(e||"");BX.onCustomEvent(this.eventNode,"onReinitialize",[this,e,t]);var i,n=false;for(i in this.controllers){if(this.controllers.hasOwnProperty(i)){if(this.controllers[i]["init"]&&this.controllers[i].reinit(e,t))n=true}}this.controllerInit(n?"show":"hide");if(this.params["~height"]){this.oEditor.SetConfigHeight(this.params["~height"]);this.oEditor.ResizeSceleton()}if(this.urlPreview){this.urlPreview.detachUrlPreview();var o;for(var r in t){if(t.hasOwnProperty(r)&&t[r].hasOwnProperty("USER_TYPE_ID")&&t[r]["USER_TYPE_ID"]==="url_preview"){o=t[r]["VALUE"]}}if(o)this.urlPreview.attachUrlPreview({id:o})}},Parse:function(e,t,i){var n=this.parser[e],o=this;if(n){t=t.replace(n.regexp,function(t,r,s,a,d){var l=o.checkFile(s,e);if(l&&(l=l.file)&&l){var h="",f=l.isImage?o.parser.postimage.wysiwyg:n.wysiwyg;o.monitoringStart();if(l.fileType&&o.parser[l.fileType]&&o.parser[l.fileType].wysiwyg){f=o.parser[l.fileType].wysiwyg}if(l.isImage){a=parseInt(a);d=parseInt(d);h=a&&d?' width="'+a+'" height="'+d+'"':"";if(h===""&&l["width"]>0&&l["height"]>0){h=' style="width:'+l["width"]+"px;height:"+l["height"]+"px;\" onload=\"this.style.width='auto';this.style.height='auto';\""}}return f.replace("#ID#",i.SetBxTag(false,{tag:e,params:{value:s}})).replace("#NAME#",l.name).replace("#SRC#",l.src).replace("#LOWSRC#",l.lowsrc).replace("#ADDITIONAL#",h).replace("#WIDTH#",parseInt(a)).replace("#HEIGHT#",parseInt(d))}return t})}return t},Unparse:function(e,t){var i="",n=e.tag;if(this.parser[n]){var o=parseInt(t.node.hasAttribute("width")?t.node.getAttribute("width"):0),r=parseInt(t.node.hasAttribute("height")?t.node.getAttribute("height"):0),s="";if(o>0&&r>0){s=" WIDTH="+o+" HEIGHT="+r}i=this.parser[n]["code"].replace("#ID#",e.params.value).replace("#ADDITIONAL#",s).replace("#WIDTH#",o).replace("#HEIGHT#",r)}return i},OnShowLHE:function(e,t,i){var n=this.__divId;e=e===false?false:e==="hide"?"hide":e==="justShow"?"justShow":true;this.oEditor=this.oEditor||s.getEditor(this.oEditorId);if(!this.oEditor)return;this.oEditor.Init();var o=BX("micro"+n),r=this.eventNode;if(o){o.style.display=e===true||e==="justShow"?"none":"block"}if(e=="hide"){BX.onCustomEvent(this.eventNode,"OnBeforeHideLHE",[e,this]);if(this.eventNode.style.display=="none"){BX.onCustomEvent(this.eventNode,"OnAfterHideLHE",[e,this])}else{new BX["easing"]({duration:200,start:{opacity:100,height:this.eventNode.scrollHeight},finish:{opacity:0,height:20},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:function(e){r.style.height=e.height+"px";r.style.opacity=e.opacity/100},complete:BX.proxy(function(){this.eventNode.style.cssText="";this.eventNode.style.display="none";BX.onCustomEvent(r,"OnAfterHideLHE",[e,this])},this)}).animate()}}else if(e){BX.onCustomEvent(this.eventNode,"OnBeforeShowLHE",[e,this]);if(e=="justShow"){this.eventNode.style.display="block";BX.onCustomEvent(this.eventNode,"OnAfterShowLHE",[e,this]);if(i!==false)this.oEditor.Focus()}else if(this.eventNode.style.display=="block"){BX.onCustomEvent(this.eventNode,"OnAfterShowLHE",[e,this]);if(i!==false)this.oEditor.Focus()}else{BX.adjust(this.eventNode,{style:{display:"block",overflow:"hidden",height:"20px",opacity:.1}});new BX["easing"]({duration:200,start:{opacity:10,height:20},finish:{opacity:100,height:r.scrollHeight},transition:BX["easing"].makeEaseOut(BX.easing.transitions.quad),step:function(e){r.style.height=e.height+"px";r.style.opacity=e.opacity/100},complete:BX.proxy(function(){BX.onCustomEvent(r,"OnAfterShowLHE",[e,this]);this.oEditor.Focus();this.eventNode.style.cssText=""},this)}).animate()}}else{BX.onCustomEvent(this.eventNode,"OnBeforeHideLHE",[e,this]);this.eventNode.style.display="none";BX.onCustomEvent(this.eventNode,"OnAfterHideLHE",[e,this])}},OnButtonClick:function(e){if(e!=="cancel"){var t={result:true};BX.onCustomEvent(this.eventNode,"OnClickBeforeSubmit",[this,t]);if(t["result"]!==false)BX.onCustomEvent(this.eventNode,"OnClickSubmit",[this])}else{BX.onCustomEvent(this.eventNode,"OnClickCancel",[this]);BX.onCustomEvent(this.eventNode,"OnShowLHE",["hide"])}},OnEditorInitedBefore:function(e){var t=this;this.oEditor=e;e.formID=this.formID;if(this.params)this.params["~height"]=e.config["height"];BX.addCustomEvent(e,"OnCtrlEnter",function(){e.SaveContent();if(t.params&&t.params["ctrlEnterHandler"]&&typeof window[t.params["ctrlEnterHandler"]]=="function")window[t.params["ctrlEnterHandler"]]();else BX.submit(BX(t.formID))});var i=this.params.parsers?this.params.parsers:[];if(BX.util.object_search("Spoiler",i)){e.AddButton({id:"spoiler",name:BX.message("spoilerText"),iconClassName:"spoiler",disabledForTextarea:false,src:BX.message("MPF_TEMPLATE_FOLDER")+"/images/lhespoiler.png",toolbarSort:205,handler:function(){var e=this,t=false;if(!e.editor.bbCode||!e.editor.synchro.IsFocusedOnTextarea()){t=e.editor.action.actions.formatBlock.exec("formatBlock","blockquote","bx-spoiler",false,{bxTagParams:{tag:"spoiler"}})}else{t=e.editor.action.actions.formatBbCode.exec("quote",{tag:"SPOILER"})}return t}});e.AddParser({name:"spoiler",obj:{Parse:function(e,t,i){if(/\[(cut|spoiler)(([^\]])*)\]/gi.test(t)){t=t.replace(/[\001-\006]/gi,"").replace(/\[cut(((?:=)[^\]]*)|)\]/gi,"$1").replace(/\[\/cut]/gi,"").replace(/\[spoiler([^\]]*)\]/gi,"$1").replace(/\[\/spoiler]/gi,"");var n=/(?:\001([^\001]*)\001)([^\001-\004]+)\002/gi,o=/(?:\003([^\003]*)\003)([^\001-\004]+)\004/gi,r=function(e,t){e=e.replace(/^(="|='|=)/gi,"").replace(/("|')?$/gi,"");return'<blockquote class="bx-spoiler" id="'+i.SetBxTag(false,{tag:"spoiler"})+'" title="'+e+'">'+t+"</blockquote>"},s=function(e,t,i){return r(t,i)};while(t.match(n)||t.match(o)){t=t.replace(n,s).replace(o,s)}}t=t.replace(/\001([^\001]*)\001/gi,"[cut$1]").replace(/\003([^\003]*)\003/gi,"[spoiler$1]").replace(/\002/gi,"[/cut]").replace(/\004/gi,"[/spoiler]");return t},UnParse:function(t,i){if(t.tag=="spoiler"){var n="",o;for(o=0;o<i.node.childNodes.length;o++){n+=e.bbParser.GetNodeHtml(i.node.childNodes[o])}n=BX.util.trim(n);if(n!="")return"[SPOILER"+(i.node.hasAttribute("title")?"="+i.node.getAttribute("title"):"")+"]"+n+"[/SPOILER]"}return""}}})}if(BX.util.object_search("MentionUser",i)){e.AddParser({name:"postuser",obj:{Parse:function(t,i){i=i.replace(/\[USER\s*=\s*(\d+)\]((?:\s|\S)*?)\[\/USER\]/gi,function(t,i,n){n=BX.util.trim(n);if(n=="")return"";return'<span id="'+e.SetBxTag(false,{tag:"postuser",params:{value:parseInt(i)}})+'" class="bxhtmled-metion">'+n+"</span>"});return i},UnParse:function(t,i){if(t.tag=="postuser"){var n="",o;for(o=0;o<i.node.childNodes.length;o++){n+=e.bbParser.GetNodeHtml(i.node.childNodes[o])}n=BX.util.trim(n);if(n!="")return"[USER="+t.params.value+"]"+n+"[/USER]"}return""}}})}var n=function(i,n){return t.Parse(i,n,e)},o=function(e,i){return t.Unparse(e,i)};for(var r in this.parser){if(this.parser.hasOwnProperty(r)){e.AddParser({name:r,obj:{Parse:n,UnParse:o}})}}if(this.showPinButton){this.pinEditorPanel=this.params&&this.params.pinEditorPanel===true;var s="toolbar_pin";var a=function(e,i){a.superclass.constructor.apply(this,arguments);this.id=s;this.title=BX.message("MPF_PIN_EDITOR_PANNEL");this.className+=" "+(t.pinEditorPanel?"bxhtmled-button-toolbar-pined":"bxhtmled-button-toolbar-pin");this.Create();if(i)i.appendChild(this.GetCont())};BX.extend(a,window.BXHtmlEditor.Button);a.prototype.OnClick=function(){BX.removeClass(this.pCont,"bxhtmled-button-toolbar-pined");BX.removeClass(this.pCont,"bxhtmled-button-toolbar-pin");if(t.pinEditorPanel){t.pinEditorPanel=false;BX.addClass(this.pCont,"bxhtmled-button-toolbar-pin")}else{t.pinEditorPanel=true;BX.addClass(this.pCont,"bxhtmled-button-toolbar-pined")}BX.userOptions.save("main.post.form","postEdit","pinEditorPanel",t.pinEditorPanel?"Y":"N")};window.BXHtmlEditor.Controls[s]=a;BX.addCustomEvent(e,"GetControlsMap",function(e){e.push({id:s,compact:true,hidden:false,sort:500,checkWidth:true,offsetWidth:32,wrap:"right"})})}},OnEditorInitedAfter:function(t){BX.addCustomEvent(t,"OnIframeDrop",BX.proxy(function(){BX.onCustomEvent(this.eventNode,"OnIframeDrop",arguments)},this));BX.addCustomEvent(t,"OnIframeDragOver",BX.proxy(function(){BX.onCustomEvent(this.eventNode,"OnIframeDragOver",arguments)},this));BX.addCustomEvent(t,"OnIframeDragLeave",BX.proxy(function(){BX.onCustomEvent(this.eventNode,"OnIframeDragLeave",arguments)},this));BX.addCustomEvent(t,"OnImageDataUriHandle",BX.proxy(function(){BX.onCustomEvent(this.eventNode,"OnImageDataUriHandle",arguments)},this));BX.addCustomEvent(t,"OnAfterUrlConvert",this.OnAfterUrlConvert.bind(this));BX.addCustomEvent(t,"OnBeforeCommandExec",this.OnBeforeCommandExec.bind(this));t.contextMenu.items["postimage"]=t.contextMenu.items["postdocument"]=t.contextMenu.items["postfile"]=[{TEXT:BX.message("BXEdDelFromText"),bbMode:true,ACTION:function(){var e=t.contextMenu.GetTargetItem("postimage");if(!e)e=t.contextMenu.GetTargetItem("postdocument");if(!e)e=t.contextMenu.GetTargetItem("postfile");if(e&&e.element){t.selection.RemoveNode(e.element)}t.contextMenu.Hide()}}];if(!this.params["lazyLoad"]){BX.onCustomEvent(this.eventNode,"OnShowLHE",["justShow",t,false])}if(t.toolbar.controls&&t.toolbar.controls.FontSelector){t.toolbar.controls.FontSelector.SetWidth(45)}BX.addCustomEvent(BX(this.formID),"onAutoSavePrepare",function(e){var i=e;setTimeout(function(){BX.addCustomEvent(t,"OnContentChanged",BX.proxy(function(e){this["mpfTextContent"]=e;this.Init()},i))},1500)});BX.addCustomEvent(BX(this.formID),"onAutoSave",BX.proxy(function(e,t){if(BX.type.isNotEmptyString(e["mpfTextContent"]))t["text"+this.formID]=e["mpfTextContent"]},this));BX.addCustomEvent(BX(this.formID),"onAutoSaveRestore",BX.proxy(function(i,n){if(e.handler[t.id]){for(var o in e.handler[t.id].controllers){if(e.handler[t.id].controllers.hasOwnProperty(o)&&e.handler[t.id].controllers[o].handler&&e.handler[t.id].controllers[o].handler.params&&e.handler[t.id].controllers[o].handler.params.controlName&&e.handler[t.id].controllers[o].handler.params.controlName){delete n[e.handler[t.id].controllers[o].handler.params.controlName]}}}if(n["text"+this.formID]&&/[^\s]+/gi.test(n["text"+this.formID])){t.CheckAndReInit(n["text"+this.formID])}},this));if(BX(this.formID)&&BX(this.formID).hasAttribute("bx-lhe-autosave-prepared")&&BX(this.formID).BXAUTOSAVE){BX(this.formID).removeAttribute("bx-lhe-autosave-prepared");setTimeout(BX.proxy(function(){BX(this.formID).BXAUTOSAVE.Prepare()},this),100)}var i=this.formID,n=this.params;this.showPanelEditor(n.showPanelEditor,false);if(!t.mainPostFormCustomized){t.mainPostFormCustomized=true;BX.addCustomEvent(t,"OnIframeKeydown",function(e){if(window.onKeyDownHandler){window.onKeyDownHandler(e,t,i)}});BX.addCustomEvent(t,"OnIframeKeyup",function(e){if(window.onKeyUpHandler){window.onKeyUpHandler(e,t,i)}});if(window["BXfpdStopMent"+i]){BX.addCustomEvent(t,"OnIframeClick",function(){window["BXfpdStopMent"+i]()})}if(t&&t.textareaView.GetCursorPosition){BX.addCustomEvent(t,"OnTextareaKeyup",function(e){if(window.onTextareaKeyUpHandler){window.onTextareaKeyUpHandler(e,t,i)}});BX.addCustomEvent(t,"OnTextareaKeydown",function(e){if(window.onTextareaKeyDownHandler){window.onTextareaKeyDownHandler(e,t,i)}})}}},OnAfterUrlConvert:function(e){if(this.urlPreview){this.urlPreview.attachUrlPreview({url:e})}},OnBeforeCommandExec:function(e,t,i,n){if(this.urlPreview&&t=="createLink"&&BX.type.isPlainObject(n)&&n.hasOwnProperty("href")){this.urlPreview.attachUrlPreview({url:n.href})}}};s.getEditor=function(e){return window["BXHtmlEditor"]?window["BXHtmlEditor"].Get(typeof e=="object"?e.id:e):null};s.getHandler=function(t){return e.handler[typeof t=="object"?t.id:t]};s.unsetHandler=function(t){var i=typeof t=="object"?t.id:t;if(!e.handler[i])return;if(e.handler[i].oEditor)e.handler[i].oEditor.Destroy();e.handler[i]=null};s.reinitData=function(e,t,i){var n=s.getHandler(e);if(n)n.exec(n.reinit,[t,i]);return false};s.reinitDataBefore=function(e){var t=s.getHandler(e);if(t&&t["eventNode"])BX.onCustomEvent(t.eventNode,"onReinitializeBefore",[t])};window.LHEPostForm=s;window.BXPostFormTags=function(e,t){this.popup=null;this.formID=e;this.buttonID=t;this.sharpButton=null;this.addNewLink=null;this.tagsArea=null;this.hiddenField=null;this.popupContent=null;BX.ready(BX.proxy(this.init,this))};window.BXPostFormTags.prototype.init=function(){this.sharpButton=BX(this.buttonID);this.addNewLink=BX("post-tags-add-new-"+this.formID);this.tagsArea=BX("post-tags-block-"+this.formID);this.tagsContainer=BX("post-tags-container-"+this.formID);this.hiddenField=BX("post-tags-hidden-"+this.formID);this.popupContent=BX("post-tags-popup-content-"+this.formID);this.popupInput=BX.findChild(this.popupContent,{tag:"input"});var e=BX.findChildren(this.tagsContainer,{className:"feed-add-post-del-but"},true);for(var t=0,i=e.length;t<i;t++){BX.bind(e[t],"click",BX.proxy(this.onTagDelete,{obj:this,tagBox:e[t].parentNode,tagValue:e[t].parentNode.getAttribute("data-tag")}))}BX.bind(this.sharpButton,"click",BX.proxy(this.onButtonClick,this));BX.bind(this.addNewLink,"click",BX.proxy(this.onAddNewClick,this))};window.BXPostFormTags.prototype.onTagDelete=function(){BX.remove(this.tagBox);this.obj.hiddenField.value=this.obj.hiddenField.value.replace(this.tagValue+",","").replace("  "," ")};window.BXPostFormTags.prototype.show=function(){if(this.popup===null){this.popup=new BX.PopupWindow("bx-post-tag-popup",this.addNewLink,{content:this.popupContent,lightShadow:false,offsetTop:8,offsetLeft:10,autoHide:true,angle:true,closeByEsc:true,zIndex:-840,buttons:[new BX.PopupWindowButton({text:BX.message("TAG_ADD"),events:{click:BX.proxy(this.onTagAdd,this)}})]});BX.bind(this.popupInput,"keydown",BX.proxy(this.onKeyPress,this));BX.bind(this.popupInput,"keyup",BX.proxy(this.onKeyPress,this))}this.popup.show();BX.focus(this.popupInput)};window.BXPostFormTags.prototype.addTag=function(e){var t=BX.type.isNotEmptyString(e)?e.split(","):this.popupInput.value.split(",");var i=[];for(var n=0;n<t.length;n++){var o=BX.util.trim(t[n]);if(o.length>0){var r=this.hiddenField.value.split(",");if(!BX.util.in_array(o,r)){var s;var a=BX.create("span",{children:[s=BX.create("span",{attrs:{class:"feed-add-post-del-but"}})],attrs:{class:"feed-add-post-tags"}});a.insertBefore(document.createTextNode(o),s);this.tagsContainer.insertBefore(a,this.addNewLink);BX.bind(s,"click",BX.proxy(this.onTagDelete,{obj:this,tagBox:a,tagValue:o}));this.hiddenField.value+=o+",";i.push(o)}}}return i};window.BXPostFormTags.prototype.onTagAdd=function(){this.addTag();this.popupInput.value="";this.popup.close()};window.BXPostFormTags.prototype.onAddNewClick=function(e){e=e||window.event;this.show();BX.PreventDefault(e)};window.BXPostFormTags.prototype.onButtonClick=function(e){e=e||window.event;BX.show(this.tagsArea);this.show();BX.PreventDefault(e)};window.BXPostFormTags.prototype.onKeyPress=function(e){e=e||window.event;var t=e.keyCode?e.keyCode:e.which?e.which:null;if(t==13){setTimeout(BX.proxy(this.onTagAdd,this),0)}};window.BXPostFormImportant=function(e,t,i){if(i){this.formID=e;this.buttonID=t;this.inputName=i;this.fireButton=null;this.activeBlock=null;this.hiddenField=null;BX.ready(BX.proxy(this.init,this))}return false};window.BXPostFormImportant.prototype.init=function(){this.fireButton=BX(this.buttonID);this.activeBlock=BX(this.buttonID+"-active");var e=BX(this.formID);if(e){this.hiddenField=e[this.inputName];if(this.hiddenField&&this.hiddenField.value==1){this.showActive()}}BX.bind(this.fireButton,"click",BX.proxy(function(e){e=e||window.event;this.showActive();BX.PreventDefault(e)},this));BX.bind(this.activeBlock,"click",BX.proxy(function(e){e=e||window.event;this.hideActive();BX.PreventDefault(e)},this))};window.BXPostFormImportant.prototype.showActive=function(e){BX.hide(this.fireButton);BX.show(this.activeBlock,"inline-block");if(this.hiddenField){this.hiddenField.value=1}return false};window.BXPostFormImportant.prototype.hideActive=function(e){BX.hide(this.activeBlock);BX.show(this.fireButton,"inline-block");if(this.hiddenField){this.hiddenField.value=0}return false};var a=null;window.MPFbuttonShowWait=function(e){if(e&&!BX.type.isElementNode(e))e=null;e=e||this;e=e?e.tagName=="A"?e:e.parentNode:e;if(e){BX.addClass(e,"ui-btn-clock");a=e;BX.defer(function(){e.disabled=true})()}};window.MPFbuttonCloseWait=function(e){if(e&&!BX.type.isElementNode(e))e=null;e=e||a||this;if(e){e.disabled=false;BX.removeClass(e,"ui-btn-clock");a=null}};window.__mpf_wd_getinfofromnode=function(e,t){var i=BX.findChild(BX((e["prefixNode"]||"wd-doc")+e.element_id),{className:"files-preview",tagName:"IMG"},true,false);if(i){e.lowsrc=i.src;e.element_url=i.src.replace(/\Wwidth=(\d+)/,"").replace(/\Wheight\=(\d+)/,"");e.width=parseInt(i.getAttribute("data-bx-full-width"));e.height=parseInt(i.getAttribute("data-bx-full-height"))}else if(t.urlGet){e.element_url=t.urlGet.replace("#element_id#",e.element_id).replace("#ELEMENT_ID#",e.element_id).replace("#element_name#",e.element_name).replace("#ELEMENT_NAME#",e.element_name)}};var d={listen:false,plus:false,text:"",bSearch:false};window.onKeyDownHandler=function(e,t,i){var n=e.keyCode;if(!window["BXfpdStopMent"+i])return true;var o=window.MPFgetSelectorId("bx-mention-"+i+"-id");if(BX.util.in_array(n,[107,187])||(e.shiftKey||e.modifiers>3)&&BX.util.in_array(n,[50,43,61])||e.altKey&&BX.util.in_array(n,[76])||typeof e.getModifierState==="function"&&!!e.getModifierState("AltGraph")&&BX.util.in_array(n,[81])){setTimeout(function(){var e=t.selection.GetRange(),i=t.GetIframeDoc(),n=e?e.endContainer.textContent:"",r=n?n.slice(e.endOffset-1,e.endOffset):"",s=n?n.slice(e.endOffset-2,e.endOffset-1):"";if((r=="@"||r=="+")&&(!s||BX.util.in_array(s,["+","@",",","("])||s.length==1&&BX.util.trim(s)==="")){d.listen=true;d.listenFlag=true;d.text="";d.leaveContent=true;e.setStart(e.endContainer,e.endOffset-1);e.setEnd(e.endContainer,e.endOffset);t.selection.SetSelection(e);var a=BX.create("SPAN",{props:{id:"bx-mention-node"}},i);t.selection.Surround(a,e);e.setStart(a,1);e.setEnd(a,1);t.selection.SetSelection(e);if(BX.type.isNotEmptyString(o)){BX.onCustomEvent(window,"BX.MPF.MentionSelector:open",[{id:o,bindPosition:l(a,t)}])}}},10)}if(d.listen){var r=null;if(BX.type.isNotEmptyString(o)){r=BX.UI.SelectorManager.instances[o]}var s=false;if(r){s=r.getNavigationInstance().checkKeyboardNavigation({keyCode:n,tab:d.bSearch?"search":r?r.tabs.selected:false})}if(s){t.iframeKeyDownPreventDefault=true;e.stopPropagation();e.preventDefault()}}if(!d.listen&&d.listenFlag&&n===t.KEY_CODES["enter"]){var a=t.selection.GetRange();if(a.collapsed){var h=a.endContainer,f=t.GetIframeDoc();if(h){if(h.className!=="bxhtmled-metion"){h=BX.findParent(h,function(e){return e.className=="bxhtmled-metion"},f.body)}if(h&&h.className=="bxhtmled-metion"){t.selection.SetAfter(h)}}}}};window.onKeyUpHandler=function(e,t,i){var n=e.keyCode,o,r,s;if(!window["BXfpdStopMent"+i])return true;if(d.listen===true){if(n==t.KEY_CODES["escape"]){window["BXfpdStopMent"+i]()}else if(n!==t.KEY_CODES["enter"]&&n!==t.KEY_CODES["left"]&&n!==t.KEY_CODES["right"]&&n!==t.KEY_CODES["up"]&&n!==t.KEY_CODES["down"]){o=t.GetIframeDoc();var a=o.getElementById("bx-mention-node");if(a){s=BX.util.trim(t.util.GetTextContent(a));var h=s;s=s.replace(/^[\+@]*/,"");d.bSearch=s.length>0;var f=window.MPFgetSelectorId("bx-mention-"+i+"-id");if(BX.type.isNotEmptyString(f)){var u=BX.UI.SelectorManager.instances[f];if(BX.type.isNotEmptyObject(u)){u.getSearchInstance().runSearch({text:s})}}if(d.leaveContent&&d._lastText&&h===""){window["BXfpdStopMent"+i]()}else if(d.leaveContent&&d.lastText&&h!==""&&s===""){d.bSearch=false;window["BXfpdStopMent"+i]();if(BX.type.isNotEmptyString(f)){BX.onCustomEvent(window,"BX.MPF.MentionSelector:open",[{id:f,bindPosition:l(a,t)}])}}d.lastText=s;d._lastText=h}else{window["BXfpdStopMent"+i]()}}}else{if(!e.shiftKey&&(n===t.KEY_CODES["space"]||n===t.KEY_CODES["escape"]||n===188||n===190)){r=t.selection.GetRange();if(r.collapsed){var c=r.endContainer;o=t.GetIframeDoc();if(c){if(c.className!=="bxhtmled-metion"){c=BX.findParent(c,function(e){return e.className=="bxhtmled-metion"},o.body)}if(c&&c.className=="bxhtmled-metion"){s=t.util.GetTextContent(c);var p=s.match(/[\s\.\,]$/);if(p||n===t.KEY_CODES["escape"]){c.innerHTML=s.replace(/[\s\.\,]$/,"");var m=BX.create("SPAN",{html:p||t.INVISIBLE_SPACE},o);t.util.InsertAfter(m,c);t.selection.SetAfter(m)}}}}}}};window.onTextareaKeyDownHandler=function(e,t,i){var n=e.keyCode;if(d.listen&&n==t.KEY_CODES["enter"]){var o=window.MPFgetSelectorId("bx-mention-"+i+"-id");if(BX.type.isNotEmptyString(o)){var r=BX.UI.SelectorManager.instances[o];if(BX.type.isNotEmptyObject(r)){r.getNavigationInstance().selectFirstItem({tab:d.bSearch?"search":r.tabs.selected})}}t.textareaKeyDownPreventDefault=true;e.stopPropagation();e.preventDefault()}};window.onTextareaKeyUpHandler=function(e,t,i){var n,o,r=e.keyCode;var s=window.MPFgetSelectorId("bx-mention-"+i+"-id");if(d.listen===true){if(r==27){window["BXfpdStopMent"+i]()}else if(r!==13){o=t.textareaView.GetValue(false);n=t.textareaView.GetCursorPosition();if(o.indexOf("+")!==-1||o.indexOf("@")!==-1){var a=o.substr(0,n),l=Math.max(a.lastIndexOf("+"),a.lastIndexOf("@"));if(l>=0){var h=a.substr(l),f=h;h=h.replace(/^[\+@]*/,"");d.bSearch=h.length>0;var u=null;if(BX.type.isNotEmptyString(s)){u=BX.UI.SelectorManager.instances[s]}if(BX.type.isNotEmptyObject(u)){u.getSearchInstance().runSearch({text:h})}if(d.leaveContent&&d._lastText&&(f===""||h==="")){window["BXfpdStopMent"+i]()}d.lastText=h;d._lastText=f}}}}else{if(r==16){var c=this;this.shiftPressed=true;if(this.shiftTimeout)this.shiftTimeout=clearTimeout(this.shiftTimeout);this.shiftTimeout=setTimeout(function(){c.shiftPressed=false},100)}if(r==107||(e.shiftKey||e.modifiers>3||this.shiftPressed)&&BX.util.in_array(r,[187,50,107,43,61])){n=t.textareaView.element.selectionStart;if(n>0){o=t.textareaView.element.value;var p=o.substr(n-1,1);if(p&&(p==="+"||p==="@")){d.listen=true;d.listenFlag=true;d.text="";d.textarea=true;d.bSearch=false;if(BX.type.isNotEmptyString(s)){BX.onCustomEvent(window,"BX.MPF.MentionSelector:open",[{id:s}])}}}}}};var l=function(e,t){var i=BX.pos(e),n=BX.pos(t.dom.areaCont),o=BX.GetWindowScrollPos(t.GetIframeDoc()),r=n.top+i.bottom-o.scrollTop+2,s=n.left+i.right-o.scrollLeft;return{top:r,left:s}};window.BxInsertMention=function(e){var t=e.item,i=e.type,n=e.formID,o=e.editorId,r=e.bNeedComa,a=s.getEditor(o),l;if(i=="users"&&t&&t.entityId>0&&a){if(a.GetViewMode()=="wysiwyg"){var h=a.GetIframeDoc(),f=a.selection.GetRange(),u=h.getElementById("bx-mention-node"),c=BX.create("SPAN",{props:{className:"bxhtmled-metion"},text:BX.util.htmlspecialcharsback(t.name)},h);l=BX.create("SPAN",{html:r?",&nbsp;":"&nbsp;"},h);a.SetBxTag(c,{tag:"postuser",params:{value:t.entityId}});if(u){a.util.ReplaceNode(u,c)}else{a.selection.InsertNode(c,f)}if(c&&c.parentNode){var p=BX.findParent(c,{className:"bxhtmled-metion"},h.body);if(p){a.util.InsertAfter(c,p)}}if(c&&c.parentNode){a.util.InsertAfter(l,c);a.selection.SetAfter(l)}}else if(a.GetViewMode()=="code"&&a.bbCode){a.textareaView.Focus();var m=a.textareaView.GetValue(false),v=a.textareaView.GetCursorPosition(),g=m.substr(0,v),B=Math.max(g.lastIndexOf("+"),g.lastIndexOf("@"));if(B>=0&&v>B){a.textareaView.SetValue(m.substr(0,B)+m.substr(v));a.textareaView.element.setSelectionRange(B,B)}a.textareaView.WrapWith(false,false,"[USER="+t.entityId+"]"+t.name+"[/USER]"+(r?", ":" "))}if(e.fireAddEvent===true){BX.onCustomEvent(window,"onMentionAdd",[t])}var X=window.MPFgetSelectorId("bx-mention-"+n+"-id");if(BX.type.isNotEmptyString(X)){var w=BX.UI.SelectorManager.instances[X];if(BX.type.isNotEmptyObject(w)){if(typeof w.itemsSelected[t.id]!="undefined"){delete w.itemsSelected[t.id]}}}window["BXfpdStopMent"+n]();d["text"]="";if(a.GetViewMode()=="wysiwyg"){a.Focus();a.selection.SetAfter(l)}}};window.MPFgetSelectorId=function(e){var t=false;var i=BX(e);if(!i){return t}t=i.getAttribute("data-bx-selector-id");return t};window.MPFMentionInit=function(e,t){if(t.initDestination===true){BX.addCustomEvent("onAutoSaveRestoreDestination",function(t){if(BX.type.isNotEmptyObject(t)&&BX.type.isNotEmptyObject(t.data)&&BX.type.isNotEmptyObject(t.data["DEST_CODES[]"])&&BX.type.isNotEmptyString(t.formId)&&t.formId==e&&BX.UI.SelectorManager){var i=window.MPFgetSelectorId(t.formId);var n=BX.UI.SelectorManager.instances[i];if(!BX.type.isNotEmptyObject(n)){return}var o=null,r=null,s={},a=[],d=false;for(var l=0;l<t.data["DEST_CODES[]"].length;l++){o=t.data["DEST_CODES[]"][l];if(o=="UA"){s[o]="groups"}d=o.match(/^U(\d+)$/i);if(d){s[o]="users";continue}d=o.match(/^SG(\d+)$/i);if(d){s[o]="sonetgroups";continue}d=o.match(/^DR(\d+)$/i);if(d){s[o]="departments";continue}d=o.match(/^UE(.+)$/i);if(d&&BX.SocialnetworkUISelector){r=d[1];a.push({selectorId:i,name:BX.type.isNotEmptyString(t.data["INVITED_USER_NAME["+r+"]"])?t.data["INVITED_USER_NAME["+r+"]"]:"",lastName:BX.type.isNotEmptyString(t.data["INVITED_USER_LAST_NAME["+r+"]"])?t.data["INVITED_USER_LAST_NAME["+r+"]"]:"",email:r,createCrmContact:BX.type.isNotEmptyString(t.data["INVITED_USER_CREATE_CRM_CONTACT["+r+"]"])?t.data["INVITED_USER_CREATE_CRM_CONTACT["+r+"]"]:""})}}n.itemsSelected=s;BX.addCustomEvent(window,"BX.Main.SelectorV2:afterInitDialog",function(e){if(e.id==i&&BX.SocialnetworkUISelector){for(var t=0;t<a.length;t++){BX.SocialnetworkUISelector.inviteEmailAddUser(a[t])}}})}});BX.addCustomEvent(window,"onMentionAdd",function(t){var i=window.MPFgetSelectorId(e);var n=BX.UI.SelectorManager.instances[i];if(!BX.type.isNotEmptyObject(n)){return}if(!BX.type.isNotEmptyObject(n.entities.USERS.items[t.id])){n.entities.USERS.items[t.id]=t}n.setOption("focusInputOnSelectItem","N");if(!BX.type.isNotEmptyString(n.itemsSelected[t.id])){n.selectItem({itemId:t.id,entityType:"USERS"})}})}window["BXfpdSelectCallbackMent"+e]=function(i){window.BxInsertMention({item:i.item,type:i.entityType.toLowerCase(),formID:e,editorId:t.editorId,fireAddEvent:t.initDestination})};window["BXfpdStopMent"+e]=function(){var t=window.MPFgetSelectorId("bx-mention-"+e+"-id");if(BX.type.isNotEmptyString(t)){var i=BX.UI.SelectorManager.instances[t];if(BX.type.isNotEmptyObject(i)){i.closeAllPopups();i.getSearchInstance().abortSearchRequest()}}};BX.ready(function(){var i=BX("bx-b-mention-"+e);var n=window.MPFgetSelectorId("bx-mention-"+e+"-id");if(n){BX.onCustomEvent(window,"BX.MPF.MentionSelector:init",[{id:n,openDialogWhenInit:false}])}BX.bind(i,"mousedown",function(e){if(d.listen!==true){var o=s.getEditor(t.editorId),r=o.GetIframeDoc();if(o.GetViewMode()=="wysiwyg"&&r){d.listen=true;d.listenFlag=true;d.text="";d.leaveContent=false;var a=o.selection.GetRange(),l=r.getElementById("bx-mention-node");if(l){BX.remove(l)}o.InsertHtml('<span id="bx-mention-node">'+o.INVISIBLE_SPACE+"</span>",a);setTimeout(function(){if(n){BX.onCustomEvent(window,"BX.MPF.MentionSelector:open",[{id:n,bindNode:i}])}var e=r.getElementById("bx-mention-node");if(e){a.setStart(e,0);if(e.firstChild&&e.firstChild.nodeType==3&&e.firstChild.nodeValue.length>0){a.setEnd(e,1)}else{a.setEnd(e,0)}o.selection.SetSelection(a)}o.Focus()},100)}else if(o.GetViewMode()=="code"){d.listen=true;d.listenFlag=true;d.text="";d.leaveContent=false;setTimeout(function(){if(n){BX.onCustomEvent(window,"BX.MPF.MentionSelector:open",[{id:n,bindNode:i}])}},100)}BX.onCustomEvent(i,"mentionClick")}})})};window.BXfpdOnDialogOpen=function(){d.listen=true;d.listenFlag=true};window.BXfpdOnDialogClose=function(e){d.listen=false;setTimeout(function(){d.listenFlag=false;if(!d.listen){var t=s.getEditor(e.editorId);if(t){var i=t.GetIframeDoc(),n=i.getElementById("bx-mention-node");if(n){t.selection.SetAfter(n);if(d.leaveContent){t.util.ReplaceWithOwnChildren(n)}else{BX.remove(n)}}t.Focus()}}},100)}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:71:"/bitrix/components/bitrix/system.field.edit/script.min.js?1464958417814";s:6:"source";s:53:"/bitrix/components/bitrix/system.field.edit/script.js";s:3:"min";s:57:"/bitrix/components/bitrix/system.field.edit/script.min.js";s:3:"map";s:57:"/bitrix/components/bitrix/system.field.edit/script.map.js";}"*/
function addElement(e,n){if(document.getElementById("main_"+e)){var d=document.getElementById("main_"+e).getElementsByTagName("div");if(d&&d.length>0&&d[0]){var t=d[0].parentNode;t.appendChild(d[d.length-1].cloneNode(true))}}}function addElementFile(e,n){var d=document.getElementById("main_"+e);var t=document.getElementById("main_add_"+e);if(d&&t){t=t.cloneNode(true);t.id="";t.style.display="";d.appendChild(t)}}function addElementDate(e,n){var d=document.getElementById("date_container_"+n);var t=document.getElementById("hidden_"+n).innerHTML;if(d&&t){var a=e[n].fieldName;var i=e[n].index;t=t.replace(/[#]FIELD_NAME[#]/g,a+"["+i+"]");t=t.replace(/[\%]23FIELD_NAME[\%]23/g,escape(a+"["+i+"]"));var l=d.appendChild(document.createElement("DIV"));l.innerHTML+=t;e[n].index++}}
/* End */
;
; /* Start:"a:4:{s:4:"full";s:87:"/bitrix/components/bitrix/disk.uf.file/templates/.default/script.min.js?155370163828595";s:6:"source";s:67:"/bitrix/components/bitrix/disk.uf.file/templates/.default/script.js";s:3:"min";s:71:"/bitrix/components/bitrix/disk.uf.file/templates/.default/script.min.js";s:3:"map";s:71:"/bitrix/components/bitrix/disk.uf.file/templates/.default/script.map.js";}"*/
(function(e){var t=false,i=false,s=0,o=null,n=null,a={};BX.namespace("BX.Disk");if(BX.Disk.UF)return;BX.Disk.UF=function(){var t=function(t){this.dialogName="DiskFileDialog";this.params=t;this.CID=t["UID"];this.controller=t.controller;this.values=t.values||[];this.prefix="diskuf-doc";this.onUploaderIsAlmostInited=BX.delegate(this.onUploaderIsAlmostInited,this);BX.addCustomEvent(e,"onUploaderIsAlmostInited",this.onUploaderIsAlmostInited);this.agent=BX.Uploader.getInstance({id:t["UID"],streams:3,allowUpload:"A",uploadFormData:"N",uploadMethod:"immediate",uploadFileUrl:t["urlUpload"],showImage:false,sortItems:false,input:t["input"],dropZone:t["dropZone"],placeHolder:t["placeHolder"],queueFields:{thumb:{tagName:"TR",className:"wd-inline-file"}},fields:{thumb:{tagName:"",template:BX.message("DISK_TMPLT_THUMB")}}});this.urlSelect=!!t["urlSelect"]?t["urlSelect"]:null;this.urlRenameFile=!!t["urlRenameFile"]?t["urlRenameFile"]:null;this.urlDeleteFile=!!t["urlDeleteFile"]?t["urlDeleteFile"]:null;this.urlSelect=this._addUrlParam(this.urlSelect,"dialog2=Y&ACTION=SELECT&MULTI=Y");this.urlUpload=!!t["urlUpload"]?t["urlUpload"]:null;this.urlShow=!!t["urlShow"]?t["urlShow"]:null;this.params.controlName=this.params.controlName||"FILES[]";this.init();return this};t.prototype={_addUrlParam:function(e,t){if(!e)return null;if(e.indexOf(t)==-1)e+=(e.indexOf("?")==-1?"?":"&")+t;return e},_camelToSNAKE:function(e){var t={},i,s;for(i in e){s=i.replace(/(.)([A-Z])/g,"$1_$2").toUpperCase();t[s]=e[i];t[i]=e[i]}return t},onUploaderIsAlmostInited:function(t,i){if(this.CID!=i["id"])return;BX.removeCustomEvent(e,"onUploaderIsAlmostInited",this.onUploaderIsAlmostInited);var s=BX.findChild(this.controller,{className:"diskuf-simple"},true),o=BX.findChild(this.controller,{className:"diskuf-extended"},true);if(t=="BX.UploaderSimple"){BX.remove(o);BX.show(s)}else{BX.remove(s);BX.show(o)}i.input=BX.findChild(this.controller,{className:"diskuf-fileUploader"},true);i.dropZone=BX.findChild(this.controller,{className:"diskuf-extended"},false);this.params.placeHolder=i["placeHolder"]=BX.findChild(this.controller,{className:"diskuf-placeholder-tbody"},true)},init:function(){this._onItemIsAdded=BX.delegate(this.onItemIsAdded,this);this._onFileIsAppended=BX.delegate(this.onFileIsAppended,this);this._onFileIsAttached=BX.delegate(this.onFileIsAttached,this);this._onFileIsBound=BX.delegate(this.onFileIsBound,this);this._onFileIsInited=BX.delegate(this.onFileIsInited,this);this._onError=BX.delegate(this.onError,this);BX.addCustomEvent(this.agent,"onItemIsAdded",this._onItemIsAdded);BX.addCustomEvent(this.agent,"onFileIsInited",this._onFileIsInited);BX.addCustomEvent(this.agent,"onError",this._onError);this._onUploadProgress=BX.delegate(this.onUploadProgress,this);this._onUploadDone=BX.delegate(this.onUploadDone,this);this._onUploadError=BX.delegate(this.onUploadError,this);this._onUploadRestore=BX.delegate(this.onUploadRestore,this);BX.onCustomEvent(BX(this.controller.parentNode),"DiskDLoadFormControllerInit",[this]);var e=[],t=[],i;for(var s=0;s<this.values.length;s++){i=BX.findChild(this.values[s],{className:"f-wrap"},true);if(!!i){e.push({name:i.innerHTML});t.push(this.values[s])}}this.values=[];this.agent.onAttach(e,t);var o=BX.findChild(this.controller,{className:"diskuf-selector-link"},true);if(!!o){BX.bind(o,"click",BX.proxy(this.showSelectDialog,this))}var n=BX.findChildren(this.controller,{className:"diskuf-selector-link-cloud"},true);if(!!n){for(var a in n){if(!n.hasOwnProperty(a))continue;BX.bind(n[a],"click",BX.proxy(this.showSelectDialogCloudImport,this))}}return false},addFile:function(e){return this.agent&&this.agent.onChange([e])},onItemIsAdded:function(){BX.removeCustomEvent(this.agent,"onItemIsAdded",this._onItemIsAdded);BX.show(BX.findParent(this.params.placeHolder,{className:"diskuf-files-block"}))},onFileIsInited:function(e,t){BX.addCustomEvent(t,"onFileIsAttached",this._onFileIsAttached);BX.addCustomEvent(t,"onFileIsAfterCreated",function(e,t,i,s){if(t&&!t.sizeInt){e.size=" "}});BX.addCustomEvent(t,"onFileIsAppended",this._onFileIsAppended);BX.addCustomEvent(t,"onFileIsBound",this._onFileIsBound);BX.addCustomEvent(t,"onUploadProgress",this._onUploadProgress);BX.addCustomEvent(t,"onUploadDone",this._onUploadDone);BX.addCustomEvent(t,"onUploadError",this._onUploadError)},onFileIs:function(e,t,i){this.bindEventsHandlers(e,t,i);var s={element_id:i.element_id,element_name:i.element_name||t.name,element_url:i.element_name||i.previewUrl||i.preview_url,place:e,storage:"disk"};this.values.push(e);BX.onCustomEvent(this.params.controller.parentNode,"OnFileUploadSuccess",[s,this,t.file,t]);t.__disk_element_id=i.element_id;BX.onCustomEvent(t,"OnFileUploadSuccess",[s,this])},onFileIsAppended:function(e,t){var i=this.agent.getItem(e),s=i.node;this.bindEventsHandlers(s,t,{})},onFileIsBound:function(e,t){var i=this.agent.getItem(e),s=i.node,o=s.getAttribute("id").replace("disk-edit-attach","");this.onFileIs(s,t,{element_id:o})},onFileIsAttached:function(e,t,i,s){if(!!s["sizeFormatted"])s["size"]=s["sizeFormatted"];if(!s.hasOwnProperty("service")){this.onUploadDone(t,{file:s});return}BX.Disk.ExternalLoader.startLoad({file:{id:s.id,name:s.name,service:s.service},onFinish:BX.delegate(function(e){var i=this.agent.getItem(t.id).node;BX.hide(i);var s={id:e.ufId,name:e.name,storage:e.storage,ext:t.ext,size:e.sizeFormatted,previewUrl:e.previewUrl,preview_url:e.previewUrl,element_url:e.previewUrl,size_int:parseInt(e.size,10)};var o;var n=BX.message("DISK_TMPLT_THUMB2").replace("#control_name#",this.params.controlName).replace("#CONTROL_NAME#",this.params.controlName);for(var a in s){o=s[a];if(s.hasOwnProperty(a)){if(a.toLowerCase()=="size"){if(s.hasOwnProperty("size_int")){if(parseInt(s["size_int"],10)==0||isNaN(s["size_int"])){o=""}}if(s.hasOwnProperty("SIZE_INT")||isNaN(s["SIZE_INT"])){if(parseInt(s["SIZE_INT"],10)==0){o=""}}}n=n.replace(new RegExp("#"+a.toLowerCase()+"#","gi"),o).replace(new RegExp("#"+a.toUpperCase()+"#","gi"),o)}}var l={id:"disk-edit-attach"+s.id,"bx-agentFileId":t.id},r;r=BX.create("TR",{attrs:l,props:{className:"wd-inline-file"},html:n});var d=BX.findChild(r,{className:"files-name-edit-btn"},true);if(d){BX.remove(d)}i.parentNode.insertBefore(r,i);s.element_id=s.id;this.agent.onAttach([s],[r]);t.deleteFile()},this),onProgress:BX.delegate(function(e){this.onUploadProgress(t,e)},this)})},onUploadProgress:function(e,t){t=Math.min(t,98);var i=e.id;if(!e.__progressBarWidth)e.__progressBarWidth=5;if(t>e.__progressBarWidth){e.__progressBarWidth=Math.ceil(t);e.__progressBarWidth=e.__progressBarWidth>100?100:e.__progressBarWidth;if(BX("wdu"+i+"Progressbar"))BX.adjust(BX("wdu"+i+"Progressbar"),{style:{width:e.__progressBarWidth+"%"}});if(BX("wdu"+i+"ProgressbarText"))BX.adjust(BX("wdu"+i+"ProgressbarText"),{text:e.__progressBarWidth+"%"})}},onUploadDone:function(e,t){if(t["file"]&&t["file"]["attachId"]&&t["file"]["attachId"]!=t["file"]["id"]){t["file"]["id"]=t["file"]["attachId"];delete t["file"]["attachId"]}var i=this.agent.getItem(e.id).node,s=this._camelToSNAKE(t["file"]);if(BX(i)){var o=BX.message("DISK_TMPLT_THUMB2").replace("#control_name#",this.params.controlName).replace("#CONTROL_NAME#",this.params.controlName),n;for(var a in s){if(s.hasOwnProperty(a)){n=s[a];if(a.toLowerCase()=="size"){if(s.hasOwnProperty("size_int")){if(parseInt(s["size_int"],10)==0){n=""}}if(s.hasOwnProperty("SIZE_INT")){if(parseInt(s["SIZE_INT"],10)==0){n=""}}}if(a.toLowerCase()=="storage"&&n==="disk"){l(s.id).then(function(e){if(e.crumbs){var t=e.crumbs.join(" / ");var i=BX("disk-edit-attach"+s.id);if(i){var o=BX.findChild(i,{className:"files-placement"},true);if(o){BX.adjust(o,{text:t})}}}})}o=o.replace(new RegExp("#"+a.toLowerCase()+"#","gi"),n).replace(new RegExp("#"+a.toUpperCase()+"#","gi"),n)}}o=o.replace(new RegExp("#(width|height)#","gi"),"0").replace(new RegExp("#preview_url#","gi"),"javascript:void(0);");var r={id:"disk-edit-attach"+s.id,"bx-agentFileId":e.id},d;if(s["XML_ID"])r["bx-attach-xml-id"]=s["XML_ID"];if(s["FILE_ID"])r["bx-attach-file-id"]="n"+s["FILE_ID"];if(s["FILE_TYPE"])r["bx-attach-file-type"]=s["FILE_TYPE"];d=BX.create("TR",{attrs:r,props:{className:"wd-inline-file"},html:o});if(!t.file.canChangeName){var c=BX.findChild(d,{className:"files-name-edit-btn"},true);if(c){BX.remove(c)}}i.parentNode.replaceChild(d,i);s.element_id=s.id;this.onFileIs(d,e,s)}else{this.onUploadError(e,t,this.agent)}},onUploadError:function(e,t,i){var s=this.agent.getItem(e.id);if(!!s&&(s=s.node)&&BX(s)&&(i==true||!BX(s).hasAttribute("bx-disk-error"))){BX(s).setAttribute("bx-disk-error","Y");BX.adjust(s,{props:{className:"error-load"}});var o=t&&t["error"]?t["error"]:"Uploading error";s.cells[1].innerHTML="";s.cells[2].innerHTML='<span class="info-icon"></span><span class="error-text">'+o+"</span>";BX.onCustomEvent(e,"OnFileUploadFailed",[s,this]);BX.onCustomEvent(this.params.controller.parentNode,"OnFileUploadFailed",[s,this,e.file,e])}},onError:function(e,t,i){var s="Uploading error.",o=s,n,a;if(i){if(i["error"]&&typeof i["error"]=="string")o=i["error"];else if(i["message"]&&typeof i["message"]=="string")o=i["message"];else if(BX.type.isArray(i["errors"])&&i["errors"].length>0){o=[];for(var l=0;l<i["errors"].length;l++){if(typeof i["errors"][l]=="object"&&i["errors"][l]["message"])o.push(i["errors"][l]["message"])}if(o.length<=0)o.push("Uploading error.");o=o.join(" ")}}e.files=e.files||{};for(a in e.files){if(e.files.hasOwnProperty(a)){n=this.agent.queue.items.getItem(a);this.onUploadError(n,{error:o},o!=s)}}},onBlurRenameInput:function(e){var t=e.target||e.srcElement;var i=BX.findChild(t.parentNode,{className:"files-name-edit-btn"},true);if(!!i)BX.fireEvent(i,"click")},bindEventsHandlers:function(t,i,s){var o=s.element_id,n="file-action-control",a=BX.findChild(t,{className:"files-path"},true),l=BX.findChild(t,{className:"files-name-edit-btn"},true),r=BX.findChild(t,{className:"f-wrap"},true);if(!!l&&!!a&&!!r&&!a.getAttribute(n)){a.setAttribute(n,"enabled");BX.show(a,"inline");BX.hide(BX.findChild(t,{className:"files-placement"},true));BX.bind(a,"click",BX.delegate(function(){this.move(o,r.innerHTML,t)},this))}if(!!l){BX.bind(l,"click",BX.delegate(function(){BX.toggleClass(l.parentNode,"files-name-editable");this.rename(o,t)},this));var d=BX.findChild(t,{className:"files-name-edit-inp"},true);if(d){BX.bind(d,"keydown",BX.delegate(function(i){var s=(i||e.event).keyCode||(i||e.event).charCode;if(s==13){BX.unbind(d,"blur",BX.proxy(this.onBlurRenameInput,this));BX.toggleClass(l.parentNode,"files-name-editable");this.rename(o,t);return BX.PreventDefault(i)}if(s==27){BX.unbind(d,"blur",BX.proxy(this.onBlurRenameInput,this));BX.toggleClass(l.parentNode,"files-name-editable");this.revertRename(o,t);return BX.PreventDefault(i)}},this))}}var c=BX.findChild(t,{className:"feed-add-post-loading"},true),u=BX.delegate(function(){this.deleteFile(t,i)},this),h=BX.create("SPAN",{props:{className:"del-but"},events:{click:u}});if(!!c){var m=BX.findChild(c,{className:"del-but"},true);if(!!m)BX.bind(m,"click",u);else c.appendChild(h.cloneNode(true))}if(!BX.findChild(t,{className:"files-info"},true)){t.appendChild(BX.create("TD",{props:{className:"files-info"}}))}if(!BX.findChild(t,{className:"files-del-btn"},true)){t.appendChild(BX.create("TD",{props:{className:"files-del-btn"},children:[h]}))}if(!h.hasAttribute("bx-bound")){h.setAttribute("bx-bound","Y");BX.bind(h,"click",u);BX.onCustomEvent(t,"OnMkClose",[t])}var f=BX.findChild(t,{className:"transformer-upgrade-popup"},true);if(f){BX.show(f.parentNode);BX.bind(f,"click",BX.proxy(BX.Disk.UF.showTransformationUpgradePopup,this))}},deleteFile:function(e,t){if(!!t.__disk_element_id){BX.Disk.ajax({url:this.urlDeleteFile,method:"POST",dataType:"json",data:{attachedId:t.__disk_element_id},onsuccess:function(e){}});BX.onCustomEvent(this.controller.parentNode,"OnFileUploadRemove",[t.__disk_element_id,this])}BX.removeCustomEvent(t,"onFileIsAttached",this._onFileIsAttached);BX.removeCustomEvent(t,"onFileIsAppended",this._onFileIsAppended);BX.removeCustomEvent(t,"onFileIsBound",this._onFileIsBound);BX.removeCustomEvent(t,"onUploadProgress",this._onUploadProgress);BX.removeCustomEvent(t,"onUploadDone",this._onUploadDone);BX.removeCustomEvent(t,"onUploadError",this._onUploadError);delete t.hash;t.deleteFile("deleteFile");BX.remove(e)},move:function(e,t,i){var s=this._addUrlParam(this.urlSelect.replace("ACTION=SELECT","").replace("MULTI=Y",""),"ID=E"+e+"&NAME="+t+"&wish=fakemove");while(s.indexOf("&&")>=0)s=s.replace("&&","&");if(!this._checkFileName){this._checkFileName=BX.proxy(this.checkFileName,this);this._selectFolder=BX.proxy(this.selectFolder,this);this._openSection=BX.proxy(this.openSection,this);this._selectItem=BX.proxy(this.selectItem,this);this._unSelectItem=BX.proxy(this.unSelectItem,this)}var o=i||BX("disk-edit-attach"+e),n=BX.findChild(o,{className:"f-wrap"},true);BX.DiskFileDialog.arParams={};BX.DiskFileDialog.arParams[this.dialogName]={element_id:e,element_name:n.innerHTML};BX.addCustomEvent(BX.DiskFileDialog,"loadItems",this._openSection);BX.addCustomEvent(BX.DiskFileDialog,"selectItem",this._selectItem);BX.addCustomEvent(BX.DiskFileDialog,"unSelectItem",this._unSelectItem);return BX.ajax.get(s,"dialogName="+this.dialogName,BX.delegate(function(){setTimeout(BX.delegate(function(){BX.DiskFileDialog.obCallback[this.dialogName]={saveButton:this._selectFolder};BX.DiskFileDialog.openDialog(this.dialogName)},this),100)},this))},rename:function(e,t){if(!this.urlRenameFile){return}var i=BX.findChild(t,{className:"files-name-editable"},true);var s=BX.findChild(t,{className:"files-name-edit-inp"},true);var o=BX.findChild(t,{className:"f-wrap"},true);var n=o.textContent||o.innerText;var a=n.split(".").pop();var l=s.value+"."+a;if(!!i){BX.focus(s);BX.bind(s,"blur",BX.proxy(this.onBlurRenameInput,this))}else if(s.value&&l!==n){BX.adjust(o,{text:l});var r=t.getAttribute("bx-agentFileId");var d=r?this.agent.getItem(r):null;if(!!d){d.item.file.name=l;d.item.name=l}var c=this.manager?this.manager.checkFile("disk_file"+e):null;if(!!c){c.name=l}BX.Disk.ajax({url:this.urlRenameFile,method:"POST",dataType:"json",data:{newName:l,attachedId:e},onsuccess:function(e){}})}},revertRename:function(e,t){if(!this.urlRenameFile){return}var i=BX.findChild(t,{className:"files-name-editable"},true);var s=BX.findChild(t,{className:"files-name-edit-inp"},true);var o=BX.findChild(t,{className:"f-wrap"},true);var n=o.textContent||o.innerText;var a=n.split(".");var l=a.pop();s.value=a.join(".")},showMovedFile:function(e,t,i){if(!e)return false;var s,o=e,n=BX("disk-edit-attach"+o),a=BX.findChild(n,{className:"files-path"},true);BX.cleanNode(a);i=i.split("/").join(" / ");a.innerHTML=i;var l=parseInt(a.offsetWidth);var r=parseInt(a.parentNode.offsetWidth)-150,d;s=r/(l/i.length);if(l>r){d=Math.floor(s/2)+1;i=i.substr(0,d)+" ... "+i.substr(i.length-d);a.innerHTML=i}var c=BX("diskuf-doc"+o);if(!!c){var u=this._fileUnserialize(c.value);u.section=t["sectionID"];u.iblock=t["iblockID"];c.value=this._fileSerialize(u)}return true},_fileUnserialize:function(e){if(!BX.type.isString(e))return false;var t=e.split("|");return{id:t[0]||0,section:t[1]||0,iblock:t[2]||0}},_fileSerialize:function(e){var t=[e.id,e.section,e.iblock];return t.join("|")},selectFolder:function(e,t,i,s){var o=false,n=false,a,l,r;if(BX.DiskFileDialog.arParams&&BX.DiskFileDialog.arParams[this.dialogName]&&BX.DiskFileDialog.arParams[this.dialogName]["element_id"])o=BX.DiskFileDialog.arParams[this.dialogName]["element_id"];var d=BX.delegate(function(e,t,i,s){BX.Disk.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam("/bitrix/tools/disk/uf.php","action","moveUploadedFile"),data:{attachedId:e,targetFolderId:t},onsuccess:BX.delegate(function(t){if(!t||t.status!="success"){BX.Disk.showModalWithStatusAction(t);return}this.showMovedFile(e,i,s)},this)})},this);for(a in i){if(i.hasOwnProperty(a)&&i[a].type==="folder"){l=e.name+i[a].path;r={sectionID:a,iblockID:e.iblock_id};d(o,i[a].id,r,l);n=true}}if(!n){l=e.name;r={sectionID:e.section_id,iblockID:e.iblock_id};if(!!s&&!!s.path&&s.path!="/"){l+=s.path;r.sectionID=s.id;if(!!s){d(o,s.id,r,l)}}}BX.removeCustomEvent(BX.DiskFileDialog,"loadItems",this._openSection);BX.removeCustomEvent(BX.DiskFileDialog,"loadItemsDone",this._checkFileName);BX.removeCustomEvent(BX.DiskFileDialog,"selectItem",this._selectItem);BX.removeCustomEvent(BX.DiskFileDialog,"unSelectItem",this._unSelectItem)},checkFileName:function(e){if(this.noticeTimeout){clearTimeout(this.noticeTimeout);this.noticeTimeout=null}if(!!e&&e!=this.dialogName)return;var t=BX.DiskFileDialog.arParams[this.dialogName]["element_name"];var i=false,s;for(s in BX.DiskFileDialog.obItems[this.dialogName]){if(BX.DiskFileDialog.obItems[this.dialogName].hasOwnProperty(s)){if(BX.DiskFileDialog.obItems[this.dialogName][s]["name"]==t)i=true;if(i)break}}if(i)BX.DiskFileDialog.showNotice(BX.message("DISK_FILE_EXISTS"),this.dialogName);else BX.DiskFileDialog.closeNotice(this.dialogName)},selectItem:function(e,t,i){if(i!=this.dialogName)return;var s=t.substr(1);var o=BX.DiskFileDialog.obCurrentTab[i].link;o=o.replace("/index.php","")+"/element/upload/"+s+"/?use_light_view=Y&AJAX_CALL=Y&SIMPLE_UPLOAD=Y&IFRAME=Y&sessid="+BX.bitrix_sessid()+"&SECTION_ID="+s+"&CHECK_NAME="+BX.DiskFileDialog.arParams[this.dialogName]["element_name"];o=o.replace("/files/lib/","/files/");BX.ajax.loadJSON(o,BX.delegate(function(e){var t=e.permission===true&&e["okmsg"]!="";if(this.noticeTimeout){clearTimeout(this.noticeTimeout);this.noticeTimeout=null}this.noticeTimeout=setTimeout(BX.delegate(function(){if(t){BX.DiskFileDialog.showNotice(this.msg.file_exists,this.dialogName)}else{BX.DiskFileDialog.closeNotice(this.dialogName)}},this),200)},this))},unSelectItem:function(){if(this.noticeTimeout){clearTimeout(this.noticeTimeout);this.noticeTimeout=null}this.noticeTimeout=setTimeout(BX.delegate(function(){this.checkFileName()},this),200)},openSection:function(e,t){if(t==this.dialogName){BX.DiskFileDialog.target[t]=this._addUrlParam(e,"dialog2=Y")}},openSectionCloud:function(e,t){if(t==this.dialogName){BX.DiskFileDialog.target[t]=this._addUrlParam(e,"dialog2=Y");BX.DiskFileDialog.target[t]=this._addUrlParam(BX.DiskFileDialog.target[t],"cloudImport=1")}},selectFile:function(e,t,i){var s=[],o;for(o in i){if(i.hasOwnProperty(o)){if(i[o].type=="file"&&!BX(this.prefix+o)){i[o].sizeFormatted=i[o]["size"];i[o].size=i[o]["sizeInt"];if(!i[o]["ext"])i[o]["ext"]=i[o]["name"].split(".").pop();if(!i[o]["storage"])i[o]["storage"]="";s.push(i[o])}}}this.agent.onAttach(s,s);BX.removeCustomEvent(BX.DiskFileDialog,"loadItems",this._openSection)},selectCloudFile:function(e,t,i){var s=[],o;for(o in i){if(i.hasOwnProperty(o)){if(i[o].type=="file"&&!BX(this.prefix+o)){if(i[o].hasOwnProperty("provider")){i[o].service=i[o].provider}else{i[o].service=n}i[o].sizeFormatted=i[o]["size"];i[o].size=i[o]["sizeInt"];if(!i[o]["ext"])i[o]["ext"]=i[o]["name"].split(".").pop();if(!i[o]["storage"])i[o]["storage"]="";s.push(i[o])}}}this.agent.onAttach(s,s);BX.removeCustomEvent(BX.DiskFileDialog,"loadItems",this._openSection)},showSelectDialog:function(){this._openSection=BX.proxy(this.openSection,this);this._selectFile=BX.proxy(this.selectFile,this);BX.addCustomEvent(BX.DiskFileDialog,"loadItems",this._openSection);BX.ajax.get(this.urlSelect,"dialogName="+this.dialogName,BX.delegate(function(){setTimeout(BX.delegate(function(){BX.DiskFileDialog.obCallback[this.dialogName]={saveButton:this._selectFile};BX.DiskFileDialog.openDialog(this.dialogName)},this),10)},this))},showSelectDialogCloudImport:function(e){var t=e.target||e.srcElement;if(!BX.hasClass(t,"diskuf-selector-link-cloud")){t=BX.findParent(t,{className:"diskuf-selector-link-cloud"})}if(!t||!t.getAttribute("data-bx-doc-handler"))return;n=t.getAttribute("data-bx-doc-handler");this._openSection=BX.proxy(this.openSectionCloud,this);this._selectFile=BX.proxy(this.selectFile,this);this._selectCloudFile=BX.proxy(this.selectCloudFile,this);BX.addCustomEvent(BX.DiskFileDialog,"loadItems",this._openSection);BX.ajax.get(this.urlSelect,"&cloudImport=1&service="+n+"&dialogName="+this.dialogName,BX.delegate(function(){setTimeout(BX.delegate(function(){BX.DiskFileDialog.obCallback[this.dialogName]={saveButton:this._selectCloudFile};BX.DiskFileDialog.openDialog(this.dialogName)},this),10)},this))}};return t}();BX.Disk.UF.dndCatcher={};BX.Disk.UF.add=function(e){e["controller"]=BX("diskuf-selectdialog-"+e["UID"]);if(e["controller"]&&BX.isNodeInDom(e["controller"])){e["values"]=BX.findChildren(e["controller"],{className:"wd-inline-file"},true);var t=BX(e["controller"]).parentNode;BX.onCustomEvent(e["controller"],"DiskLoadFormControllerWasBound",[e,"DiskLoadFormControllerWasBound"]);if(!BX(e["controller"]).hasAttribute("bx-disk-load-is-bound")){BX(e["controller"]).setAttribute("bx-disk-load-is-bound","Y");BX.addCustomEvent(t,"DiskLoadFormController",function(t){BX.Disk.UF.initialize(t,e)})}if(!!e["values"]&&e["values"].length>0&&!e["hideSelectDialog"])BX.onCustomEvent(e["controller"].parentNode,"DiskLoadFormController",["show"])}};BX.Disk.UF.initialize=function(e,t){e=e==="show"||e==="hide"?e:t["controller"].style.display!="none"?"hide":"show";if(!t["controller"].loaded){t["controller"].loaded=true;a[t["UID"]]=new BX.Disk.UF(t)}if(e=="show"){if(t["controller"].style.display!="block"){BX.fx.show(t["controller"],"fade",{time:.2});if(t["switcher"]&&t["switcher"].style.display!="none")BX.fx.hide(t["switcher"],"fade",{time:.1});BX.onCustomEvent(t["controller"],"onControllerIsShown",[t["controller"],a[t["UID"]]]);o=a[t["UID"]]}}else if(t["controller"].style.display!="none"){o=null;BX.fx.hide(t["controller"],"fade",{time:.2});BX.onCustomEvent(t["controller"],"onControllerIsHidden",[t["controller"],a[t["UID"]]])}return a[t["UID"]]};var l=function(e){return BX.Disk.ajaxPromise({url:BX.Disk.addToLinkParam("/bitrix/tools/disk/uf.php","action","getBreadcrumbs"),method:"POST",dataType:"json",data:{attachedId:e}})};var r=function(e){if(!BX(e)||e.hasAttribute("bx-is-bound"))return;e.setAttribute("bx-is-bound","Y");this.img=e;this.node=e.parentNode.parentNode.parentNode;BX.unbindAll(e);BX.unbindAll(this.node);BX.show(this.node);BX.remove(this.node.nextSibling);this.id="wufdp_"+Math.random();BX.bind(this.node,"mouseover",BX.delegate(function(){this.turnOn()},this));BX.bind(this.node,"mouseout",BX.delegate(function(){this.turnOff()},this))};r.prototype={turnOn:function(){this.timeout=setTimeout(BX.delegate(function(){this.show()},this),500)},turnOff:function(){clearTimeout(this.timeout);this.timeout=null;this.hide()},show:function(){if(this.popup!=null)this.popup.close();if(this.popup==null){var e={width:this.img.naturalWidth,height:this.img.naturalHeight};if(BX["UploaderUtils"]){var t=BX.UploaderUtils.scaleImage(e,{width:parseInt(BX.message("DISK_THUMB_WIDTH")),height:parseInt(BX.message("DISK_THUMB_HEIGHT"))});e=t.destin}this.popup=new BX.PopupWindow("bx-wufd-preview-img-"+this.id,this.img.parentNode,{lightShadow:true,offsetTop:-7,offsetLeft:(51-28)/2+14,autoHide:true,closeByEsc:true,bindOptions:{position:"top"},events:{onPopupClose:function(){this.destroy()},onPopupDestroy:BX.proxy(function(){this.popup=null},this)},content:BX.create("DIV",{props:e,children:[BX.create("IMG",{props:e,attrs:{src:this.img.src}})]})});this.popup.show()}this.popup.setAngle({position:"bottom"});this.popup.bindOptions.forceBindPosition=true;this.popup.adjustPosition();this.popup.bindOptions.forceBindPosition=false},hide:function(){if(this.popup!=null)this.popup.close()}};BX.addCustomEvent("onDiskPreviewIsReady",function(e){new r(e)});BX.Disk.UF.runImport=function(e){BX.Disk.showActionModal({text:BX.message("DISK_UF_FILE_STATUS_PROCESS_LOADING"),showLoaderIcon:true,autoHide:false});BX.Disk.ExternalLoader.reloadLoadAttachedObject({attachedObject:{id:e.id,name:e.name,service:e.service},onFinish:BX.delegate(function(e){if(e.hasOwnProperty("hasNewVersion")&&!e.hasNewVersion){BX.Disk.showActionModal({text:BX.message("DISK_UF_FILE_STATUS_HAS_LAST_VERSION"),showSuccessIcon:true,autoHide:true})}else if(e.status==="success"){BX.Disk.showActionModal({text:BX.message("DISK_UF_FILE_STATUS_SUCCESS_LOADING"),showSuccessIcon:true,autoHide:true})}else{BX.Disk.showActionModal({text:BX.message("DISK_UF_FILE_STATUS_FAIL_LOADING"),autoHide:true})}},this),onProgress:BX.delegate(function(e){},this)}).start()};BX.Disk.UF.setDocumentHandlers=function(e){this.documentHandlers=e};BX.Disk.UF.getDocumentHandler=function(e){if(!this.documentHandlers){return""}var t=this.documentHandlers.find(function(t){return t.code===e});return t||{}};BX.Disk.UF.getDocumentHandlers=function(e){return this.documentHandlers};BX.Disk.UF.disableAutoCommentToAttachedObject=function(e){var t=e.attachedId;BX.Disk.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam("/bitrix/tools/disk/uf.php","action","disableAutoCommentToAttachedObject"),data:{attachedId:t},onsuccess:BX.delegate(function(e){},this)})};BX.Disk.UF.enableAutoCommentToAttachedObject=function(e){var t=e.attachedId;BX.Disk.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam("/bitrix/tools/disk/uf.php","action","enableAutoCommentToAttachedObject"),data:{attachedId:t},onsuccess:BX.delegate(function(e){},this)})};BX.Disk.UF.showTransformationUpgradePopup=function(e){B24.licenseInfoPopup.show("disk_transformation_video_limit",BX.message("DISK_UF_CONTROLLER_TRANSFORMATION_UPGRADE_POPUP_TITLE"),BX.message("DISK_UF_CONTROLLER_TRANSFORMATION_UPGRADE_POPUP_CONTENT"),false)};e.DiskCreateDocument=function(e,t){t.preventDefault();if(!BX.Disk.getDocumentService()){BX.Disk.saveDocumentService("l")}if(!o){return}if(!e){return}var i=function(e){var t=e.object.name.split(".");t.pop();var i={};i["E"+e.object.id]={type:"file",id:"n"+e.object.id,name:e.object.name,label:t.join("."),storage:e.folderName,size:e.object.size,sizeInt:e.object.sizeInt,ext:e.object.extension,canChangeName:true,link:e.link};setTimeout(function(){o.selectFile({},{},i)},200)};if(BX.Disk.Document.Local.Instance.isSetWorkWithLocalBDisk()){BX.Disk.Document.Local.Instance.createFile({type:e}).then(function(e){console.log("local createFile",e);i(e)}.bind(this));return}var s=new BX.Disk.Document.CreateProcess({typeFile:e,serviceCode:BX.Disk.getDocumentService(),onAfterSave:function(e,t){if(e.status!=="success"){return}i(t)}});s.start()};e.DiskOpenMenuCreateService=function(e){var t=[BX.Disk.Document.Local.Instance.isEnabled()?{text:BX.message("DISK_FOLDER_TOOLBAR_LABEL_LOCAL_BDISK_EDIT"),className:"bx-viewer-popup-item item-b24",onclick:function(t,i){i.getMenuWindow().close();BX.Disk.saveDocumentService("l");BX.adjust(e,{text:BX.message("DISK_FOLDER_TOOLBAR_LABEL_LOCAL_BDISK_EDIT")})}}:null,{text:BX.Disk.UF.getDocumentHandler("gdrive").name,className:"bx-viewer-popup-item item-gdocs",onclick:function(t,i){i.getMenuWindow().close();BX.Disk.saveDocumentService("gdrive");BX.adjust(e,{text:BX.Disk.UF.getDocumentHandler("gdrive").name})}},{text:BX.Disk.UF.getDocumentHandler("office365").name,className:"bx-viewer-popup-item item-office365",onclick:function(t,i){i.getMenuWindow().close();BX.Disk.saveDocumentService("office365");BX.adjust(e,{text:BX.Disk.UF.getDocumentHandler("office365").name})}},{text:BX.Disk.UF.getDocumentHandler("onedrive").name,className:"bx-viewer-popup-item item-office",onclick:function(t,i){i.getMenuWindow().close();BX.Disk.saveDocumentService("onedrive");BX.adjust(e,{text:BX.Disk.UF.getDocumentHandler("onedrive").name})}}];BX.PopupMenu.show("disk_open_menu_with_services",BX(e),t,{offsetTop:0,offsetLeft:25,angle:{position:"top",offset:45},autoHide:true,zIndex:1e4,overlay:{opacity:.01},events:{}})};e.DiskOpenMenuImportService=function(e,t){var i=[];for(var s in t){if(!t.hasOwnProperty(s))continue;i.push({text:t[s].name,code:t[s].id,href:"#",onclick:function(e,t){var i=t.layout.item;BX.addClass(i,"diskuf-selector-link-cloud");i.setAttribute("data-bx-doc-handler",t.code);BX.onCustomEvent("onManualChooseCloudImport",[{target:i}]);BX.removeClass(i,"diskuf-selector-link-cloud");i.removeAttribute("data-bx-doc-handler");BX.PopupMenu.destroy("disk_open_menu_with_import_services");return BX.PreventDefault(e)}})}var o=new BX.CViewer({});o.openMenu("disk_open_menu_with_import_services",BX(e),i,{offsetTop:0,offsetLeft:25});return BX.PreventDefault()};e.DiskActionFileMenu=function(e,t,i){s++;BX.PopupMenu.show("bx-viewer-wd-popup"+s+"_"+e,BX(t),i,{angle:{position:"top",offset:25},autoHide:true});return false};e.WDInlineElementClickDispatcher=function(e,t){var i=BX(t);if(i){BX.fireEvent(i,"click")}return false}})(window);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:89:"/bitrix/components/bitrix/main.urlpreview/templates/.default/script.min.js?15180185854554";s:6:"source";s:70:"/bitrix/components/bitrix/main.urlpreview/templates/.default/script.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
var BXUrlPreview=function(e){this.element=e;this.inputElement=null;this.id=this.element.id;this.carouselElement=null;this.carouselImages=[];this.currentImageId=null;this.init()};BXUrlPreview.prototype.init=function(){this.inputElement=this.element.querySelector(".urlpreview__ufvalue");this.initCarousel();this.bindEventHandlers()};BXUrlPreview.prototype.detachUrlPreview=function(){if(this.inputElement){this.inputElement.value=""}this.element.style.display="none"};BXUrlPreview.prototype.attachUrlPreview=function(e){var t,i;if(this.element.style.display!=="none"){return}i=this.element.getAttribute("data-field-id");requestParams={action:"attachUrlPreview",userFieldId:i,elementId:this.id,sessid:BX.bitrix_sessid()};if(e.hasOwnProperty("url"))requestParams.url=e.url;else if(e.hasOwnProperty("id"))requestParams.id=e.id;else return;BX.ajax({url:"/bitrix/components/bitrix/main.urlpreview/ajax.php",method:"POST",data:requestParams,onsuccess:function(e){if(e.length>0){var t=document.createElement("div");var i=this.element.style.cssText;t.innerHTML=e;var r=t.firstElementChild;this.element.parentNode.replaceChild(r,this.element);this.element=r;this.element.style.cssText=i;this.element.style.removeProperty("display");this.init()}}.bind(this)})};BXUrlPreview.prototype.bindEventHandlers=function(){var e=this;var t=this.element.querySelector(".urlpreview__detach");if(t){t.addEventListener("click",e.detachUrlPreview.bind(e))}var i=this.element.querySelector(".urlpreview__container-switchable");if(i){i.addEventListener("click",BXUrlPreview.showEmbed)}if(this.carouselElement){var r=this.carouselElement.querySelector(".urlpreview__button-prev");var s=this.carouselElement.querySelector(".urlpreview__button-next");if(r)r.addEventListener("click",e.previousImage.bind(e));if(s)s.addEventListener("click",e.nextImage.bind(e))}};BXUrlPreview.prototype.initCarousel=function(){var e;var t;var i;var r;if(e=this.element.querySelector(".urlpreview__carousel")){this.carouselElement=e;t=e.querySelectorAll(".urlpreview__image");for(i=0;i<t.length;i++){t[i].dataset.imageId=i;this.carouselImages[i]=t[i]}r=this.element.dataset.imageId?parseInt(this.element.dataset.imageId):0;this.setCarouselImage(r);this.carouselElement.style.removeProperty("display")}};BXUrlPreview.prototype.setCarouselImage=function(e){var t;var i;var r;if(!(e>=0||e<=this.carouselImages.length-1))return null;this.carouselImages.map(function(e){e.style.display="none"});this.carouselImages[e].style.removeProperty("display");if(i=this.carouselImages[e].querySelector("img")){t=i.getAttribute("src");if(this.inputElement){r=this.inputElement.value.split(";");this.inputElement.value=r[0]+";"+t}}this.currentImageId=e};BXUrlPreview.prototype.nextImage=function(){var e=this.currentImageId+1;if(e>this.carouselImages.length-1)e=0;this.setCarouselImage(e)};BXUrlPreview.prototype.previousImage=function(){var e=this.currentImageId-1;if(e<0)e=this.carouselImages.length-1;this.setCarouselImage(e)};BXUrlPreview.showEmbed=function(){if(BX.hasClass(this,"urlpreview__container-hide-embed")){BX.addClass(this,"urlpreview__container-hide-image");BX.removeClass(this,"urlpreview__container-hide-embed");var e=BX.findChildByClassName(this,"video-js");if(e){if(BX.getClass("BX.Fileman.PlayerManager")){var t=BX.Fileman.PlayerManager.getPlayerById(e.getAttribute("id"));if(t){t.play()}}}else{var i=BX.findChildByClassName(this,"urlpreview-iframe-html-embed");if(i){BXUrlPreview.adjustFrameHeight(i,5)}}}};BXUrlPreview.bindEmbedHandler=function(){var e=document.querySelectorAll(".urlpreview__container-switchable");var t;for(t=0;t<e.length;t++){e.item(t).addEventListener("click",BXUrlPreview.showEmbed)}};BXUrlPreview.adjustFrameHeight=function(e,t){if(BX.hasClass(e,"urlpreview-iframe-html-embed-adjusted")){return}t=t||0;if(t>10){return}var i=50;if(e.contentWindow.document.body.scrollHeight>e.height){e.height=e.contentWindow.document.body.scrollHeight+i+"px";BX.addClass(e,"urlpreview-iframe-html-embed-adjusted");return}var r=e.contentWindow.document.getElementsByTagName("video");if(r[0]){e.height=e.contentWindow.document.body.scrollHeight+i+"px";BX.addClass(e,"urlpreview-iframe-html-embed-adjusted");return}else{var s=e.contentWindow.document.getElementsByTagName("iframe");var l=0;for(var a=0;a<s.length;a++){if(s[a]&&s[a].height>0){l=parseInt(s[a].height)}else if(s[a]&&s[a].style.height){l=parseInt(s[a].style.height)}if(l!==0){e.height=l+i+"px";BX.addClass(e,"urlpreview-iframe-html-embed-adjusted")}}if(l===0){setTimeout(function(){t++;BXUrlPreview.adjustFrameHeight(e,t)},500)}}};
/* End */
;; /* /bitrix/components/bitrix/socialnetwork.blog.post/templates/.default/script.min.js?155117212123727*/
; /* /bitrix/components/bitrix/main.user.selector/templates/.default/script.min.js?15525565735871*/
; /* /bitrix/components/bitrix/ui.tile.selector/templates/.default/script.min.js?154962778012760*/
; /* /bitrix/components/bitrix/socialnetwork.blog.post.comment/templates/.default/script.min.js?15265632624339*/
; /* /bitrix/components/bitrix/main.post.list/templates/.default/script.min.js?154900826738795*/
; /* /bitrix/components/bitrix/main.post.list/templates/.default/scripts_for_form.min.js?155255657315739*/
; /* /bitrix/components/bitrix/main.post.list/templates/.default/scripts_for_im.min.js?15078149408146*/
; /* /bitrix/components/bitrix/main.post.form/templates/.default/script.min.js?155255657359492*/
; /* /bitrix/components/bitrix/system.field.edit/script.min.js?1464958417814*/
; /* /bitrix/components/bitrix/disk.uf.file/templates/.default/script.min.js?155370163828595*/
; /* /bitrix/components/bitrix/main.urlpreview/templates/.default/script.min.js?15180185854554*/

//# sourceMappingURL=default_3d907fc87c65b3a029cab82c63c3e3ac.map.js